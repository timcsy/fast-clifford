"""
CGA Cl(4,1) Functional Operations - Auto-generated

DO NOT EDIT MANUALLY - This file is generated by codegen/generate.py

Generated: 2025-12-07 16:21:07
Algebra: cga3d
Signature: (1, 1, 1, 1, -1)
Blade count: 32

All functions are:
- Loop-free (fully expanded arithmetic)
- ONNX-compatible (only Add/Mul/Neg/Sub operations)
- Hard-coded (no Cayley table lookups)
"""

import torch
from torch import Tensor
from typing import Tuple


# =============================================================================
# Constants
# =============================================================================

BLADE_COUNT = 32

# Blade indices by grade
GRADE_0_INDICES = (0,)
GRADE_1_INDICES = (1, 2, 3, 4, 5)
GRADE_2_INDICES = (6, 7, 8, 9, 10, 11, 12, 13, 14, 15)
GRADE_3_INDICES = (16, 17, 18, 19, 20, 21, 22, 23, 24, 25)
GRADE_4_INDICES = (26, 27, 28, 29, 30)
GRADE_5_INDICES = (31,)

# Sparsity masks
UPGC_POINT_MASK = GRADE_1_INDICES  # 5 components
MOTOR_MASK = GRADE_0_INDICES + GRADE_2_INDICES + GRADE_4_INDICES  # 16 components

# Reverse signs for all 32 blades
REVERSE_SIGNS = (1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1)

# Motor-specific reverse signs (16 components)
# Grade 0: +1, Grade 2: -1 (10 components), Grade 4: +1 (5 components)
MOTOR_REVERSE_SIGNS = (1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1)

# =============================================================================
# Geometric Product (Full 32x32)
# =============================================================================

@torch.jit.script
def geometric_product_full(a: Tensor, b: Tensor) -> Tensor:
    """
    Compute the full geometric product of two multivectors.

    Args:
        a: Left operand, shape (..., 32)
        b: Right operand, shape (..., 32)

    Returns:
        Result multivector, shape (..., 32)

    Note:
        Fully expanded, no loops, ONNX compatible.
    """
    r0 = (
        a[..., 0] * b[..., 0] +
        a[..., 1] * b[..., 1] +
        a[..., 2] * b[..., 2] +
        a[..., 3] * b[..., 3] +
        a[..., 4] * b[..., 4] +
        -a[..., 5] * b[..., 5] +
        -a[..., 6] * b[..., 6] +
        -a[..., 7] * b[..., 7] +
        -a[..., 8] * b[..., 8] +
        a[..., 9] * b[..., 9] +
        -a[..., 10] * b[..., 10] +
        -a[..., 11] * b[..., 11] +
        a[..., 12] * b[..., 12] +
        -a[..., 13] * b[..., 13] +
        a[..., 14] * b[..., 14] +
        a[..., 15] * b[..., 15] +
        -a[..., 16] * b[..., 16] +
        -a[..., 17] * b[..., 17] +
        a[..., 18] * b[..., 18] +
        -a[..., 19] * b[..., 19] +
        a[..., 20] * b[..., 20] +
        a[..., 21] * b[..., 21] +
        -a[..., 22] * b[..., 22] +
        a[..., 23] * b[..., 23] +
        a[..., 24] * b[..., 24] +
        a[..., 25] * b[..., 25] +
        a[..., 26] * b[..., 26] +
        -a[..., 27] * b[..., 27] +
        -a[..., 28] * b[..., 28] +
        -a[..., 29] * b[..., 29] +
        -a[..., 30] * b[..., 30] +
        -a[..., 31] * b[..., 31]
    )
    r1 = (
        a[..., 0] * b[..., 1] +
        a[..., 1] * b[..., 0] +
        -a[..., 2] * b[..., 6] +
        -a[..., 3] * b[..., 7] +
        -a[..., 4] * b[..., 8] +
        a[..., 5] * b[..., 9] +
        a[..., 6] * b[..., 2] +
        a[..., 7] * b[..., 3] +
        a[..., 8] * b[..., 4] +
        -a[..., 9] * b[..., 5] +
        -a[..., 10] * b[..., 16] +
        -a[..., 11] * b[..., 17] +
        a[..., 12] * b[..., 18] +
        -a[..., 13] * b[..., 19] +
        a[..., 14] * b[..., 20] +
        a[..., 15] * b[..., 21] +
        -a[..., 16] * b[..., 10] +
        -a[..., 17] * b[..., 11] +
        a[..., 18] * b[..., 12] +
        -a[..., 19] * b[..., 13] +
        a[..., 20] * b[..., 14] +
        a[..., 21] * b[..., 15] +
        a[..., 22] * b[..., 26] +
        -a[..., 23] * b[..., 27] +
        -a[..., 24] * b[..., 28] +
        -a[..., 25] * b[..., 29] +
        -a[..., 26] * b[..., 22] +
        a[..., 27] * b[..., 23] +
        a[..., 28] * b[..., 24] +
        a[..., 29] * b[..., 25] +
        -a[..., 30] * b[..., 31] +
        -a[..., 31] * b[..., 30]
    )
    r2 = (
        a[..., 0] * b[..., 2] +
        a[..., 1] * b[..., 6] +
        a[..., 2] * b[..., 0] +
        -a[..., 3] * b[..., 10] +
        -a[..., 4] * b[..., 11] +
        a[..., 5] * b[..., 12] +
        -a[..., 6] * b[..., 1] +
        a[..., 7] * b[..., 16] +
        a[..., 8] * b[..., 17] +
        -a[..., 9] * b[..., 18] +
        a[..., 10] * b[..., 3] +
        a[..., 11] * b[..., 4] +
        -a[..., 12] * b[..., 5] +
        -a[..., 13] * b[..., 22] +
        a[..., 14] * b[..., 23] +
        a[..., 15] * b[..., 24] +
        a[..., 16] * b[..., 7] +
        a[..., 17] * b[..., 8] +
        -a[..., 18] * b[..., 9] +
        -a[..., 19] * b[..., 26] +
        a[..., 20] * b[..., 27] +
        a[..., 21] * b[..., 28] +
        -a[..., 22] * b[..., 13] +
        a[..., 23] * b[..., 14] +
        a[..., 24] * b[..., 15] +
        -a[..., 25] * b[..., 30] +
        a[..., 26] * b[..., 19] +
        -a[..., 27] * b[..., 20] +
        -a[..., 28] * b[..., 21] +
        a[..., 29] * b[..., 31] +
        a[..., 30] * b[..., 25] +
        a[..., 31] * b[..., 29]
    )
    r3 = (
        a[..., 0] * b[..., 3] +
        a[..., 1] * b[..., 7] +
        a[..., 2] * b[..., 10] +
        a[..., 3] * b[..., 0] +
        -a[..., 4] * b[..., 13] +
        a[..., 5] * b[..., 14] +
        -a[..., 6] * b[..., 16] +
        -a[..., 7] * b[..., 1] +
        a[..., 8] * b[..., 19] +
        -a[..., 9] * b[..., 20] +
        -a[..., 10] * b[..., 2] +
        a[..., 11] * b[..., 22] +
        -a[..., 12] * b[..., 23] +
        a[..., 13] * b[..., 4] +
        -a[..., 14] * b[..., 5] +
        a[..., 15] * b[..., 25] +
        -a[..., 16] * b[..., 6] +
        a[..., 17] * b[..., 26] +
        -a[..., 18] * b[..., 27] +
        a[..., 19] * b[..., 8] +
        -a[..., 20] * b[..., 9] +
        a[..., 21] * b[..., 29] +
        a[..., 22] * b[..., 11] +
        -a[..., 23] * b[..., 12] +
        a[..., 24] * b[..., 30] +
        a[..., 25] * b[..., 15] +
        -a[..., 26] * b[..., 17] +
        a[..., 27] * b[..., 18] +
        -a[..., 28] * b[..., 31] +
        -a[..., 29] * b[..., 21] +
        -a[..., 30] * b[..., 24] +
        -a[..., 31] * b[..., 28]
    )
    r4 = (
        a[..., 0] * b[..., 4] +
        a[..., 1] * b[..., 8] +
        a[..., 2] * b[..., 11] +
        a[..., 3] * b[..., 13] +
        a[..., 4] * b[..., 0] +
        a[..., 5] * b[..., 15] +
        -a[..., 6] * b[..., 17] +
        -a[..., 7] * b[..., 19] +
        -a[..., 8] * b[..., 1] +
        -a[..., 9] * b[..., 21] +
        -a[..., 10] * b[..., 22] +
        -a[..., 11] * b[..., 2] +
        -a[..., 12] * b[..., 24] +
        -a[..., 13] * b[..., 3] +
        -a[..., 14] * b[..., 25] +
        -a[..., 15] * b[..., 5] +
        -a[..., 16] * b[..., 26] +
        -a[..., 17] * b[..., 6] +
        -a[..., 18] * b[..., 28] +
        -a[..., 19] * b[..., 7] +
        -a[..., 20] * b[..., 29] +
        -a[..., 21] * b[..., 9] +
        -a[..., 22] * b[..., 10] +
        -a[..., 23] * b[..., 30] +
        -a[..., 24] * b[..., 12] +
        -a[..., 25] * b[..., 14] +
        a[..., 26] * b[..., 16] +
        a[..., 27] * b[..., 31] +
        a[..., 28] * b[..., 18] +
        a[..., 29] * b[..., 20] +
        a[..., 30] * b[..., 23] +
        a[..., 31] * b[..., 27]
    )
    r5 = (
        a[..., 0] * b[..., 5] +
        a[..., 1] * b[..., 9] +
        a[..., 2] * b[..., 12] +
        a[..., 3] * b[..., 14] +
        a[..., 4] * b[..., 15] +
        a[..., 5] * b[..., 0] +
        -a[..., 6] * b[..., 18] +
        -a[..., 7] * b[..., 20] +
        -a[..., 8] * b[..., 21] +
        -a[..., 9] * b[..., 1] +
        -a[..., 10] * b[..., 23] +
        -a[..., 11] * b[..., 24] +
        -a[..., 12] * b[..., 2] +
        -a[..., 13] * b[..., 25] +
        -a[..., 14] * b[..., 3] +
        -a[..., 15] * b[..., 4] +
        -a[..., 16] * b[..., 27] +
        -a[..., 17] * b[..., 28] +
        -a[..., 18] * b[..., 6] +
        -a[..., 19] * b[..., 29] +
        -a[..., 20] * b[..., 7] +
        -a[..., 21] * b[..., 8] +
        -a[..., 22] * b[..., 30] +
        -a[..., 23] * b[..., 10] +
        -a[..., 24] * b[..., 11] +
        -a[..., 25] * b[..., 13] +
        a[..., 26] * b[..., 31] +
        a[..., 27] * b[..., 16] +
        a[..., 28] * b[..., 17] +
        a[..., 29] * b[..., 19] +
        a[..., 30] * b[..., 22] +
        a[..., 31] * b[..., 26]
    )
    r6 = (
        a[..., 0] * b[..., 6] +
        a[..., 1] * b[..., 2] +
        -a[..., 2] * b[..., 1] +
        a[..., 3] * b[..., 16] +
        a[..., 4] * b[..., 17] +
        -a[..., 5] * b[..., 18] +
        a[..., 6] * b[..., 0] +
        -a[..., 7] * b[..., 10] +
        -a[..., 8] * b[..., 11] +
        a[..., 9] * b[..., 12] +
        a[..., 10] * b[..., 7] +
        a[..., 11] * b[..., 8] +
        -a[..., 12] * b[..., 9] +
        -a[..., 13] * b[..., 26] +
        a[..., 14] * b[..., 27] +
        a[..., 15] * b[..., 28] +
        a[..., 16] * b[..., 3] +
        a[..., 17] * b[..., 4] +
        -a[..., 18] * b[..., 5] +
        -a[..., 19] * b[..., 22] +
        a[..., 20] * b[..., 23] +
        a[..., 21] * b[..., 24] +
        a[..., 22] * b[..., 19] +
        -a[..., 23] * b[..., 20] +
        -a[..., 24] * b[..., 21] +
        a[..., 25] * b[..., 31] +
        -a[..., 26] * b[..., 13] +
        a[..., 27] * b[..., 14] +
        a[..., 28] * b[..., 15] +
        -a[..., 29] * b[..., 30] +
        a[..., 30] * b[..., 29] +
        a[..., 31] * b[..., 25]
    )
    r7 = (
        a[..., 0] * b[..., 7] +
        a[..., 1] * b[..., 3] +
        -a[..., 2] * b[..., 16] +
        -a[..., 3] * b[..., 1] +
        a[..., 4] * b[..., 19] +
        -a[..., 5] * b[..., 20] +
        a[..., 6] * b[..., 10] +
        a[..., 7] * b[..., 0] +
        -a[..., 8] * b[..., 13] +
        a[..., 9] * b[..., 14] +
        -a[..., 10] * b[..., 6] +
        a[..., 11] * b[..., 26] +
        -a[..., 12] * b[..., 27] +
        a[..., 13] * b[..., 8] +
        -a[..., 14] * b[..., 9] +
        a[..., 15] * b[..., 29] +
        -a[..., 16] * b[..., 2] +
        a[..., 17] * b[..., 22] +
        -a[..., 18] * b[..., 23] +
        a[..., 19] * b[..., 4] +
        -a[..., 20] * b[..., 5] +
        a[..., 21] * b[..., 25] +
        -a[..., 22] * b[..., 17] +
        a[..., 23] * b[..., 18] +
        -a[..., 24] * b[..., 31] +
        -a[..., 25] * b[..., 21] +
        a[..., 26] * b[..., 11] +
        -a[..., 27] * b[..., 12] +
        a[..., 28] * b[..., 30] +
        a[..., 29] * b[..., 15] +
        -a[..., 30] * b[..., 28] +
        -a[..., 31] * b[..., 24]
    )
    r8 = (
        a[..., 0] * b[..., 8] +
        a[..., 1] * b[..., 4] +
        -a[..., 2] * b[..., 17] +
        -a[..., 3] * b[..., 19] +
        -a[..., 4] * b[..., 1] +
        -a[..., 5] * b[..., 21] +
        a[..., 6] * b[..., 11] +
        a[..., 7] * b[..., 13] +
        a[..., 8] * b[..., 0] +
        a[..., 9] * b[..., 15] +
        -a[..., 10] * b[..., 26] +
        -a[..., 11] * b[..., 6] +
        -a[..., 12] * b[..., 28] +
        -a[..., 13] * b[..., 7] +
        -a[..., 14] * b[..., 29] +
        -a[..., 15] * b[..., 9] +
        -a[..., 16] * b[..., 22] +
        -a[..., 17] * b[..., 2] +
        -a[..., 18] * b[..., 24] +
        -a[..., 19] * b[..., 3] +
        -a[..., 20] * b[..., 25] +
        -a[..., 21] * b[..., 5] +
        a[..., 22] * b[..., 16] +
        a[..., 23] * b[..., 31] +
        a[..., 24] * b[..., 18] +
        a[..., 25] * b[..., 20] +
        -a[..., 26] * b[..., 10] +
        -a[..., 27] * b[..., 30] +
        -a[..., 28] * b[..., 12] +
        -a[..., 29] * b[..., 14] +
        a[..., 30] * b[..., 27] +
        a[..., 31] * b[..., 23]
    )
    r9 = (
        a[..., 0] * b[..., 9] +
        a[..., 1] * b[..., 5] +
        -a[..., 2] * b[..., 18] +
        -a[..., 3] * b[..., 20] +
        -a[..., 4] * b[..., 21] +
        -a[..., 5] * b[..., 1] +
        a[..., 6] * b[..., 12] +
        a[..., 7] * b[..., 14] +
        a[..., 8] * b[..., 15] +
        a[..., 9] * b[..., 0] +
        -a[..., 10] * b[..., 27] +
        -a[..., 11] * b[..., 28] +
        -a[..., 12] * b[..., 6] +
        -a[..., 13] * b[..., 29] +
        -a[..., 14] * b[..., 7] +
        -a[..., 15] * b[..., 8] +
        -a[..., 16] * b[..., 23] +
        -a[..., 17] * b[..., 24] +
        -a[..., 18] * b[..., 2] +
        -a[..., 19] * b[..., 25] +
        -a[..., 20] * b[..., 3] +
        -a[..., 21] * b[..., 4] +
        a[..., 22] * b[..., 31] +
        a[..., 23] * b[..., 16] +
        a[..., 24] * b[..., 17] +
        a[..., 25] * b[..., 19] +
        -a[..., 26] * b[..., 30] +
        -a[..., 27] * b[..., 10] +
        -a[..., 28] * b[..., 11] +
        -a[..., 29] * b[..., 13] +
        a[..., 30] * b[..., 26] +
        a[..., 31] * b[..., 22]
    )
    r10 = (
        a[..., 0] * b[..., 10] +
        a[..., 1] * b[..., 16] +
        a[..., 2] * b[..., 3] +
        -a[..., 3] * b[..., 2] +
        a[..., 4] * b[..., 22] +
        -a[..., 5] * b[..., 23] +
        -a[..., 6] * b[..., 7] +
        a[..., 7] * b[..., 6] +
        -a[..., 8] * b[..., 26] +
        a[..., 9] * b[..., 27] +
        a[..., 10] * b[..., 0] +
        -a[..., 11] * b[..., 13] +
        a[..., 12] * b[..., 14] +
        a[..., 13] * b[..., 11] +
        -a[..., 14] * b[..., 12] +
        a[..., 15] * b[..., 30] +
        a[..., 16] * b[..., 1] +
        -a[..., 17] * b[..., 19] +
        a[..., 18] * b[..., 20] +
        a[..., 19] * b[..., 17] +
        -a[..., 20] * b[..., 18] +
        a[..., 21] * b[..., 31] +
        a[..., 22] * b[..., 4] +
        -a[..., 23] * b[..., 5] +
        a[..., 24] * b[..., 25] +
        -a[..., 25] * b[..., 24] +
        -a[..., 26] * b[..., 8] +
        a[..., 27] * b[..., 9] +
        -a[..., 28] * b[..., 29] +
        a[..., 29] * b[..., 28] +
        a[..., 30] * b[..., 15] +
        a[..., 31] * b[..., 21]
    )
    r11 = (
        a[..., 0] * b[..., 11] +
        a[..., 1] * b[..., 17] +
        a[..., 2] * b[..., 4] +
        -a[..., 3] * b[..., 22] +
        -a[..., 4] * b[..., 2] +
        -a[..., 5] * b[..., 24] +
        -a[..., 6] * b[..., 8] +
        a[..., 7] * b[..., 26] +
        a[..., 8] * b[..., 6] +
        a[..., 9] * b[..., 28] +
        a[..., 10] * b[..., 13] +
        a[..., 11] * b[..., 0] +
        a[..., 12] * b[..., 15] +
        -a[..., 13] * b[..., 10] +
        -a[..., 14] * b[..., 30] +
        -a[..., 15] * b[..., 12] +
        a[..., 16] * b[..., 19] +
        a[..., 17] * b[..., 1] +
        a[..., 18] * b[..., 21] +
        -a[..., 19] * b[..., 16] +
        -a[..., 20] * b[..., 31] +
        -a[..., 21] * b[..., 18] +
        -a[..., 22] * b[..., 3] +
        -a[..., 23] * b[..., 25] +
        -a[..., 24] * b[..., 5] +
        a[..., 25] * b[..., 23] +
        a[..., 26] * b[..., 7] +
        a[..., 27] * b[..., 29] +
        a[..., 28] * b[..., 9] +
        -a[..., 29] * b[..., 27] +
        -a[..., 30] * b[..., 14] +
        -a[..., 31] * b[..., 20]
    )
    r12 = (
        a[..., 0] * b[..., 12] +
        a[..., 1] * b[..., 18] +
        a[..., 2] * b[..., 5] +
        -a[..., 3] * b[..., 23] +
        -a[..., 4] * b[..., 24] +
        -a[..., 5] * b[..., 2] +
        -a[..., 6] * b[..., 9] +
        a[..., 7] * b[..., 27] +
        a[..., 8] * b[..., 28] +
        a[..., 9] * b[..., 6] +
        a[..., 10] * b[..., 14] +
        a[..., 11] * b[..., 15] +
        a[..., 12] * b[..., 0] +
        -a[..., 13] * b[..., 30] +
        -a[..., 14] * b[..., 10] +
        -a[..., 15] * b[..., 11] +
        a[..., 16] * b[..., 20] +
        a[..., 17] * b[..., 21] +
        a[..., 18] * b[..., 1] +
        -a[..., 19] * b[..., 31] +
        -a[..., 20] * b[..., 16] +
        -a[..., 21] * b[..., 17] +
        -a[..., 22] * b[..., 25] +
        -a[..., 23] * b[..., 3] +
        -a[..., 24] * b[..., 4] +
        a[..., 25] * b[..., 22] +
        a[..., 26] * b[..., 29] +
        a[..., 27] * b[..., 7] +
        a[..., 28] * b[..., 8] +
        -a[..., 29] * b[..., 26] +
        -a[..., 30] * b[..., 13] +
        -a[..., 31] * b[..., 19]
    )
    r13 = (
        a[..., 0] * b[..., 13] +
        a[..., 1] * b[..., 19] +
        a[..., 2] * b[..., 22] +
        a[..., 3] * b[..., 4] +
        -a[..., 4] * b[..., 3] +
        -a[..., 5] * b[..., 25] +
        -a[..., 6] * b[..., 26] +
        -a[..., 7] * b[..., 8] +
        a[..., 8] * b[..., 7] +
        a[..., 9] * b[..., 29] +
        -a[..., 10] * b[..., 11] +
        a[..., 11] * b[..., 10] +
        a[..., 12] * b[..., 30] +
        a[..., 13] * b[..., 0] +
        a[..., 14] * b[..., 15] +
        -a[..., 15] * b[..., 14] +
        -a[..., 16] * b[..., 17] +
        a[..., 17] * b[..., 16] +
        a[..., 18] * b[..., 31] +
        a[..., 19] * b[..., 1] +
        a[..., 20] * b[..., 21] +
        -a[..., 21] * b[..., 20] +
        a[..., 22] * b[..., 2] +
        a[..., 23] * b[..., 24] +
        -a[..., 24] * b[..., 23] +
        -a[..., 25] * b[..., 5] +
        -a[..., 26] * b[..., 6] +
        -a[..., 27] * b[..., 28] +
        a[..., 28] * b[..., 27] +
        a[..., 29] * b[..., 9] +
        a[..., 30] * b[..., 12] +
        a[..., 31] * b[..., 18]
    )
    r14 = (
        a[..., 0] * b[..., 14] +
        a[..., 1] * b[..., 20] +
        a[..., 2] * b[..., 23] +
        a[..., 3] * b[..., 5] +
        -a[..., 4] * b[..., 25] +
        -a[..., 5] * b[..., 3] +
        -a[..., 6] * b[..., 27] +
        -a[..., 7] * b[..., 9] +
        a[..., 8] * b[..., 29] +
        a[..., 9] * b[..., 7] +
        -a[..., 10] * b[..., 12] +
        a[..., 11] * b[..., 30] +
        a[..., 12] * b[..., 10] +
        a[..., 13] * b[..., 15] +
        a[..., 14] * b[..., 0] +
        -a[..., 15] * b[..., 13] +
        -a[..., 16] * b[..., 18] +
        a[..., 17] * b[..., 31] +
        a[..., 18] * b[..., 16] +
        a[..., 19] * b[..., 21] +
        a[..., 20] * b[..., 1] +
        -a[..., 21] * b[..., 19] +
        a[..., 22] * b[..., 24] +
        a[..., 23] * b[..., 2] +
        -a[..., 24] * b[..., 22] +
        -a[..., 25] * b[..., 4] +
        -a[..., 26] * b[..., 28] +
        -a[..., 27] * b[..., 6] +
        a[..., 28] * b[..., 26] +
        a[..., 29] * b[..., 8] +
        a[..., 30] * b[..., 11] +
        a[..., 31] * b[..., 17]
    )
    r15 = (
        a[..., 0] * b[..., 15] +
        a[..., 1] * b[..., 21] +
        a[..., 2] * b[..., 24] +
        a[..., 3] * b[..., 25] +
        a[..., 4] * b[..., 5] +
        -a[..., 5] * b[..., 4] +
        -a[..., 6] * b[..., 28] +
        -a[..., 7] * b[..., 29] +
        -a[..., 8] * b[..., 9] +
        a[..., 9] * b[..., 8] +
        -a[..., 10] * b[..., 30] +
        -a[..., 11] * b[..., 12] +
        a[..., 12] * b[..., 11] +
        -a[..., 13] * b[..., 14] +
        a[..., 14] * b[..., 13] +
        a[..., 15] * b[..., 0] +
        -a[..., 16] * b[..., 31] +
        -a[..., 17] * b[..., 18] +
        a[..., 18] * b[..., 17] +
        -a[..., 19] * b[..., 20] +
        a[..., 20] * b[..., 19] +
        a[..., 21] * b[..., 1] +
        -a[..., 22] * b[..., 23] +
        a[..., 23] * b[..., 22] +
        a[..., 24] * b[..., 2] +
        a[..., 25] * b[..., 3] +
        a[..., 26] * b[..., 27] +
        -a[..., 27] * b[..., 26] +
        -a[..., 28] * b[..., 6] +
        -a[..., 29] * b[..., 7] +
        -a[..., 30] * b[..., 10] +
        -a[..., 31] * b[..., 16]
    )
    r16 = (
        a[..., 0] * b[..., 16] +
        a[..., 1] * b[..., 10] +
        -a[..., 2] * b[..., 7] +
        a[..., 3] * b[..., 6] +
        -a[..., 4] * b[..., 26] +
        a[..., 5] * b[..., 27] +
        a[..., 6] * b[..., 3] +
        -a[..., 7] * b[..., 2] +
        a[..., 8] * b[..., 22] +
        -a[..., 9] * b[..., 23] +
        a[..., 10] * b[..., 1] +
        -a[..., 11] * b[..., 19] +
        a[..., 12] * b[..., 20] +
        a[..., 13] * b[..., 17] +
        -a[..., 14] * b[..., 18] +
        a[..., 15] * b[..., 31] +
        a[..., 16] * b[..., 0] +
        -a[..., 17] * b[..., 13] +
        a[..., 18] * b[..., 14] +
        a[..., 19] * b[..., 11] +
        -a[..., 20] * b[..., 12] +
        a[..., 21] * b[..., 30] +
        -a[..., 22] * b[..., 8] +
        a[..., 23] * b[..., 9] +
        -a[..., 24] * b[..., 29] +
        a[..., 25] * b[..., 28] +
        a[..., 26] * b[..., 4] +
        -a[..., 27] * b[..., 5] +
        a[..., 28] * b[..., 25] +
        -a[..., 29] * b[..., 24] +
        a[..., 30] * b[..., 21] +
        a[..., 31] * b[..., 15]
    )
    r17 = (
        a[..., 0] * b[..., 17] +
        a[..., 1] * b[..., 11] +
        -a[..., 2] * b[..., 8] +
        a[..., 3] * b[..., 26] +
        a[..., 4] * b[..., 6] +
        a[..., 5] * b[..., 28] +
        a[..., 6] * b[..., 4] +
        -a[..., 7] * b[..., 22] +
        -a[..., 8] * b[..., 2] +
        -a[..., 9] * b[..., 24] +
        a[..., 10] * b[..., 19] +
        a[..., 11] * b[..., 1] +
        a[..., 12] * b[..., 21] +
        -a[..., 13] * b[..., 16] +
        -a[..., 14] * b[..., 31] +
        -a[..., 15] * b[..., 18] +
        a[..., 16] * b[..., 13] +
        a[..., 17] * b[..., 0] +
        a[..., 18] * b[..., 15] +
        -a[..., 19] * b[..., 10] +
        -a[..., 20] * b[..., 30] +
        -a[..., 21] * b[..., 12] +
        a[..., 22] * b[..., 7] +
        a[..., 23] * b[..., 29] +
        a[..., 24] * b[..., 9] +
        -a[..., 25] * b[..., 27] +
        -a[..., 26] * b[..., 3] +
        -a[..., 27] * b[..., 25] +
        -a[..., 28] * b[..., 5] +
        a[..., 29] * b[..., 23] +
        -a[..., 30] * b[..., 20] +
        -a[..., 31] * b[..., 14]
    )
    r18 = (
        a[..., 0] * b[..., 18] +
        a[..., 1] * b[..., 12] +
        -a[..., 2] * b[..., 9] +
        a[..., 3] * b[..., 27] +
        a[..., 4] * b[..., 28] +
        a[..., 5] * b[..., 6] +
        a[..., 6] * b[..., 5] +
        -a[..., 7] * b[..., 23] +
        -a[..., 8] * b[..., 24] +
        -a[..., 9] * b[..., 2] +
        a[..., 10] * b[..., 20] +
        a[..., 11] * b[..., 21] +
        a[..., 12] * b[..., 1] +
        -a[..., 13] * b[..., 31] +
        -a[..., 14] * b[..., 16] +
        -a[..., 15] * b[..., 17] +
        a[..., 16] * b[..., 14] +
        a[..., 17] * b[..., 15] +
        a[..., 18] * b[..., 0] +
        -a[..., 19] * b[..., 30] +
        -a[..., 20] * b[..., 10] +
        -a[..., 21] * b[..., 11] +
        a[..., 22] * b[..., 29] +
        a[..., 23] * b[..., 7] +
        a[..., 24] * b[..., 8] +
        -a[..., 25] * b[..., 26] +
        -a[..., 26] * b[..., 25] +
        -a[..., 27] * b[..., 3] +
        -a[..., 28] * b[..., 4] +
        a[..., 29] * b[..., 22] +
        -a[..., 30] * b[..., 19] +
        -a[..., 31] * b[..., 13]
    )
    r19 = (
        a[..., 0] * b[..., 19] +
        a[..., 1] * b[..., 13] +
        -a[..., 2] * b[..., 26] +
        -a[..., 3] * b[..., 8] +
        a[..., 4] * b[..., 7] +
        a[..., 5] * b[..., 29] +
        a[..., 6] * b[..., 22] +
        a[..., 7] * b[..., 4] +
        -a[..., 8] * b[..., 3] +
        -a[..., 9] * b[..., 25] +
        -a[..., 10] * b[..., 17] +
        a[..., 11] * b[..., 16] +
        a[..., 12] * b[..., 31] +
        a[..., 13] * b[..., 1] +
        a[..., 14] * b[..., 21] +
        -a[..., 15] * b[..., 20] +
        -a[..., 16] * b[..., 11] +
        a[..., 17] * b[..., 10] +
        a[..., 18] * b[..., 30] +
        a[..., 19] * b[..., 0] +
        a[..., 20] * b[..., 15] +
        -a[..., 21] * b[..., 14] +
        -a[..., 22] * b[..., 6] +
        -a[..., 23] * b[..., 28] +
        a[..., 24] * b[..., 27] +
        a[..., 25] * b[..., 9] +
        a[..., 26] * b[..., 2] +
        a[..., 27] * b[..., 24] +
        -a[..., 28] * b[..., 23] +
        -a[..., 29] * b[..., 5] +
        a[..., 30] * b[..., 18] +
        a[..., 31] * b[..., 12]
    )
    r20 = (
        a[..., 0] * b[..., 20] +
        a[..., 1] * b[..., 14] +
        -a[..., 2] * b[..., 27] +
        -a[..., 3] * b[..., 9] +
        a[..., 4] * b[..., 29] +
        a[..., 5] * b[..., 7] +
        a[..., 6] * b[..., 23] +
        a[..., 7] * b[..., 5] +
        -a[..., 8] * b[..., 25] +
        -a[..., 9] * b[..., 3] +
        -a[..., 10] * b[..., 18] +
        a[..., 11] * b[..., 31] +
        a[..., 12] * b[..., 16] +
        a[..., 13] * b[..., 21] +
        a[..., 14] * b[..., 1] +
        -a[..., 15] * b[..., 19] +
        -a[..., 16] * b[..., 12] +
        a[..., 17] * b[..., 30] +
        a[..., 18] * b[..., 10] +
        a[..., 19] * b[..., 15] +
        a[..., 20] * b[..., 0] +
        -a[..., 21] * b[..., 13] +
        -a[..., 22] * b[..., 28] +
        -a[..., 23] * b[..., 6] +
        a[..., 24] * b[..., 26] +
        a[..., 25] * b[..., 8] +
        a[..., 26] * b[..., 24] +
        a[..., 27] * b[..., 2] +
        -a[..., 28] * b[..., 22] +
        -a[..., 29] * b[..., 4] +
        a[..., 30] * b[..., 17] +
        a[..., 31] * b[..., 11]
    )
    r21 = (
        a[..., 0] * b[..., 21] +
        a[..., 1] * b[..., 15] +
        -a[..., 2] * b[..., 28] +
        -a[..., 3] * b[..., 29] +
        -a[..., 4] * b[..., 9] +
        a[..., 5] * b[..., 8] +
        a[..., 6] * b[..., 24] +
        a[..., 7] * b[..., 25] +
        a[..., 8] * b[..., 5] +
        -a[..., 9] * b[..., 4] +
        -a[..., 10] * b[..., 31] +
        -a[..., 11] * b[..., 18] +
        a[..., 12] * b[..., 17] +
        -a[..., 13] * b[..., 20] +
        a[..., 14] * b[..., 19] +
        a[..., 15] * b[..., 1] +
        -a[..., 16] * b[..., 30] +
        -a[..., 17] * b[..., 12] +
        a[..., 18] * b[..., 11] +
        -a[..., 19] * b[..., 14] +
        a[..., 20] * b[..., 13] +
        a[..., 21] * b[..., 0] +
        a[..., 22] * b[..., 27] +
        -a[..., 23] * b[..., 26] +
        -a[..., 24] * b[..., 6] +
        -a[..., 25] * b[..., 7] +
        -a[..., 26] * b[..., 23] +
        a[..., 27] * b[..., 22] +
        a[..., 28] * b[..., 2] +
        a[..., 29] * b[..., 3] +
        -a[..., 30] * b[..., 16] +
        -a[..., 31] * b[..., 10]
    )
    r22 = (
        a[..., 0] * b[..., 22] +
        a[..., 1] * b[..., 26] +
        a[..., 2] * b[..., 13] +
        -a[..., 3] * b[..., 11] +
        a[..., 4] * b[..., 10] +
        a[..., 5] * b[..., 30] +
        -a[..., 6] * b[..., 19] +
        a[..., 7] * b[..., 17] +
        -a[..., 8] * b[..., 16] +
        -a[..., 9] * b[..., 31] +
        a[..., 10] * b[..., 4] +
        -a[..., 11] * b[..., 3] +
        -a[..., 12] * b[..., 25] +
        a[..., 13] * b[..., 2] +
        a[..., 14] * b[..., 24] +
        -a[..., 15] * b[..., 23] +
        a[..., 16] * b[..., 8] +
        -a[..., 17] * b[..., 7] +
        -a[..., 18] * b[..., 29] +
        a[..., 19] * b[..., 6] +
        a[..., 20] * b[..., 28] +
        -a[..., 21] * b[..., 27] +
        a[..., 22] * b[..., 0] +
        a[..., 23] * b[..., 15] +
        -a[..., 24] * b[..., 14] +
        a[..., 25] * b[..., 12] +
        -a[..., 26] * b[..., 1] +
        -a[..., 27] * b[..., 21] +
        a[..., 28] * b[..., 20] +
        -a[..., 29] * b[..., 18] +
        -a[..., 30] * b[..., 5] +
        -a[..., 31] * b[..., 9]
    )
    r23 = (
        a[..., 0] * b[..., 23] +
        a[..., 1] * b[..., 27] +
        a[..., 2] * b[..., 14] +
        -a[..., 3] * b[..., 12] +
        a[..., 4] * b[..., 30] +
        a[..., 5] * b[..., 10] +
        -a[..., 6] * b[..., 20] +
        a[..., 7] * b[..., 18] +
        -a[..., 8] * b[..., 31] +
        -a[..., 9] * b[..., 16] +
        a[..., 10] * b[..., 5] +
        -a[..., 11] * b[..., 25] +
        -a[..., 12] * b[..., 3] +
        a[..., 13] * b[..., 24] +
        a[..., 14] * b[..., 2] +
        -a[..., 15] * b[..., 22] +
        a[..., 16] * b[..., 9] +
        -a[..., 17] * b[..., 29] +
        -a[..., 18] * b[..., 7] +
        a[..., 19] * b[..., 28] +
        a[..., 20] * b[..., 6] +
        -a[..., 21] * b[..., 26] +
        a[..., 22] * b[..., 15] +
        a[..., 23] * b[..., 0] +
        -a[..., 24] * b[..., 13] +
        a[..., 25] * b[..., 11] +
        -a[..., 26] * b[..., 21] +
        -a[..., 27] * b[..., 1] +
        a[..., 28] * b[..., 19] +
        -a[..., 29] * b[..., 17] +
        -a[..., 30] * b[..., 4] +
        -a[..., 31] * b[..., 8]
    )
    r24 = (
        a[..., 0] * b[..., 24] +
        a[..., 1] * b[..., 28] +
        a[..., 2] * b[..., 15] +
        -a[..., 3] * b[..., 30] +
        -a[..., 4] * b[..., 12] +
        a[..., 5] * b[..., 11] +
        -a[..., 6] * b[..., 21] +
        a[..., 7] * b[..., 31] +
        a[..., 8] * b[..., 18] +
        -a[..., 9] * b[..., 17] +
        a[..., 10] * b[..., 25] +
        a[..., 11] * b[..., 5] +
        -a[..., 12] * b[..., 4] +
        -a[..., 13] * b[..., 23] +
        a[..., 14] * b[..., 22] +
        a[..., 15] * b[..., 2] +
        a[..., 16] * b[..., 29] +
        a[..., 17] * b[..., 9] +
        -a[..., 18] * b[..., 8] +
        -a[..., 19] * b[..., 27] +
        a[..., 20] * b[..., 26] +
        a[..., 21] * b[..., 6] +
        -a[..., 22] * b[..., 14] +
        a[..., 23] * b[..., 13] +
        a[..., 24] * b[..., 0] +
        -a[..., 25] * b[..., 10] +
        a[..., 26] * b[..., 20] +
        -a[..., 27] * b[..., 19] +
        -a[..., 28] * b[..., 1] +
        a[..., 29] * b[..., 16] +
        a[..., 30] * b[..., 3] +
        a[..., 31] * b[..., 7]
    )
    r25 = (
        a[..., 0] * b[..., 25] +
        a[..., 1] * b[..., 29] +
        a[..., 2] * b[..., 30] +
        a[..., 3] * b[..., 15] +
        -a[..., 4] * b[..., 14] +
        a[..., 5] * b[..., 13] +
        -a[..., 6] * b[..., 31] +
        -a[..., 7] * b[..., 21] +
        a[..., 8] * b[..., 20] +
        -a[..., 9] * b[..., 19] +
        -a[..., 10] * b[..., 24] +
        a[..., 11] * b[..., 23] +
        -a[..., 12] * b[..., 22] +
        a[..., 13] * b[..., 5] +
        -a[..., 14] * b[..., 4] +
        a[..., 15] * b[..., 3] +
        -a[..., 16] * b[..., 28] +
        a[..., 17] * b[..., 27] +
        -a[..., 18] * b[..., 26] +
        a[..., 19] * b[..., 9] +
        -a[..., 20] * b[..., 8] +
        a[..., 21] * b[..., 7] +
        a[..., 22] * b[..., 12] +
        -a[..., 23] * b[..., 11] +
        a[..., 24] * b[..., 10] +
        a[..., 25] * b[..., 0] +
        -a[..., 26] * b[..., 18] +
        a[..., 27] * b[..., 17] +
        -a[..., 28] * b[..., 16] +
        -a[..., 29] * b[..., 1] +
        -a[..., 30] * b[..., 2] +
        -a[..., 31] * b[..., 6]
    )
    r26 = (
        a[..., 0] * b[..., 26] +
        a[..., 1] * b[..., 22] +
        -a[..., 2] * b[..., 19] +
        a[..., 3] * b[..., 17] +
        -a[..., 4] * b[..., 16] +
        -a[..., 5] * b[..., 31] +
        a[..., 6] * b[..., 13] +
        -a[..., 7] * b[..., 11] +
        a[..., 8] * b[..., 10] +
        a[..., 9] * b[..., 30] +
        a[..., 10] * b[..., 8] +
        -a[..., 11] * b[..., 7] +
        -a[..., 12] * b[..., 29] +
        a[..., 13] * b[..., 6] +
        a[..., 14] * b[..., 28] +
        -a[..., 15] * b[..., 27] +
        a[..., 16] * b[..., 4] +
        -a[..., 17] * b[..., 3] +
        -a[..., 18] * b[..., 25] +
        a[..., 19] * b[..., 2] +
        a[..., 20] * b[..., 24] +
        -a[..., 21] * b[..., 23] +
        -a[..., 22] * b[..., 1] +
        -a[..., 23] * b[..., 21] +
        a[..., 24] * b[..., 20] +
        -a[..., 25] * b[..., 18] +
        a[..., 26] * b[..., 0] +
        a[..., 27] * b[..., 15] +
        -a[..., 28] * b[..., 14] +
        a[..., 29] * b[..., 12] +
        -a[..., 30] * b[..., 9] +
        -a[..., 31] * b[..., 5]
    )
    r27 = (
        a[..., 0] * b[..., 27] +
        a[..., 1] * b[..., 23] +
        -a[..., 2] * b[..., 20] +
        a[..., 3] * b[..., 18] +
        -a[..., 4] * b[..., 31] +
        -a[..., 5] * b[..., 16] +
        a[..., 6] * b[..., 14] +
        -a[..., 7] * b[..., 12] +
        a[..., 8] * b[..., 30] +
        a[..., 9] * b[..., 10] +
        a[..., 10] * b[..., 9] +
        -a[..., 11] * b[..., 29] +
        -a[..., 12] * b[..., 7] +
        a[..., 13] * b[..., 28] +
        a[..., 14] * b[..., 6] +
        -a[..., 15] * b[..., 26] +
        a[..., 16] * b[..., 5] +
        -a[..., 17] * b[..., 25] +
        -a[..., 18] * b[..., 3] +
        a[..., 19] * b[..., 24] +
        a[..., 20] * b[..., 2] +
        -a[..., 21] * b[..., 22] +
        -a[..., 22] * b[..., 21] +
        -a[..., 23] * b[..., 1] +
        a[..., 24] * b[..., 19] +
        -a[..., 25] * b[..., 17] +
        a[..., 26] * b[..., 15] +
        a[..., 27] * b[..., 0] +
        -a[..., 28] * b[..., 13] +
        a[..., 29] * b[..., 11] +
        -a[..., 30] * b[..., 8] +
        -a[..., 31] * b[..., 4]
    )
    r28 = (
        a[..., 0] * b[..., 28] +
        a[..., 1] * b[..., 24] +
        -a[..., 2] * b[..., 21] +
        a[..., 3] * b[..., 31] +
        a[..., 4] * b[..., 18] +
        -a[..., 5] * b[..., 17] +
        a[..., 6] * b[..., 15] +
        -a[..., 7] * b[..., 30] +
        -a[..., 8] * b[..., 12] +
        a[..., 9] * b[..., 11] +
        a[..., 10] * b[..., 29] +
        a[..., 11] * b[..., 9] +
        -a[..., 12] * b[..., 8] +
        -a[..., 13] * b[..., 27] +
        a[..., 14] * b[..., 26] +
        a[..., 15] * b[..., 6] +
        a[..., 16] * b[..., 25] +
        a[..., 17] * b[..., 5] +
        -a[..., 18] * b[..., 4] +
        -a[..., 19] * b[..., 23] +
        a[..., 20] * b[..., 22] +
        a[..., 21] * b[..., 2] +
        a[..., 22] * b[..., 20] +
        -a[..., 23] * b[..., 19] +
        -a[..., 24] * b[..., 1] +
        a[..., 25] * b[..., 16] +
        -a[..., 26] * b[..., 14] +
        a[..., 27] * b[..., 13] +
        a[..., 28] * b[..., 0] +
        -a[..., 29] * b[..., 10] +
        a[..., 30] * b[..., 7] +
        a[..., 31] * b[..., 3]
    )
    r29 = (
        a[..., 0] * b[..., 29] +
        a[..., 1] * b[..., 25] +
        -a[..., 2] * b[..., 31] +
        -a[..., 3] * b[..., 21] +
        a[..., 4] * b[..., 20] +
        -a[..., 5] * b[..., 19] +
        a[..., 6] * b[..., 30] +
        a[..., 7] * b[..., 15] +
        -a[..., 8] * b[..., 14] +
        a[..., 9] * b[..., 13] +
        -a[..., 10] * b[..., 28] +
        a[..., 11] * b[..., 27] +
        -a[..., 12] * b[..., 26] +
        a[..., 13] * b[..., 9] +
        -a[..., 14] * b[..., 8] +
        a[..., 15] * b[..., 7] +
        -a[..., 16] * b[..., 24] +
        a[..., 17] * b[..., 23] +
        -a[..., 18] * b[..., 22] +
        a[..., 19] * b[..., 5] +
        -a[..., 20] * b[..., 4] +
        a[..., 21] * b[..., 3] +
        -a[..., 22] * b[..., 18] +
        a[..., 23] * b[..., 17] +
        -a[..., 24] * b[..., 16] +
        -a[..., 25] * b[..., 1] +
        a[..., 26] * b[..., 12] +
        -a[..., 27] * b[..., 11] +
        a[..., 28] * b[..., 10] +
        a[..., 29] * b[..., 0] +
        -a[..., 30] * b[..., 6] +
        -a[..., 31] * b[..., 2]
    )
    r30 = (
        a[..., 0] * b[..., 30] +
        a[..., 1] * b[..., 31] +
        a[..., 2] * b[..., 25] +
        -a[..., 3] * b[..., 24] +
        a[..., 4] * b[..., 23] +
        -a[..., 5] * b[..., 22] +
        -a[..., 6] * b[..., 29] +
        a[..., 7] * b[..., 28] +
        -a[..., 8] * b[..., 27] +
        a[..., 9] * b[..., 26] +
        a[..., 10] * b[..., 15] +
        -a[..., 11] * b[..., 14] +
        a[..., 12] * b[..., 13] +
        a[..., 13] * b[..., 12] +
        -a[..., 14] * b[..., 11] +
        a[..., 15] * b[..., 10] +
        a[..., 16] * b[..., 21] +
        -a[..., 17] * b[..., 20] +
        a[..., 18] * b[..., 19] +
        a[..., 19] * b[..., 18] +
        -a[..., 20] * b[..., 17] +
        a[..., 21] * b[..., 16] +
        a[..., 22] * b[..., 5] +
        -a[..., 23] * b[..., 4] +
        a[..., 24] * b[..., 3] +
        -a[..., 25] * b[..., 2] +
        -a[..., 26] * b[..., 9] +
        a[..., 27] * b[..., 8] +
        -a[..., 28] * b[..., 7] +
        a[..., 29] * b[..., 6] +
        a[..., 30] * b[..., 0] +
        a[..., 31] * b[..., 1]
    )
    r31 = (
        a[..., 0] * b[..., 31] +
        a[..., 1] * b[..., 30] +
        -a[..., 2] * b[..., 29] +
        a[..., 3] * b[..., 28] +
        -a[..., 4] * b[..., 27] +
        a[..., 5] * b[..., 26] +
        a[..., 6] * b[..., 25] +
        -a[..., 7] * b[..., 24] +
        a[..., 8] * b[..., 23] +
        -a[..., 9] * b[..., 22] +
        a[..., 10] * b[..., 21] +
        -a[..., 11] * b[..., 20] +
        a[..., 12] * b[..., 19] +
        a[..., 13] * b[..., 18] +
        -a[..., 14] * b[..., 17] +
        a[..., 15] * b[..., 16] +
        a[..., 16] * b[..., 15] +
        -a[..., 17] * b[..., 14] +
        a[..., 18] * b[..., 13] +
        a[..., 19] * b[..., 12] +
        -a[..., 20] * b[..., 11] +
        a[..., 21] * b[..., 10] +
        -a[..., 22] * b[..., 9] +
        a[..., 23] * b[..., 8] +
        -a[..., 24] * b[..., 7] +
        a[..., 25] * b[..., 6] +
        a[..., 26] * b[..., 5] +
        -a[..., 27] * b[..., 4] +
        a[..., 28] * b[..., 3] +
        -a[..., 29] * b[..., 2] +
        a[..., 30] * b[..., 1] +
        a[..., 31] * b[..., 0]
    )

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Reverse Operation
# =============================================================================

@torch.jit.script
def reverse_full(mv: Tensor) -> Tensor:
    """
    Compute the reverse of a multivector.

    For grade k: coefficient *= (-1)^(k*(k-1)/2)
    Grade 0, 1, 4, 5: sign = +1
    Grade 2, 3: sign = -1

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Reversed multivector, shape (..., 32)
    """
    r0 = mv[..., 0]
    r1 = mv[..., 1]
    r2 = mv[..., 2]
    r3 = mv[..., 3]
    r4 = mv[..., 4]
    r5 = mv[..., 5]
    r6 = -mv[..., 6]
    r7 = -mv[..., 7]
    r8 = -mv[..., 8]
    r9 = -mv[..., 9]
    r10 = -mv[..., 10]
    r11 = -mv[..., 11]
    r12 = -mv[..., 12]
    r13 = -mv[..., 13]
    r14 = -mv[..., 14]
    r15 = -mv[..., 15]
    r16 = -mv[..., 16]
    r17 = -mv[..., 17]
    r18 = -mv[..., 18]
    r19 = -mv[..., 19]
    r20 = -mv[..., 20]
    r21 = -mv[..., 21]
    r22 = -mv[..., 22]
    r23 = -mv[..., 23]
    r24 = -mv[..., 24]
    r25 = -mv[..., 25]
    r26 = mv[..., 26]
    r27 = mv[..., 27]
    r28 = mv[..., 28]
    r29 = mv[..., 29]
    r30 = mv[..., 30]
    r31 = mv[..., 31]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Sparse Operations (Motor x Point)
# =============================================================================

# Motor sparse indices: Grade 0 (1) + Grade 2 (10) + Grade 4 (5) = 16
# Point sparse indices: Grade 1 (5)

@torch.jit.script
def upgc_encode(x: Tensor) -> Tensor:
    """
    Encode 3D vector to UPGC point representation.

    X = n_o + x + 0.5|x|^2 * n_inf

    Where:
        n_o = 0.5 * (e- - e+)   -> coefficients: e+ = -0.5, e- = 0.5
        n_inf = e- + e+         -> coefficients: e+ = 1, e- = 1

    Args:
        x: 3D vector, shape (..., 3)

    Returns:
        UPGC point, shape (..., 5) as [e1, e2, e3, e+, e-]
    """
    x1 = x[..., 0]
    x2 = x[..., 1]
    x3 = x[..., 2]

    # |x|^2 / 2
    half_norm_sq = 0.5 * (x1 * x1 + x2 * x2 + x3 * x3)

    # e1, e2, e3 components are just x
    r0 = x1  # e1
    r1 = x2  # e2
    r2 = x3  # e3

    # e+ component: -0.5 (from n_o) + half_norm_sq * 1 (from n_inf)
    r3 = -0.5 + half_norm_sq  # e+

    # e- component: 0.5 (from n_o) + half_norm_sq * 1 (from n_inf)
    r4 = 0.5 + half_norm_sq  # e-

    return torch.stack([r0, r1, r2, r3, r4], dim=-1)


@torch.jit.script
def upgc_decode(point: Tensor) -> Tensor:
    """
    Decode UPGC point to 3D vector.

    Extracts the e1, e2, e3 components directly.

    Args:
        point: UPGC point, shape (..., 5) as [e1, e2, e3, e+, e-]

    Returns:
        3D vector, shape (..., 3)
    """
    return point[..., :3]


@torch.jit.script
def reverse_motor(motor: Tensor) -> Tensor:
    """
    Compute reverse of a motor (sparse 16-component version).

    Motor layout (16 components):
        [0]: scalar (Grade 0) -> +1
        [1-10]: bivectors (Grade 2) -> -1
        [11-15]: quadvectors (Grade 4) -> +1

    Args:
        motor: Motor, shape (..., 16)

    Returns:
        Reversed motor, shape (..., 16)
    """
    # Grade 0: keep sign
    r0 = motor[..., 0]

    # Grade 2 (10 components): negate
    r1 = -motor[..., 1]
    r2 = -motor[..., 2]
    r3 = -motor[..., 3]
    r4 = -motor[..., 4]
    r5 = -motor[..., 5]
    r6 = -motor[..., 6]
    r7 = -motor[..., 7]
    r8 = -motor[..., 8]
    r9 = -motor[..., 9]
    r10 = -motor[..., 10]

    # Grade 4 (5 components): keep sign
    r11 = motor[..., 11]
    r12 = motor[..., 12]
    r13 = motor[..., 13]
    r14 = motor[..., 14]
    r15 = motor[..., 15]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7, r8, r9, r10, r11, r12, r13, r14, r15
    ], dim=-1)


@torch.jit.script
def sandwich_product_sparse(motor: Tensor, point: Tensor) -> Tensor:
    """
    Compute sparse sandwich product: M × X × M̃

    Optimized for:
        - Motor M: 16 components (Grade 0, 2, 4)
        - Point X: 5 components (Grade 1)
        - Output: 5 components (Grade 1)

    Args:
        motor: Motor, shape (..., 16)
               [scalar, e12, e13, e1+, e1-, e23, e2+, e2-, e3+, e3-, e+-,
                e123+, e123-, e12+-, e13+-, e23+-]
        point: UPGC point, shape (..., 5)
               [e1, e2, e3, e+, e-]

    Returns:
        Transformed point, shape (..., 5)

    Note:
        Total multiplications: 800 (vs 2048 for full)
    """
    # Motor components (sparse)
    m0 = motor[..., 0]    # scalar
    m1 = motor[..., 1]    # e12
    m2 = motor[..., 2]    # e13
    m3 = motor[..., 3]    # e1+
    m4 = motor[..., 4]    # e1-
    m5 = motor[..., 5]    # e23
    m6 = motor[..., 6]    # e2+
    m7 = motor[..., 7]    # e2-
    m8 = motor[..., 8]    # e3+
    m9 = motor[..., 9]    # e3-
    m10 = motor[..., 10]  # e+-
    m11 = motor[..., 11]  # e123+
    m12 = motor[..., 12]  # e123-
    m13 = motor[..., 13]  # e12+-
    m14 = motor[..., 14]  # e13+-
    m15 = motor[..., 15]  # e23+-

    # Point components (sparse)
    p0 = point[..., 0]  # e1
    p1 = point[..., 1]  # e2
    p2 = point[..., 2]  # e3
    p3 = point[..., 3]  # e+
    p4 = point[..., 4]  # e-

    # Motor reverse (Grade 2 negated)
    mr0 = m0
    mr1 = -m1
    mr2 = -m2
    mr3 = -m3
    mr4 = -m4
    mr5 = -m5
    mr6 = -m6
    mr7 = -m7
    mr8 = -m8
    mr9 = -m9
    mr10 = -m10
    mr11 = m11
    mr12 = m12
    mr13 = m13
    mr14 = m14
    mr15 = m15

    # Output r0 (blade 1): 80 terms
    r0 = (
        m0 * p0 * mr0 +
        -m0 * p1 * mr1 +
        -m0 * p2 * mr2 +
        -m0 * p3 * mr3 +
        m0 * p4 * mr4 +
        m1 * p0 * mr1 +
        m1 * p1 * mr0 +
        -m1 * p2 * mr5 +
        -m1 * p3 * mr6 +
        m1 * p4 * mr7 +
        m2 * p0 * mr2 +
        m2 * p1 * mr5 +
        m2 * p2 * mr0 +
        -m2 * p3 * mr8 +
        m2 * p4 * mr9 +
        m3 * p0 * mr3 +
        m3 * p1 * mr6 +
        m3 * p2 * mr8 +
        m3 * p3 * mr0 +
        m3 * p4 * mr10 +
        -m4 * p0 * mr4 +
        -m4 * p1 * mr7 +
        -m4 * p2 * mr9 +
        -m4 * p3 * mr10 +
        -m4 * p4 * mr0 +
        -m5 * p0 * mr5 +
        m5 * p1 * mr2 +
        -m5 * p2 * mr1 +
        m5 * p3 * mr11 +
        -m5 * p4 * mr12 +
        -m6 * p0 * mr6 +
        m6 * p1 * mr3 +
        -m6 * p2 * mr11 +
        -m6 * p3 * mr1 +
        -m6 * p4 * mr13 +
        m7 * p0 * mr7 +
        -m7 * p1 * mr4 +
        m7 * p2 * mr12 +
        m7 * p3 * mr13 +
        m7 * p4 * mr1 +
        -m8 * p0 * mr8 +
        m8 * p1 * mr11 +
        m8 * p2 * mr3 +
        -m8 * p3 * mr2 +
        -m8 * p4 * mr14 +
        m9 * p0 * mr9 +
        -m9 * p1 * mr12 +
        -m9 * p2 * mr4 +
        m9 * p3 * mr14 +
        m9 * p4 * mr2 +
        m10 * p0 * mr10 +
        -m10 * p1 * mr13 +
        -m10 * p2 * mr14 +
        -m10 * p3 * mr4 +
        m10 * p4 * mr3 +
        -m11 * p0 * mr11 +
        -m11 * p1 * mr8 +
        m11 * p2 * mr6 +
        -m11 * p3 * mr5 +
        -m11 * p4 * mr15 +
        m12 * p0 * mr12 +
        m12 * p1 * mr9 +
        -m12 * p2 * mr7 +
        m12 * p3 * mr15 +
        m12 * p4 * mr5 +
        m13 * p0 * mr13 +
        m13 * p1 * mr10 +
        -m13 * p2 * mr15 +
        -m13 * p3 * mr7 +
        m13 * p4 * mr6 +
        m14 * p0 * mr14 +
        m14 * p1 * mr15 +
        m14 * p2 * mr10 +
        -m14 * p3 * mr9 +
        m14 * p4 * mr8 +
        -m15 * p0 * mr15 +
        m15 * p1 * mr14 +
        -m15 * p2 * mr13 +
        m15 * p3 * mr12 +
        -m15 * p4 * mr11
    )

    # Output r1 (blade 2): 80 terms
    r1 = (
        m0 * p0 * mr1 +
        m0 * p1 * mr0 +
        -m0 * p2 * mr5 +
        -m0 * p3 * mr6 +
        m0 * p4 * mr7 +
        -m1 * p0 * mr0 +
        m1 * p1 * mr1 +
        m1 * p2 * mr2 +
        m1 * p3 * mr3 +
        -m1 * p4 * mr4 +
        m2 * p0 * mr5 +
        -m2 * p1 * mr2 +
        m2 * p2 * mr1 +
        -m2 * p3 * mr11 +
        m2 * p4 * mr12 +
        m3 * p0 * mr6 +
        -m3 * p1 * mr3 +
        m3 * p2 * mr11 +
        m3 * p3 * mr1 +
        m3 * p4 * mr13 +
        -m4 * p0 * mr7 +
        m4 * p1 * mr4 +
        -m4 * p2 * mr12 +
        -m4 * p3 * mr13 +
        -m4 * p4 * mr1 +
        m5 * p0 * mr2 +
        m5 * p1 * mr5 +
        m5 * p2 * mr0 +
        -m5 * p3 * mr8 +
        m5 * p4 * mr9 +
        m6 * p0 * mr3 +
        m6 * p1 * mr6 +
        m6 * p2 * mr8 +
        m6 * p3 * mr0 +
        m6 * p4 * mr10 +
        -m7 * p0 * mr4 +
        -m7 * p1 * mr7 +
        -m7 * p2 * mr9 +
        -m7 * p3 * mr10 +
        -m7 * p4 * mr0 +
        -m8 * p0 * mr11 +
        -m8 * p1 * mr8 +
        m8 * p2 * mr6 +
        -m8 * p3 * mr5 +
        -m8 * p4 * mr15 +
        m9 * p0 * mr12 +
        m9 * p1 * mr9 +
        -m9 * p2 * mr7 +
        m9 * p3 * mr15 +
        m9 * p4 * mr5 +
        m10 * p0 * mr13 +
        m10 * p1 * mr10 +
        -m10 * p2 * mr15 +
        -m10 * p3 * mr7 +
        m10 * p4 * mr6 +
        m11 * p0 * mr8 +
        -m11 * p1 * mr11 +
        -m11 * p2 * mr3 +
        m11 * p3 * mr2 +
        m11 * p4 * mr14 +
        -m12 * p0 * mr9 +
        m12 * p1 * mr12 +
        m12 * p2 * mr4 +
        -m12 * p3 * mr14 +
        -m12 * p4 * mr2 +
        -m13 * p0 * mr10 +
        m13 * p1 * mr13 +
        m13 * p2 * mr14 +
        m13 * p3 * mr4 +
        -m13 * p4 * mr3 +
        m14 * p0 * mr15 +
        -m14 * p1 * mr14 +
        m14 * p2 * mr13 +
        -m14 * p3 * mr12 +
        m14 * p4 * mr11 +
        m15 * p0 * mr14 +
        m15 * p1 * mr15 +
        m15 * p2 * mr10 +
        -m15 * p3 * mr9 +
        m15 * p4 * mr8
    )

    # Output r2 (blade 3): 80 terms
    r2 = (
        m0 * p0 * mr2 +
        m0 * p1 * mr5 +
        m0 * p2 * mr0 +
        -m0 * p3 * mr8 +
        m0 * p4 * mr9 +
        -m1 * p0 * mr5 +
        m1 * p1 * mr2 +
        -m1 * p2 * mr1 +
        m1 * p3 * mr11 +
        -m1 * p4 * mr12 +
        -m2 * p0 * mr0 +
        m2 * p1 * mr1 +
        m2 * p2 * mr2 +
        m2 * p3 * mr3 +
        -m2 * p4 * mr4 +
        m3 * p0 * mr8 +
        -m3 * p1 * mr11 +
        -m3 * p2 * mr3 +
        m3 * p3 * mr2 +
        m3 * p4 * mr14 +
        -m4 * p0 * mr9 +
        m4 * p1 * mr12 +
        m4 * p2 * mr4 +
        -m4 * p3 * mr14 +
        -m4 * p4 * mr2 +
        -m5 * p0 * mr1 +
        -m5 * p1 * mr0 +
        m5 * p2 * mr5 +
        m5 * p3 * mr6 +
        -m5 * p4 * mr7 +
        m6 * p0 * mr11 +
        m6 * p1 * mr8 +
        -m6 * p2 * mr6 +
        m6 * p3 * mr5 +
        m6 * p4 * mr15 +
        -m7 * p0 * mr12 +
        -m7 * p1 * mr9 +
        m7 * p2 * mr7 +
        -m7 * p3 * mr15 +
        -m7 * p4 * mr5 +
        m8 * p0 * mr3 +
        m8 * p1 * mr6 +
        m8 * p2 * mr8 +
        m8 * p3 * mr0 +
        m8 * p4 * mr10 +
        -m9 * p0 * mr4 +
        -m9 * p1 * mr7 +
        -m9 * p2 * mr9 +
        -m9 * p3 * mr10 +
        -m9 * p4 * mr0 +
        m10 * p0 * mr14 +
        m10 * p1 * mr15 +
        m10 * p2 * mr10 +
        -m10 * p3 * mr9 +
        m10 * p4 * mr8 +
        -m11 * p0 * mr6 +
        m11 * p1 * mr3 +
        -m11 * p2 * mr11 +
        -m11 * p3 * mr1 +
        -m11 * p4 * mr13 +
        m12 * p0 * mr7 +
        -m12 * p1 * mr4 +
        m12 * p2 * mr12 +
        m12 * p3 * mr13 +
        m12 * p4 * mr1 +
        -m13 * p0 * mr15 +
        m13 * p1 * mr14 +
        -m13 * p2 * mr13 +
        m13 * p3 * mr12 +
        -m13 * p4 * mr11 +
        -m14 * p0 * mr10 +
        m14 * p1 * mr13 +
        m14 * p2 * mr14 +
        m14 * p3 * mr4 +
        -m14 * p4 * mr3 +
        -m15 * p0 * mr13 +
        -m15 * p1 * mr10 +
        m15 * p2 * mr15 +
        m15 * p3 * mr7 +
        -m15 * p4 * mr6
    )

    # Output r3 (blade 4): 80 terms
    r3 = (
        m0 * p0 * mr3 +
        m0 * p1 * mr6 +
        m0 * p2 * mr8 +
        m0 * p3 * mr0 +
        m0 * p4 * mr10 +
        -m1 * p0 * mr6 +
        m1 * p1 * mr3 +
        -m1 * p2 * mr11 +
        -m1 * p3 * mr1 +
        -m1 * p4 * mr13 +
        -m2 * p0 * mr8 +
        m2 * p1 * mr11 +
        m2 * p2 * mr3 +
        -m2 * p3 * mr2 +
        -m2 * p4 * mr14 +
        -m3 * p0 * mr0 +
        m3 * p1 * mr1 +
        m3 * p2 * mr2 +
        m3 * p3 * mr3 +
        -m3 * p4 * mr4 +
        -m4 * p0 * mr10 +
        m4 * p1 * mr13 +
        m4 * p2 * mr14 +
        m4 * p3 * mr4 +
        -m4 * p4 * mr3 +
        -m5 * p0 * mr11 +
        -m5 * p1 * mr8 +
        m5 * p2 * mr6 +
        -m5 * p3 * mr5 +
        -m5 * p4 * mr15 +
        -m6 * p0 * mr1 +
        -m6 * p1 * mr0 +
        m6 * p2 * mr5 +
        m6 * p3 * mr6 +
        -m6 * p4 * mr7 +
        -m7 * p0 * mr13 +
        -m7 * p1 * mr10 +
        m7 * p2 * mr15 +
        m7 * p3 * mr7 +
        -m7 * p4 * mr6 +
        -m8 * p0 * mr2 +
        -m8 * p1 * mr5 +
        -m8 * p2 * mr0 +
        m8 * p3 * mr8 +
        -m8 * p4 * mr9 +
        -m9 * p0 * mr14 +
        -m9 * p1 * mr15 +
        -m9 * p2 * mr10 +
        m9 * p3 * mr9 +
        -m9 * p4 * mr8 +
        -m10 * p0 * mr4 +
        -m10 * p1 * mr7 +
        -m10 * p2 * mr9 +
        -m10 * p3 * mr10 +
        -m10 * p4 * mr0 +
        m11 * p0 * mr5 +
        -m11 * p1 * mr2 +
        m11 * p2 * mr1 +
        -m11 * p3 * mr11 +
        m11 * p4 * mr12 +
        m12 * p0 * mr15 +
        -m12 * p1 * mr14 +
        m12 * p2 * mr13 +
        -m12 * p3 * mr12 +
        m12 * p4 * mr11 +
        m13 * p0 * mr7 +
        -m13 * p1 * mr4 +
        m13 * p2 * mr12 +
        m13 * p3 * mr13 +
        m13 * p4 * mr1 +
        m14 * p0 * mr9 +
        -m14 * p1 * mr12 +
        -m14 * p2 * mr4 +
        m14 * p3 * mr14 +
        m14 * p4 * mr2 +
        m15 * p0 * mr12 +
        m15 * p1 * mr9 +
        -m15 * p2 * mr7 +
        m15 * p3 * mr15 +
        m15 * p4 * mr5
    )

    # Output r4 (blade 5): 80 terms
    r4 = (
        m0 * p0 * mr4 +
        m0 * p1 * mr7 +
        m0 * p2 * mr9 +
        m0 * p3 * mr10 +
        m0 * p4 * mr0 +
        -m1 * p0 * mr7 +
        m1 * p1 * mr4 +
        -m1 * p2 * mr12 +
        -m1 * p3 * mr13 +
        -m1 * p4 * mr1 +
        -m2 * p0 * mr9 +
        m2 * p1 * mr12 +
        m2 * p2 * mr4 +
        -m2 * p3 * mr14 +
        -m2 * p4 * mr2 +
        -m3 * p0 * mr10 +
        m3 * p1 * mr13 +
        m3 * p2 * mr14 +
        m3 * p3 * mr4 +
        -m3 * p4 * mr3 +
        -m4 * p0 * mr0 +
        m4 * p1 * mr1 +
        m4 * p2 * mr2 +
        m4 * p3 * mr3 +
        -m4 * p4 * mr4 +
        -m5 * p0 * mr12 +
        -m5 * p1 * mr9 +
        m5 * p2 * mr7 +
        -m5 * p3 * mr15 +
        -m5 * p4 * mr5 +
        -m6 * p0 * mr13 +
        -m6 * p1 * mr10 +
        m6 * p2 * mr15 +
        m6 * p3 * mr7 +
        -m6 * p4 * mr6 +
        -m7 * p0 * mr1 +
        -m7 * p1 * mr0 +
        m7 * p2 * mr5 +
        m7 * p3 * mr6 +
        -m7 * p4 * mr7 +
        -m8 * p0 * mr14 +
        -m8 * p1 * mr15 +
        -m8 * p2 * mr10 +
        m8 * p3 * mr9 +
        -m8 * p4 * mr8 +
        -m9 * p0 * mr2 +
        -m9 * p1 * mr5 +
        -m9 * p2 * mr0 +
        m9 * p3 * mr8 +
        -m9 * p4 * mr9 +
        -m10 * p0 * mr3 +
        -m10 * p1 * mr6 +
        -m10 * p2 * mr8 +
        -m10 * p3 * mr0 +
        -m10 * p4 * mr10 +
        m11 * p0 * mr15 +
        -m11 * p1 * mr14 +
        m11 * p2 * mr13 +
        -m11 * p3 * mr12 +
        m11 * p4 * mr11 +
        m12 * p0 * mr5 +
        -m12 * p1 * mr2 +
        m12 * p2 * mr1 +
        -m12 * p3 * mr11 +
        m12 * p4 * mr12 +
        m13 * p0 * mr6 +
        -m13 * p1 * mr3 +
        m13 * p2 * mr11 +
        m13 * p3 * mr1 +
        m13 * p4 * mr13 +
        m14 * p0 * mr8 +
        -m14 * p1 * mr11 +
        -m14 * p2 * mr3 +
        m14 * p3 * mr2 +
        m14 * p4 * mr14 +
        m15 * p0 * mr11 +
        m15 * p1 * mr8 +
        -m15 * p2 * mr6 +
        m15 * p3 * mr5 +
        m15 * p4 * mr15
    )

    return torch.stack([r0, r1, r2, r3, r4], dim=-1)

