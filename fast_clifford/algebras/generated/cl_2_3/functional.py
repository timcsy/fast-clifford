"""
Clifford Algebra Cl(2, 3) Functional Operations - Auto-generated

DO NOT EDIT MANUALLY - This file is generated by codegen/generator.py

Generated: 2025-12-19 10:34:11
Signature: Cl(2, 3)
Blade count: 32
Rotor count: 16
Bivector count: 10
Algebra type: general

All functions are:
- Loop-free (fully expanded arithmetic)
- ONNX-compatible (only Add/Mul/Neg/Sub operations)
- torch.jit.script compatible
"""

import torch
from torch import Tensor
from typing import Tuple


# =============================================================================
# Constants
# =============================================================================

BLADE_COUNT = 32
ROTOR_COUNT = 16
BIVECTOR_COUNT = 10

# Blade indices by grade
GRADE_0_INDICES = (0,)
GRADE_1_INDICES = (1, 2, 3, 4, 5)
GRADE_2_INDICES = (6, 7, 8, 9, 10, 11, 12, 13, 14, 15)
GRADE_3_INDICES = (16, 17, 18, 19, 20, 21, 22, 23, 24, 25)
GRADE_4_INDICES = (26, 27, 28, 29, 30)
GRADE_5_INDICES = (31,)

# Rotor (even-grade) indices
ROTOR_MASK = (0, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 26, 27, 28, 29, 30)

# Bivector (grade-2) indices
BIVECTOR_MASK = (6, 7, 8, 9, 10, 11, 12, 13, 14, 15)

# Vector (grade-1) indices
VECTOR_MASK = (1, 2, 3, 4, 5)

# Reverse signs for all blades
REVERSE_SIGNS = (1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1)

# Involute signs for all blades
INVOLUTE_SIGNS = (1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, -1)

# Conjugate signs for all blades
CONJUGATE_SIGNS = (1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1)

# Inner product signs (bladeÂ² values)
INNER_PRODUCT_SIGNS = (1, 1, 1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, -1, -1, -1, 1, 1, 1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, -1, -1, -1)

# Pseudoscalar info
PSEUDOSCALAR_INDEX = 31
PSEUDOSCALAR_SQUARE = -1

# =============================================================================
# Geometric Product
# =============================================================================

@torch.jit.script
def geometric_product(a: Tensor, b: Tensor) -> Tensor:
    """
    Compute geometric product of two multivectors in Cl(2, 3).

    Args:
        a: Left operand, shape (..., 32)
        b: Right operand, shape (..., 32)

    Returns:
        Result multivector, shape (..., 32)
    """
    r0 = (
        a[..., 0] * b[..., 0] +
        a[..., 1] * b[..., 1] +
        a[..., 2] * b[..., 2] +
        -a[..., 3] * b[..., 3] +
        -a[..., 4] * b[..., 4] +
        -a[..., 5] * b[..., 5] +
        -a[..., 6] * b[..., 6] +
        a[..., 7] * b[..., 7] +
        a[..., 8] * b[..., 8] +
        a[..., 9] * b[..., 9] +
        a[..., 10] * b[..., 10] +
        a[..., 11] * b[..., 11] +
        a[..., 12] * b[..., 12] +
        -a[..., 13] * b[..., 13] +
        -a[..., 14] * b[..., 14] +
        -a[..., 15] * b[..., 15] +
        a[..., 16] * b[..., 16] +
        a[..., 17] * b[..., 17] +
        a[..., 18] * b[..., 18] +
        -a[..., 19] * b[..., 19] +
        -a[..., 20] * b[..., 20] +
        -a[..., 21] * b[..., 21] +
        -a[..., 22] * b[..., 22] +
        -a[..., 23] * b[..., 23] +
        -a[..., 24] * b[..., 24] +
        a[..., 25] * b[..., 25] +
        a[..., 26] * b[..., 26] +
        a[..., 27] * b[..., 27] +
        a[..., 28] * b[..., 28] +
        -a[..., 29] * b[..., 29] +
        -a[..., 30] * b[..., 30] +
        -a[..., 31] * b[..., 31]
    )
    r1 = (
        a[..., 0] * b[..., 1] +
        a[..., 1] * b[..., 0] +
        -a[..., 2] * b[..., 6] +
        a[..., 3] * b[..., 7] +
        a[..., 4] * b[..., 8] +
        a[..., 5] * b[..., 9] +
        a[..., 6] * b[..., 2] +
        -a[..., 7] * b[..., 3] +
        -a[..., 8] * b[..., 4] +
        -a[..., 9] * b[..., 5] +
        a[..., 10] * b[..., 16] +
        a[..., 11] * b[..., 17] +
        a[..., 12] * b[..., 18] +
        -a[..., 13] * b[..., 19] +
        -a[..., 14] * b[..., 20] +
        -a[..., 15] * b[..., 21] +
        a[..., 16] * b[..., 10] +
        a[..., 17] * b[..., 11] +
        a[..., 18] * b[..., 12] +
        -a[..., 19] * b[..., 13] +
        -a[..., 20] * b[..., 14] +
        -a[..., 21] * b[..., 15] +
        a[..., 22] * b[..., 26] +
        a[..., 23] * b[..., 27] +
        a[..., 24] * b[..., 28] +
        -a[..., 25] * b[..., 29] +
        -a[..., 26] * b[..., 22] +
        -a[..., 27] * b[..., 23] +
        -a[..., 28] * b[..., 24] +
        a[..., 29] * b[..., 25] +
        -a[..., 30] * b[..., 31] +
        -a[..., 31] * b[..., 30]
    )
    r2 = (
        a[..., 0] * b[..., 2] +
        a[..., 1] * b[..., 6] +
        a[..., 2] * b[..., 0] +
        a[..., 3] * b[..., 10] +
        a[..., 4] * b[..., 11] +
        a[..., 5] * b[..., 12] +
        -a[..., 6] * b[..., 1] +
        -a[..., 7] * b[..., 16] +
        -a[..., 8] * b[..., 17] +
        -a[..., 9] * b[..., 18] +
        -a[..., 10] * b[..., 3] +
        -a[..., 11] * b[..., 4] +
        -a[..., 12] * b[..., 5] +
        -a[..., 13] * b[..., 22] +
        -a[..., 14] * b[..., 23] +
        -a[..., 15] * b[..., 24] +
        -a[..., 16] * b[..., 7] +
        -a[..., 17] * b[..., 8] +
        -a[..., 18] * b[..., 9] +
        -a[..., 19] * b[..., 26] +
        -a[..., 20] * b[..., 27] +
        -a[..., 21] * b[..., 28] +
        -a[..., 22] * b[..., 13] +
        -a[..., 23] * b[..., 14] +
        -a[..., 24] * b[..., 15] +
        -a[..., 25] * b[..., 30] +
        a[..., 26] * b[..., 19] +
        a[..., 27] * b[..., 20] +
        a[..., 28] * b[..., 21] +
        a[..., 29] * b[..., 31] +
        a[..., 30] * b[..., 25] +
        a[..., 31] * b[..., 29]
    )
    r3 = (
        a[..., 0] * b[..., 3] +
        a[..., 1] * b[..., 7] +
        a[..., 2] * b[..., 10] +
        a[..., 3] * b[..., 0] +
        a[..., 4] * b[..., 13] +
        a[..., 5] * b[..., 14] +
        -a[..., 6] * b[..., 16] +
        -a[..., 7] * b[..., 1] +
        -a[..., 8] * b[..., 19] +
        -a[..., 9] * b[..., 20] +
        -a[..., 10] * b[..., 2] +
        -a[..., 11] * b[..., 22] +
        -a[..., 12] * b[..., 23] +
        -a[..., 13] * b[..., 4] +
        -a[..., 14] * b[..., 5] +
        -a[..., 15] * b[..., 25] +
        -a[..., 16] * b[..., 6] +
        -a[..., 17] * b[..., 26] +
        -a[..., 18] * b[..., 27] +
        -a[..., 19] * b[..., 8] +
        -a[..., 20] * b[..., 9] +
        -a[..., 21] * b[..., 29] +
        -a[..., 22] * b[..., 11] +
        -a[..., 23] * b[..., 12] +
        -a[..., 24] * b[..., 30] +
        -a[..., 25] * b[..., 15] +
        a[..., 26] * b[..., 17] +
        a[..., 27] * b[..., 18] +
        a[..., 28] * b[..., 31] +
        a[..., 29] * b[..., 21] +
        a[..., 30] * b[..., 24] +
        a[..., 31] * b[..., 28]
    )
    r4 = (
        a[..., 0] * b[..., 4] +
        a[..., 1] * b[..., 8] +
        a[..., 2] * b[..., 11] +
        -a[..., 3] * b[..., 13] +
        a[..., 4] * b[..., 0] +
        a[..., 5] * b[..., 15] +
        -a[..., 6] * b[..., 17] +
        a[..., 7] * b[..., 19] +
        -a[..., 8] * b[..., 1] +
        -a[..., 9] * b[..., 21] +
        a[..., 10] * b[..., 22] +
        -a[..., 11] * b[..., 2] +
        -a[..., 12] * b[..., 24] +
        a[..., 13] * b[..., 3] +
        a[..., 14] * b[..., 25] +
        -a[..., 15] * b[..., 5] +
        a[..., 16] * b[..., 26] +
        -a[..., 17] * b[..., 6] +
        -a[..., 18] * b[..., 28] +
        a[..., 19] * b[..., 7] +
        a[..., 20] * b[..., 29] +
        -a[..., 21] * b[..., 9] +
        a[..., 22] * b[..., 10] +
        a[..., 23] * b[..., 30] +
        -a[..., 24] * b[..., 12] +
        a[..., 25] * b[..., 14] +
        -a[..., 26] * b[..., 16] +
        -a[..., 27] * b[..., 31] +
        a[..., 28] * b[..., 18] +
        -a[..., 29] * b[..., 20] +
        -a[..., 30] * b[..., 23] +
        -a[..., 31] * b[..., 27]
    )
    r5 = (
        a[..., 0] * b[..., 5] +
        a[..., 1] * b[..., 9] +
        a[..., 2] * b[..., 12] +
        -a[..., 3] * b[..., 14] +
        -a[..., 4] * b[..., 15] +
        a[..., 5] * b[..., 0] +
        -a[..., 6] * b[..., 18] +
        a[..., 7] * b[..., 20] +
        a[..., 8] * b[..., 21] +
        -a[..., 9] * b[..., 1] +
        a[..., 10] * b[..., 23] +
        a[..., 11] * b[..., 24] +
        -a[..., 12] * b[..., 2] +
        -a[..., 13] * b[..., 25] +
        a[..., 14] * b[..., 3] +
        a[..., 15] * b[..., 4] +
        a[..., 16] * b[..., 27] +
        a[..., 17] * b[..., 28] +
        -a[..., 18] * b[..., 6] +
        -a[..., 19] * b[..., 29] +
        a[..., 20] * b[..., 7] +
        a[..., 21] * b[..., 8] +
        -a[..., 22] * b[..., 30] +
        a[..., 23] * b[..., 10] +
        a[..., 24] * b[..., 11] +
        -a[..., 25] * b[..., 13] +
        a[..., 26] * b[..., 31] +
        -a[..., 27] * b[..., 16] +
        -a[..., 28] * b[..., 17] +
        a[..., 29] * b[..., 19] +
        a[..., 30] * b[..., 22] +
        a[..., 31] * b[..., 26]
    )
    r6 = (
        a[..., 0] * b[..., 6] +
        a[..., 1] * b[..., 2] +
        -a[..., 2] * b[..., 1] +
        -a[..., 3] * b[..., 16] +
        -a[..., 4] * b[..., 17] +
        -a[..., 5] * b[..., 18] +
        a[..., 6] * b[..., 0] +
        a[..., 7] * b[..., 10] +
        a[..., 8] * b[..., 11] +
        a[..., 9] * b[..., 12] +
        -a[..., 10] * b[..., 7] +
        -a[..., 11] * b[..., 8] +
        -a[..., 12] * b[..., 9] +
        -a[..., 13] * b[..., 26] +
        -a[..., 14] * b[..., 27] +
        -a[..., 15] * b[..., 28] +
        -a[..., 16] * b[..., 3] +
        -a[..., 17] * b[..., 4] +
        -a[..., 18] * b[..., 5] +
        -a[..., 19] * b[..., 22] +
        -a[..., 20] * b[..., 23] +
        -a[..., 21] * b[..., 24] +
        a[..., 22] * b[..., 19] +
        a[..., 23] * b[..., 20] +
        a[..., 24] * b[..., 21] +
        a[..., 25] * b[..., 31] +
        -a[..., 26] * b[..., 13] +
        -a[..., 27] * b[..., 14] +
        -a[..., 28] * b[..., 15] +
        -a[..., 29] * b[..., 30] +
        a[..., 30] * b[..., 29] +
        a[..., 31] * b[..., 25]
    )
    r7 = (
        a[..., 0] * b[..., 7] +
        a[..., 1] * b[..., 3] +
        -a[..., 2] * b[..., 16] +
        -a[..., 3] * b[..., 1] +
        -a[..., 4] * b[..., 19] +
        -a[..., 5] * b[..., 20] +
        a[..., 6] * b[..., 10] +
        a[..., 7] * b[..., 0] +
        a[..., 8] * b[..., 13] +
        a[..., 9] * b[..., 14] +
        -a[..., 10] * b[..., 6] +
        -a[..., 11] * b[..., 26] +
        -a[..., 12] * b[..., 27] +
        -a[..., 13] * b[..., 8] +
        -a[..., 14] * b[..., 9] +
        -a[..., 15] * b[..., 29] +
        -a[..., 16] * b[..., 2] +
        -a[..., 17] * b[..., 22] +
        -a[..., 18] * b[..., 23] +
        -a[..., 19] * b[..., 4] +
        -a[..., 20] * b[..., 5] +
        -a[..., 21] * b[..., 25] +
        a[..., 22] * b[..., 17] +
        a[..., 23] * b[..., 18] +
        a[..., 24] * b[..., 31] +
        a[..., 25] * b[..., 21] +
        -a[..., 26] * b[..., 11] +
        -a[..., 27] * b[..., 12] +
        -a[..., 28] * b[..., 30] +
        -a[..., 29] * b[..., 15] +
        a[..., 30] * b[..., 28] +
        a[..., 31] * b[..., 24]
    )
    r8 = (
        a[..., 0] * b[..., 8] +
        a[..., 1] * b[..., 4] +
        -a[..., 2] * b[..., 17] +
        a[..., 3] * b[..., 19] +
        -a[..., 4] * b[..., 1] +
        -a[..., 5] * b[..., 21] +
        a[..., 6] * b[..., 11] +
        -a[..., 7] * b[..., 13] +
        a[..., 8] * b[..., 0] +
        a[..., 9] * b[..., 15] +
        a[..., 10] * b[..., 26] +
        -a[..., 11] * b[..., 6] +
        -a[..., 12] * b[..., 28] +
        a[..., 13] * b[..., 7] +
        a[..., 14] * b[..., 29] +
        -a[..., 15] * b[..., 9] +
        a[..., 16] * b[..., 22] +
        -a[..., 17] * b[..., 2] +
        -a[..., 18] * b[..., 24] +
        a[..., 19] * b[..., 3] +
        a[..., 20] * b[..., 25] +
        -a[..., 21] * b[..., 5] +
        -a[..., 22] * b[..., 16] +
        -a[..., 23] * b[..., 31] +
        a[..., 24] * b[..., 18] +
        -a[..., 25] * b[..., 20] +
        a[..., 26] * b[..., 10] +
        a[..., 27] * b[..., 30] +
        -a[..., 28] * b[..., 12] +
        a[..., 29] * b[..., 14] +
        -a[..., 30] * b[..., 27] +
        -a[..., 31] * b[..., 23]
    )
    r9 = (
        a[..., 0] * b[..., 9] +
        a[..., 1] * b[..., 5] +
        -a[..., 2] * b[..., 18] +
        a[..., 3] * b[..., 20] +
        a[..., 4] * b[..., 21] +
        -a[..., 5] * b[..., 1] +
        a[..., 6] * b[..., 12] +
        -a[..., 7] * b[..., 14] +
        -a[..., 8] * b[..., 15] +
        a[..., 9] * b[..., 0] +
        a[..., 10] * b[..., 27] +
        a[..., 11] * b[..., 28] +
        -a[..., 12] * b[..., 6] +
        -a[..., 13] * b[..., 29] +
        a[..., 14] * b[..., 7] +
        a[..., 15] * b[..., 8] +
        a[..., 16] * b[..., 23] +
        a[..., 17] * b[..., 24] +
        -a[..., 18] * b[..., 2] +
        -a[..., 19] * b[..., 25] +
        a[..., 20] * b[..., 3] +
        a[..., 21] * b[..., 4] +
        a[..., 22] * b[..., 31] +
        -a[..., 23] * b[..., 16] +
        -a[..., 24] * b[..., 17] +
        a[..., 25] * b[..., 19] +
        -a[..., 26] * b[..., 30] +
        a[..., 27] * b[..., 10] +
        a[..., 28] * b[..., 11] +
        -a[..., 29] * b[..., 13] +
        a[..., 30] * b[..., 26] +
        a[..., 31] * b[..., 22]
    )
    r10 = (
        a[..., 0] * b[..., 10] +
        a[..., 1] * b[..., 16] +
        a[..., 2] * b[..., 3] +
        -a[..., 3] * b[..., 2] +
        -a[..., 4] * b[..., 22] +
        -a[..., 5] * b[..., 23] +
        -a[..., 6] * b[..., 7] +
        a[..., 7] * b[..., 6] +
        a[..., 8] * b[..., 26] +
        a[..., 9] * b[..., 27] +
        a[..., 10] * b[..., 0] +
        a[..., 11] * b[..., 13] +
        a[..., 12] * b[..., 14] +
        -a[..., 13] * b[..., 11] +
        -a[..., 14] * b[..., 12] +
        -a[..., 15] * b[..., 30] +
        a[..., 16] * b[..., 1] +
        a[..., 17] * b[..., 19] +
        a[..., 18] * b[..., 20] +
        -a[..., 19] * b[..., 17] +
        -a[..., 20] * b[..., 18] +
        -a[..., 21] * b[..., 31] +
        -a[..., 22] * b[..., 4] +
        -a[..., 23] * b[..., 5] +
        -a[..., 24] * b[..., 25] +
        a[..., 25] * b[..., 24] +
        a[..., 26] * b[..., 8] +
        a[..., 27] * b[..., 9] +
        a[..., 28] * b[..., 29] +
        -a[..., 29] * b[..., 28] +
        -a[..., 30] * b[..., 15] +
        -a[..., 31] * b[..., 21]
    )
    r11 = (
        a[..., 0] * b[..., 11] +
        a[..., 1] * b[..., 17] +
        a[..., 2] * b[..., 4] +
        a[..., 3] * b[..., 22] +
        -a[..., 4] * b[..., 2] +
        -a[..., 5] * b[..., 24] +
        -a[..., 6] * b[..., 8] +
        -a[..., 7] * b[..., 26] +
        a[..., 8] * b[..., 6] +
        a[..., 9] * b[..., 28] +
        -a[..., 10] * b[..., 13] +
        a[..., 11] * b[..., 0] +
        a[..., 12] * b[..., 15] +
        a[..., 13] * b[..., 10] +
        a[..., 14] * b[..., 30] +
        -a[..., 15] * b[..., 12] +
        -a[..., 16] * b[..., 19] +
        a[..., 17] * b[..., 1] +
        a[..., 18] * b[..., 21] +
        a[..., 19] * b[..., 16] +
        a[..., 20] * b[..., 31] +
        -a[..., 21] * b[..., 18] +
        a[..., 22] * b[..., 3] +
        a[..., 23] * b[..., 25] +
        -a[..., 24] * b[..., 5] +
        -a[..., 25] * b[..., 23] +
        -a[..., 26] * b[..., 7] +
        -a[..., 27] * b[..., 29] +
        a[..., 28] * b[..., 9] +
        a[..., 29] * b[..., 27] +
        a[..., 30] * b[..., 14] +
        a[..., 31] * b[..., 20]
    )
    r12 = (
        a[..., 0] * b[..., 12] +
        a[..., 1] * b[..., 18] +
        a[..., 2] * b[..., 5] +
        a[..., 3] * b[..., 23] +
        a[..., 4] * b[..., 24] +
        -a[..., 5] * b[..., 2] +
        -a[..., 6] * b[..., 9] +
        -a[..., 7] * b[..., 27] +
        -a[..., 8] * b[..., 28] +
        a[..., 9] * b[..., 6] +
        -a[..., 10] * b[..., 14] +
        -a[..., 11] * b[..., 15] +
        a[..., 12] * b[..., 0] +
        -a[..., 13] * b[..., 30] +
        a[..., 14] * b[..., 10] +
        a[..., 15] * b[..., 11] +
        -a[..., 16] * b[..., 20] +
        -a[..., 17] * b[..., 21] +
        a[..., 18] * b[..., 1] +
        -a[..., 19] * b[..., 31] +
        a[..., 20] * b[..., 16] +
        a[..., 21] * b[..., 17] +
        -a[..., 22] * b[..., 25] +
        a[..., 23] * b[..., 3] +
        a[..., 24] * b[..., 4] +
        a[..., 25] * b[..., 22] +
        a[..., 26] * b[..., 29] +
        -a[..., 27] * b[..., 7] +
        -a[..., 28] * b[..., 8] +
        -a[..., 29] * b[..., 26] +
        -a[..., 30] * b[..., 13] +
        -a[..., 31] * b[..., 19]
    )
    r13 = (
        a[..., 0] * b[..., 13] +
        a[..., 1] * b[..., 19] +
        a[..., 2] * b[..., 22] +
        a[..., 3] * b[..., 4] +
        -a[..., 4] * b[..., 3] +
        -a[..., 5] * b[..., 25] +
        -a[..., 6] * b[..., 26] +
        -a[..., 7] * b[..., 8] +
        a[..., 8] * b[..., 7] +
        a[..., 9] * b[..., 29] +
        -a[..., 10] * b[..., 11] +
        a[..., 11] * b[..., 10] +
        a[..., 12] * b[..., 30] +
        a[..., 13] * b[..., 0] +
        a[..., 14] * b[..., 15] +
        -a[..., 15] * b[..., 14] +
        -a[..., 16] * b[..., 17] +
        a[..., 17] * b[..., 16] +
        a[..., 18] * b[..., 31] +
        a[..., 19] * b[..., 1] +
        a[..., 20] * b[..., 21] +
        -a[..., 21] * b[..., 20] +
        a[..., 22] * b[..., 2] +
        a[..., 23] * b[..., 24] +
        -a[..., 24] * b[..., 23] +
        -a[..., 25] * b[..., 5] +
        -a[..., 26] * b[..., 6] +
        -a[..., 27] * b[..., 28] +
        a[..., 28] * b[..., 27] +
        a[..., 29] * b[..., 9] +
        a[..., 30] * b[..., 12] +
        a[..., 31] * b[..., 18]
    )
    r14 = (
        a[..., 0] * b[..., 14] +
        a[..., 1] * b[..., 20] +
        a[..., 2] * b[..., 23] +
        a[..., 3] * b[..., 5] +
        a[..., 4] * b[..., 25] +
        -a[..., 5] * b[..., 3] +
        -a[..., 6] * b[..., 27] +
        -a[..., 7] * b[..., 9] +
        -a[..., 8] * b[..., 29] +
        a[..., 9] * b[..., 7] +
        -a[..., 10] * b[..., 12] +
        -a[..., 11] * b[..., 30] +
        a[..., 12] * b[..., 10] +
        -a[..., 13] * b[..., 15] +
        a[..., 14] * b[..., 0] +
        a[..., 15] * b[..., 13] +
        -a[..., 16] * b[..., 18] +
        -a[..., 17] * b[..., 31] +
        a[..., 18] * b[..., 16] +
        -a[..., 19] * b[..., 21] +
        a[..., 20] * b[..., 1] +
        a[..., 21] * b[..., 19] +
        -a[..., 22] * b[..., 24] +
        a[..., 23] * b[..., 2] +
        a[..., 24] * b[..., 22] +
        a[..., 25] * b[..., 4] +
        a[..., 26] * b[..., 28] +
        -a[..., 27] * b[..., 6] +
        -a[..., 28] * b[..., 26] +
        -a[..., 29] * b[..., 8] +
        -a[..., 30] * b[..., 11] +
        -a[..., 31] * b[..., 17]
    )
    r15 = (
        a[..., 0] * b[..., 15] +
        a[..., 1] * b[..., 21] +
        a[..., 2] * b[..., 24] +
        -a[..., 3] * b[..., 25] +
        a[..., 4] * b[..., 5] +
        -a[..., 5] * b[..., 4] +
        -a[..., 6] * b[..., 28] +
        a[..., 7] * b[..., 29] +
        -a[..., 8] * b[..., 9] +
        a[..., 9] * b[..., 8] +
        a[..., 10] * b[..., 30] +
        -a[..., 11] * b[..., 12] +
        a[..., 12] * b[..., 11] +
        a[..., 13] * b[..., 14] +
        -a[..., 14] * b[..., 13] +
        a[..., 15] * b[..., 0] +
        a[..., 16] * b[..., 31] +
        -a[..., 17] * b[..., 18] +
        a[..., 18] * b[..., 17] +
        a[..., 19] * b[..., 20] +
        -a[..., 20] * b[..., 19] +
        a[..., 21] * b[..., 1] +
        a[..., 22] * b[..., 23] +
        -a[..., 23] * b[..., 22] +
        a[..., 24] * b[..., 2] +
        -a[..., 25] * b[..., 3] +
        -a[..., 26] * b[..., 27] +
        a[..., 27] * b[..., 26] +
        -a[..., 28] * b[..., 6] +
        a[..., 29] * b[..., 7] +
        a[..., 30] * b[..., 10] +
        a[..., 31] * b[..., 16]
    )
    r16 = (
        a[..., 0] * b[..., 16] +
        a[..., 1] * b[..., 10] +
        -a[..., 2] * b[..., 7] +
        a[..., 3] * b[..., 6] +
        a[..., 4] * b[..., 26] +
        a[..., 5] * b[..., 27] +
        a[..., 6] * b[..., 3] +
        -a[..., 7] * b[..., 2] +
        -a[..., 8] * b[..., 22] +
        -a[..., 9] * b[..., 23] +
        a[..., 10] * b[..., 1] +
        a[..., 11] * b[..., 19] +
        a[..., 12] * b[..., 20] +
        -a[..., 13] * b[..., 17] +
        -a[..., 14] * b[..., 18] +
        -a[..., 15] * b[..., 31] +
        a[..., 16] * b[..., 0] +
        a[..., 17] * b[..., 13] +
        a[..., 18] * b[..., 14] +
        -a[..., 19] * b[..., 11] +
        -a[..., 20] * b[..., 12] +
        -a[..., 21] * b[..., 30] +
        a[..., 22] * b[..., 8] +
        a[..., 23] * b[..., 9] +
        a[..., 24] * b[..., 29] +
        -a[..., 25] * b[..., 28] +
        -a[..., 26] * b[..., 4] +
        -a[..., 27] * b[..., 5] +
        -a[..., 28] * b[..., 25] +
        a[..., 29] * b[..., 24] +
        -a[..., 30] * b[..., 21] +
        -a[..., 31] * b[..., 15]
    )
    r17 = (
        a[..., 0] * b[..., 17] +
        a[..., 1] * b[..., 11] +
        -a[..., 2] * b[..., 8] +
        -a[..., 3] * b[..., 26] +
        a[..., 4] * b[..., 6] +
        a[..., 5] * b[..., 28] +
        a[..., 6] * b[..., 4] +
        a[..., 7] * b[..., 22] +
        -a[..., 8] * b[..., 2] +
        -a[..., 9] * b[..., 24] +
        -a[..., 10] * b[..., 19] +
        a[..., 11] * b[..., 1] +
        a[..., 12] * b[..., 21] +
        a[..., 13] * b[..., 16] +
        a[..., 14] * b[..., 31] +
        -a[..., 15] * b[..., 18] +
        -a[..., 16] * b[..., 13] +
        a[..., 17] * b[..., 0] +
        a[..., 18] * b[..., 15] +
        a[..., 19] * b[..., 10] +
        a[..., 20] * b[..., 30] +
        -a[..., 21] * b[..., 12] +
        -a[..., 22] * b[..., 7] +
        -a[..., 23] * b[..., 29] +
        a[..., 24] * b[..., 9] +
        a[..., 25] * b[..., 27] +
        a[..., 26] * b[..., 3] +
        a[..., 27] * b[..., 25] +
        -a[..., 28] * b[..., 5] +
        -a[..., 29] * b[..., 23] +
        a[..., 30] * b[..., 20] +
        a[..., 31] * b[..., 14]
    )
    r18 = (
        a[..., 0] * b[..., 18] +
        a[..., 1] * b[..., 12] +
        -a[..., 2] * b[..., 9] +
        -a[..., 3] * b[..., 27] +
        -a[..., 4] * b[..., 28] +
        a[..., 5] * b[..., 6] +
        a[..., 6] * b[..., 5] +
        a[..., 7] * b[..., 23] +
        a[..., 8] * b[..., 24] +
        -a[..., 9] * b[..., 2] +
        -a[..., 10] * b[..., 20] +
        -a[..., 11] * b[..., 21] +
        a[..., 12] * b[..., 1] +
        -a[..., 13] * b[..., 31] +
        a[..., 14] * b[..., 16] +
        a[..., 15] * b[..., 17] +
        -a[..., 16] * b[..., 14] +
        -a[..., 17] * b[..., 15] +
        a[..., 18] * b[..., 0] +
        -a[..., 19] * b[..., 30] +
        a[..., 20] * b[..., 10] +
        a[..., 21] * b[..., 11] +
        a[..., 22] * b[..., 29] +
        -a[..., 23] * b[..., 7] +
        -a[..., 24] * b[..., 8] +
        -a[..., 25] * b[..., 26] +
        -a[..., 26] * b[..., 25] +
        a[..., 27] * b[..., 3] +
        a[..., 28] * b[..., 4] +
        a[..., 29] * b[..., 22] +
        -a[..., 30] * b[..., 19] +
        -a[..., 31] * b[..., 13]
    )
    r19 = (
        a[..., 0] * b[..., 19] +
        a[..., 1] * b[..., 13] +
        -a[..., 2] * b[..., 26] +
        -a[..., 3] * b[..., 8] +
        a[..., 4] * b[..., 7] +
        a[..., 5] * b[..., 29] +
        a[..., 6] * b[..., 22] +
        a[..., 7] * b[..., 4] +
        -a[..., 8] * b[..., 3] +
        -a[..., 9] * b[..., 25] +
        -a[..., 10] * b[..., 17] +
        a[..., 11] * b[..., 16] +
        a[..., 12] * b[..., 31] +
        a[..., 13] * b[..., 1] +
        a[..., 14] * b[..., 21] +
        -a[..., 15] * b[..., 20] +
        -a[..., 16] * b[..., 11] +
        a[..., 17] * b[..., 10] +
        a[..., 18] * b[..., 30] +
        a[..., 19] * b[..., 0] +
        a[..., 20] * b[..., 15] +
        -a[..., 21] * b[..., 14] +
        -a[..., 22] * b[..., 6] +
        -a[..., 23] * b[..., 28] +
        a[..., 24] * b[..., 27] +
        a[..., 25] * b[..., 9] +
        a[..., 26] * b[..., 2] +
        a[..., 27] * b[..., 24] +
        -a[..., 28] * b[..., 23] +
        -a[..., 29] * b[..., 5] +
        a[..., 30] * b[..., 18] +
        a[..., 31] * b[..., 12]
    )
    r20 = (
        a[..., 0] * b[..., 20] +
        a[..., 1] * b[..., 14] +
        -a[..., 2] * b[..., 27] +
        -a[..., 3] * b[..., 9] +
        -a[..., 4] * b[..., 29] +
        a[..., 5] * b[..., 7] +
        a[..., 6] * b[..., 23] +
        a[..., 7] * b[..., 5] +
        a[..., 8] * b[..., 25] +
        -a[..., 9] * b[..., 3] +
        -a[..., 10] * b[..., 18] +
        -a[..., 11] * b[..., 31] +
        a[..., 12] * b[..., 16] +
        -a[..., 13] * b[..., 21] +
        a[..., 14] * b[..., 1] +
        a[..., 15] * b[..., 19] +
        -a[..., 16] * b[..., 12] +
        -a[..., 17] * b[..., 30] +
        a[..., 18] * b[..., 10] +
        -a[..., 19] * b[..., 15] +
        a[..., 20] * b[..., 0] +
        a[..., 21] * b[..., 13] +
        a[..., 22] * b[..., 28] +
        -a[..., 23] * b[..., 6] +
        -a[..., 24] * b[..., 26] +
        -a[..., 25] * b[..., 8] +
        -a[..., 26] * b[..., 24] +
        a[..., 27] * b[..., 2] +
        a[..., 28] * b[..., 22] +
        a[..., 29] * b[..., 4] +
        -a[..., 30] * b[..., 17] +
        -a[..., 31] * b[..., 11]
    )
    r21 = (
        a[..., 0] * b[..., 21] +
        a[..., 1] * b[..., 15] +
        -a[..., 2] * b[..., 28] +
        a[..., 3] * b[..., 29] +
        -a[..., 4] * b[..., 9] +
        a[..., 5] * b[..., 8] +
        a[..., 6] * b[..., 24] +
        -a[..., 7] * b[..., 25] +
        a[..., 8] * b[..., 5] +
        -a[..., 9] * b[..., 4] +
        a[..., 10] * b[..., 31] +
        -a[..., 11] * b[..., 18] +
        a[..., 12] * b[..., 17] +
        a[..., 13] * b[..., 20] +
        -a[..., 14] * b[..., 19] +
        a[..., 15] * b[..., 1] +
        a[..., 16] * b[..., 30] +
        -a[..., 17] * b[..., 12] +
        a[..., 18] * b[..., 11] +
        a[..., 19] * b[..., 14] +
        -a[..., 20] * b[..., 13] +
        a[..., 21] * b[..., 0] +
        -a[..., 22] * b[..., 27] +
        a[..., 23] * b[..., 26] +
        -a[..., 24] * b[..., 6] +
        a[..., 25] * b[..., 7] +
        a[..., 26] * b[..., 23] +
        -a[..., 27] * b[..., 22] +
        a[..., 28] * b[..., 2] +
        -a[..., 29] * b[..., 3] +
        a[..., 30] * b[..., 16] +
        a[..., 31] * b[..., 10]
    )
    r22 = (
        a[..., 0] * b[..., 22] +
        a[..., 1] * b[..., 26] +
        a[..., 2] * b[..., 13] +
        -a[..., 3] * b[..., 11] +
        a[..., 4] * b[..., 10] +
        a[..., 5] * b[..., 30] +
        -a[..., 6] * b[..., 19] +
        a[..., 7] * b[..., 17] +
        -a[..., 8] * b[..., 16] +
        -a[..., 9] * b[..., 31] +
        a[..., 10] * b[..., 4] +
        -a[..., 11] * b[..., 3] +
        -a[..., 12] * b[..., 25] +
        a[..., 13] * b[..., 2] +
        a[..., 14] * b[..., 24] +
        -a[..., 15] * b[..., 23] +
        a[..., 16] * b[..., 8] +
        -a[..., 17] * b[..., 7] +
        -a[..., 18] * b[..., 29] +
        a[..., 19] * b[..., 6] +
        a[..., 20] * b[..., 28] +
        -a[..., 21] * b[..., 27] +
        a[..., 22] * b[..., 0] +
        a[..., 23] * b[..., 15] +
        -a[..., 24] * b[..., 14] +
        a[..., 25] * b[..., 12] +
        -a[..., 26] * b[..., 1] +
        -a[..., 27] * b[..., 21] +
        a[..., 28] * b[..., 20] +
        -a[..., 29] * b[..., 18] +
        -a[..., 30] * b[..., 5] +
        -a[..., 31] * b[..., 9]
    )
    r23 = (
        a[..., 0] * b[..., 23] +
        a[..., 1] * b[..., 27] +
        a[..., 2] * b[..., 14] +
        -a[..., 3] * b[..., 12] +
        -a[..., 4] * b[..., 30] +
        a[..., 5] * b[..., 10] +
        -a[..., 6] * b[..., 20] +
        a[..., 7] * b[..., 18] +
        a[..., 8] * b[..., 31] +
        -a[..., 9] * b[..., 16] +
        a[..., 10] * b[..., 5] +
        a[..., 11] * b[..., 25] +
        -a[..., 12] * b[..., 3] +
        -a[..., 13] * b[..., 24] +
        a[..., 14] * b[..., 2] +
        a[..., 15] * b[..., 22] +
        a[..., 16] * b[..., 9] +
        a[..., 17] * b[..., 29] +
        -a[..., 18] * b[..., 7] +
        -a[..., 19] * b[..., 28] +
        a[..., 20] * b[..., 6] +
        a[..., 21] * b[..., 26] +
        -a[..., 22] * b[..., 15] +
        a[..., 23] * b[..., 0] +
        a[..., 24] * b[..., 13] +
        -a[..., 25] * b[..., 11] +
        a[..., 26] * b[..., 21] +
        -a[..., 27] * b[..., 1] +
        -a[..., 28] * b[..., 19] +
        a[..., 29] * b[..., 17] +
        a[..., 30] * b[..., 4] +
        a[..., 31] * b[..., 8]
    )
    r24 = (
        a[..., 0] * b[..., 24] +
        a[..., 1] * b[..., 28] +
        a[..., 2] * b[..., 15] +
        a[..., 3] * b[..., 30] +
        -a[..., 4] * b[..., 12] +
        a[..., 5] * b[..., 11] +
        -a[..., 6] * b[..., 21] +
        -a[..., 7] * b[..., 31] +
        a[..., 8] * b[..., 18] +
        -a[..., 9] * b[..., 17] +
        -a[..., 10] * b[..., 25] +
        a[..., 11] * b[..., 5] +
        -a[..., 12] * b[..., 4] +
        a[..., 13] * b[..., 23] +
        -a[..., 14] * b[..., 22] +
        a[..., 15] * b[..., 2] +
        -a[..., 16] * b[..., 29] +
        a[..., 17] * b[..., 9] +
        -a[..., 18] * b[..., 8] +
        a[..., 19] * b[..., 27] +
        -a[..., 20] * b[..., 26] +
        a[..., 21] * b[..., 6] +
        a[..., 22] * b[..., 14] +
        -a[..., 23] * b[..., 13] +
        a[..., 24] * b[..., 0] +
        a[..., 25] * b[..., 10] +
        -a[..., 26] * b[..., 20] +
        a[..., 27] * b[..., 19] +
        -a[..., 28] * b[..., 1] +
        -a[..., 29] * b[..., 16] +
        -a[..., 30] * b[..., 3] +
        -a[..., 31] * b[..., 7]
    )
    r25 = (
        a[..., 0] * b[..., 25] +
        a[..., 1] * b[..., 29] +
        a[..., 2] * b[..., 30] +
        a[..., 3] * b[..., 15] +
        -a[..., 4] * b[..., 14] +
        a[..., 5] * b[..., 13] +
        -a[..., 6] * b[..., 31] +
        -a[..., 7] * b[..., 21] +
        a[..., 8] * b[..., 20] +
        -a[..., 9] * b[..., 19] +
        -a[..., 10] * b[..., 24] +
        a[..., 11] * b[..., 23] +
        -a[..., 12] * b[..., 22] +
        a[..., 13] * b[..., 5] +
        -a[..., 14] * b[..., 4] +
        a[..., 15] * b[..., 3] +
        -a[..., 16] * b[..., 28] +
        a[..., 17] * b[..., 27] +
        -a[..., 18] * b[..., 26] +
        a[..., 19] * b[..., 9] +
        -a[..., 20] * b[..., 8] +
        a[..., 21] * b[..., 7] +
        a[..., 22] * b[..., 12] +
        -a[..., 23] * b[..., 11] +
        a[..., 24] * b[..., 10] +
        a[..., 25] * b[..., 0] +
        -a[..., 26] * b[..., 18] +
        a[..., 27] * b[..., 17] +
        -a[..., 28] * b[..., 16] +
        -a[..., 29] * b[..., 1] +
        -a[..., 30] * b[..., 2] +
        -a[..., 31] * b[..., 6]
    )
    r26 = (
        a[..., 0] * b[..., 26] +
        a[..., 1] * b[..., 22] +
        -a[..., 2] * b[..., 19] +
        a[..., 3] * b[..., 17] +
        -a[..., 4] * b[..., 16] +
        -a[..., 5] * b[..., 31] +
        a[..., 6] * b[..., 13] +
        -a[..., 7] * b[..., 11] +
        a[..., 8] * b[..., 10] +
        a[..., 9] * b[..., 30] +
        a[..., 10] * b[..., 8] +
        -a[..., 11] * b[..., 7] +
        -a[..., 12] * b[..., 29] +
        a[..., 13] * b[..., 6] +
        a[..., 14] * b[..., 28] +
        -a[..., 15] * b[..., 27] +
        a[..., 16] * b[..., 4] +
        -a[..., 17] * b[..., 3] +
        -a[..., 18] * b[..., 25] +
        a[..., 19] * b[..., 2] +
        a[..., 20] * b[..., 24] +
        -a[..., 21] * b[..., 23] +
        -a[..., 22] * b[..., 1] +
        -a[..., 23] * b[..., 21] +
        a[..., 24] * b[..., 20] +
        -a[..., 25] * b[..., 18] +
        a[..., 26] * b[..., 0] +
        a[..., 27] * b[..., 15] +
        -a[..., 28] * b[..., 14] +
        a[..., 29] * b[..., 12] +
        -a[..., 30] * b[..., 9] +
        -a[..., 31] * b[..., 5]
    )
    r27 = (
        a[..., 0] * b[..., 27] +
        a[..., 1] * b[..., 23] +
        -a[..., 2] * b[..., 20] +
        a[..., 3] * b[..., 18] +
        a[..., 4] * b[..., 31] +
        -a[..., 5] * b[..., 16] +
        a[..., 6] * b[..., 14] +
        -a[..., 7] * b[..., 12] +
        -a[..., 8] * b[..., 30] +
        a[..., 9] * b[..., 10] +
        a[..., 10] * b[..., 9] +
        a[..., 11] * b[..., 29] +
        -a[..., 12] * b[..., 7] +
        -a[..., 13] * b[..., 28] +
        a[..., 14] * b[..., 6] +
        a[..., 15] * b[..., 26] +
        a[..., 16] * b[..., 5] +
        a[..., 17] * b[..., 25] +
        -a[..., 18] * b[..., 3] +
        -a[..., 19] * b[..., 24] +
        a[..., 20] * b[..., 2] +
        a[..., 21] * b[..., 22] +
        a[..., 22] * b[..., 21] +
        -a[..., 23] * b[..., 1] +
        -a[..., 24] * b[..., 19] +
        a[..., 25] * b[..., 17] +
        -a[..., 26] * b[..., 15] +
        a[..., 27] * b[..., 0] +
        a[..., 28] * b[..., 13] +
        -a[..., 29] * b[..., 11] +
        a[..., 30] * b[..., 8] +
        a[..., 31] * b[..., 4]
    )
    r28 = (
        a[..., 0] * b[..., 28] +
        a[..., 1] * b[..., 24] +
        -a[..., 2] * b[..., 21] +
        -a[..., 3] * b[..., 31] +
        a[..., 4] * b[..., 18] +
        -a[..., 5] * b[..., 17] +
        a[..., 6] * b[..., 15] +
        a[..., 7] * b[..., 30] +
        -a[..., 8] * b[..., 12] +
        a[..., 9] * b[..., 11] +
        -a[..., 10] * b[..., 29] +
        a[..., 11] * b[..., 9] +
        -a[..., 12] * b[..., 8] +
        a[..., 13] * b[..., 27] +
        -a[..., 14] * b[..., 26] +
        a[..., 15] * b[..., 6] +
        -a[..., 16] * b[..., 25] +
        a[..., 17] * b[..., 5] +
        -a[..., 18] * b[..., 4] +
        a[..., 19] * b[..., 23] +
        -a[..., 20] * b[..., 22] +
        a[..., 21] * b[..., 2] +
        -a[..., 22] * b[..., 20] +
        a[..., 23] * b[..., 19] +
        -a[..., 24] * b[..., 1] +
        -a[..., 25] * b[..., 16] +
        a[..., 26] * b[..., 14] +
        -a[..., 27] * b[..., 13] +
        a[..., 28] * b[..., 0] +
        a[..., 29] * b[..., 10] +
        -a[..., 30] * b[..., 7] +
        -a[..., 31] * b[..., 3]
    )
    r29 = (
        a[..., 0] * b[..., 29] +
        a[..., 1] * b[..., 25] +
        -a[..., 2] * b[..., 31] +
        -a[..., 3] * b[..., 21] +
        a[..., 4] * b[..., 20] +
        -a[..., 5] * b[..., 19] +
        a[..., 6] * b[..., 30] +
        a[..., 7] * b[..., 15] +
        -a[..., 8] * b[..., 14] +
        a[..., 9] * b[..., 13] +
        -a[..., 10] * b[..., 28] +
        a[..., 11] * b[..., 27] +
        -a[..., 12] * b[..., 26] +
        a[..., 13] * b[..., 9] +
        -a[..., 14] * b[..., 8] +
        a[..., 15] * b[..., 7] +
        -a[..., 16] * b[..., 24] +
        a[..., 17] * b[..., 23] +
        -a[..., 18] * b[..., 22] +
        a[..., 19] * b[..., 5] +
        -a[..., 20] * b[..., 4] +
        a[..., 21] * b[..., 3] +
        -a[..., 22] * b[..., 18] +
        a[..., 23] * b[..., 17] +
        -a[..., 24] * b[..., 16] +
        -a[..., 25] * b[..., 1] +
        a[..., 26] * b[..., 12] +
        -a[..., 27] * b[..., 11] +
        a[..., 28] * b[..., 10] +
        a[..., 29] * b[..., 0] +
        -a[..., 30] * b[..., 6] +
        -a[..., 31] * b[..., 2]
    )
    r30 = (
        a[..., 0] * b[..., 30] +
        a[..., 1] * b[..., 31] +
        a[..., 2] * b[..., 25] +
        -a[..., 3] * b[..., 24] +
        a[..., 4] * b[..., 23] +
        -a[..., 5] * b[..., 22] +
        -a[..., 6] * b[..., 29] +
        a[..., 7] * b[..., 28] +
        -a[..., 8] * b[..., 27] +
        a[..., 9] * b[..., 26] +
        a[..., 10] * b[..., 15] +
        -a[..., 11] * b[..., 14] +
        a[..., 12] * b[..., 13] +
        a[..., 13] * b[..., 12] +
        -a[..., 14] * b[..., 11] +
        a[..., 15] * b[..., 10] +
        a[..., 16] * b[..., 21] +
        -a[..., 17] * b[..., 20] +
        a[..., 18] * b[..., 19] +
        a[..., 19] * b[..., 18] +
        -a[..., 20] * b[..., 17] +
        a[..., 21] * b[..., 16] +
        a[..., 22] * b[..., 5] +
        -a[..., 23] * b[..., 4] +
        a[..., 24] * b[..., 3] +
        -a[..., 25] * b[..., 2] +
        -a[..., 26] * b[..., 9] +
        a[..., 27] * b[..., 8] +
        -a[..., 28] * b[..., 7] +
        a[..., 29] * b[..., 6] +
        a[..., 30] * b[..., 0] +
        a[..., 31] * b[..., 1]
    )
    r31 = (
        a[..., 0] * b[..., 31] +
        a[..., 1] * b[..., 30] +
        -a[..., 2] * b[..., 29] +
        a[..., 3] * b[..., 28] +
        -a[..., 4] * b[..., 27] +
        a[..., 5] * b[..., 26] +
        a[..., 6] * b[..., 25] +
        -a[..., 7] * b[..., 24] +
        a[..., 8] * b[..., 23] +
        -a[..., 9] * b[..., 22] +
        a[..., 10] * b[..., 21] +
        -a[..., 11] * b[..., 20] +
        a[..., 12] * b[..., 19] +
        a[..., 13] * b[..., 18] +
        -a[..., 14] * b[..., 17] +
        a[..., 15] * b[..., 16] +
        a[..., 16] * b[..., 15] +
        -a[..., 17] * b[..., 14] +
        a[..., 18] * b[..., 13] +
        a[..., 19] * b[..., 12] +
        -a[..., 20] * b[..., 11] +
        a[..., 21] * b[..., 10] +
        -a[..., 22] * b[..., 9] +
        a[..., 23] * b[..., 8] +
        -a[..., 24] * b[..., 7] +
        a[..., 25] * b[..., 6] +
        a[..., 26] * b[..., 5] +
        -a[..., 27] * b[..., 4] +
        a[..., 28] * b[..., 3] +
        -a[..., 29] * b[..., 2] +
        a[..., 30] * b[..., 1] +
        a[..., 31] * b[..., 0]
    )

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Reverse Operation
# =============================================================================

@torch.jit.script
def reverse(mv: Tensor) -> Tensor:
    """
    Compute reverse of a multivector in Cl(2, 3).

    For grade k: coefficient *= (-1)^(k*(k-1)/2)

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Reversed multivector, shape (..., 32)
    """
    r0 = mv[..., 0]
    r1 = mv[..., 1]
    r2 = mv[..., 2]
    r3 = mv[..., 3]
    r4 = mv[..., 4]
    r5 = mv[..., 5]
    r6 = -mv[..., 6]
    r7 = -mv[..., 7]
    r8 = -mv[..., 8]
    r9 = -mv[..., 9]
    r10 = -mv[..., 10]
    r11 = -mv[..., 11]
    r12 = -mv[..., 12]
    r13 = -mv[..., 13]
    r14 = -mv[..., 14]
    r15 = -mv[..., 15]
    r16 = -mv[..., 16]
    r17 = -mv[..., 17]
    r18 = -mv[..., 18]
    r19 = -mv[..., 19]
    r20 = -mv[..., 20]
    r21 = -mv[..., 21]
    r22 = -mv[..., 22]
    r23 = -mv[..., 23]
    r24 = -mv[..., 24]
    r25 = -mv[..., 25]
    r26 = mv[..., 26]
    r27 = mv[..., 27]
    r28 = mv[..., 28]
    r29 = mv[..., 29]
    r30 = mv[..., 30]
    r31 = mv[..., 31]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Grade Involution
# =============================================================================

@torch.jit.script
def involute(mv: Tensor) -> Tensor:
    """
    Compute grade involution of a multivector in Cl(2, 3).

    For grade k: coefficient *= (-1)^k

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Grade-involuted multivector, shape (..., 32)
    """
    r0 = mv[..., 0]
    r1 = -mv[..., 1]
    r2 = -mv[..., 2]
    r3 = -mv[..., 3]
    r4 = -mv[..., 4]
    r5 = -mv[..., 5]
    r6 = mv[..., 6]
    r7 = mv[..., 7]
    r8 = mv[..., 8]
    r9 = mv[..., 9]
    r10 = mv[..., 10]
    r11 = mv[..., 11]
    r12 = mv[..., 12]
    r13 = mv[..., 13]
    r14 = mv[..., 14]
    r15 = mv[..., 15]
    r16 = -mv[..., 16]
    r17 = -mv[..., 17]
    r18 = -mv[..., 18]
    r19 = -mv[..., 19]
    r20 = -mv[..., 20]
    r21 = -mv[..., 21]
    r22 = -mv[..., 22]
    r23 = -mv[..., 23]
    r24 = -mv[..., 24]
    r25 = -mv[..., 25]
    r26 = mv[..., 26]
    r27 = mv[..., 27]
    r28 = mv[..., 28]
    r29 = mv[..., 29]
    r30 = mv[..., 30]
    r31 = -mv[..., 31]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Clifford Conjugate
# =============================================================================

@torch.jit.script
def conjugate(mv: Tensor) -> Tensor:
    """
    Compute Clifford conjugate of a multivector in Cl(2, 3).

    For grade k: coefficient *= (-1)^(k*(k+1)/2)

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Conjugated multivector, shape (..., 32)
    """
    r0 = mv[..., 0]
    r1 = -mv[..., 1]
    r2 = -mv[..., 2]
    r3 = -mv[..., 3]
    r4 = -mv[..., 4]
    r5 = -mv[..., 5]
    r6 = -mv[..., 6]
    r7 = -mv[..., 7]
    r8 = -mv[..., 8]
    r9 = -mv[..., 9]
    r10 = -mv[..., 10]
    r11 = -mv[..., 11]
    r12 = -mv[..., 12]
    r13 = -mv[..., 13]
    r14 = -mv[..., 14]
    r15 = -mv[..., 15]
    r16 = mv[..., 16]
    r17 = mv[..., 17]
    r18 = mv[..., 18]
    r19 = mv[..., 19]
    r20 = mv[..., 20]
    r21 = mv[..., 21]
    r22 = mv[..., 22]
    r23 = mv[..., 23]
    r24 = mv[..., 24]
    r25 = mv[..., 25]
    r26 = mv[..., 26]
    r27 = mv[..., 27]
    r28 = mv[..., 28]
    r29 = mv[..., 29]
    r30 = mv[..., 30]
    r31 = -mv[..., 31]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Grade Selection
# =============================================================================

@torch.jit.script
def select_grade_0(mv: Tensor) -> Tensor:
    """
    Extract grade-0 components from multivector.

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Multivector with only grade-0 components, shape (..., 32)
    """
    r0 = mv[..., 0]
    r1 = torch.zeros_like(mv[..., 1])
    r2 = torch.zeros_like(mv[..., 2])
    r3 = torch.zeros_like(mv[..., 3])
    r4 = torch.zeros_like(mv[..., 4])
    r5 = torch.zeros_like(mv[..., 5])
    r6 = torch.zeros_like(mv[..., 6])
    r7 = torch.zeros_like(mv[..., 7])
    r8 = torch.zeros_like(mv[..., 8])
    r9 = torch.zeros_like(mv[..., 9])
    r10 = torch.zeros_like(mv[..., 10])
    r11 = torch.zeros_like(mv[..., 11])
    r12 = torch.zeros_like(mv[..., 12])
    r13 = torch.zeros_like(mv[..., 13])
    r14 = torch.zeros_like(mv[..., 14])
    r15 = torch.zeros_like(mv[..., 15])
    r16 = torch.zeros_like(mv[..., 16])
    r17 = torch.zeros_like(mv[..., 17])
    r18 = torch.zeros_like(mv[..., 18])
    r19 = torch.zeros_like(mv[..., 19])
    r20 = torch.zeros_like(mv[..., 20])
    r21 = torch.zeros_like(mv[..., 21])
    r22 = torch.zeros_like(mv[..., 22])
    r23 = torch.zeros_like(mv[..., 23])
    r24 = torch.zeros_like(mv[..., 24])
    r25 = torch.zeros_like(mv[..., 25])
    r26 = torch.zeros_like(mv[..., 26])
    r27 = torch.zeros_like(mv[..., 27])
    r28 = torch.zeros_like(mv[..., 28])
    r29 = torch.zeros_like(mv[..., 29])
    r30 = torch.zeros_like(mv[..., 30])
    r31 = torch.zeros_like(mv[..., 31])

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)


@torch.jit.script
def select_grade_1(mv: Tensor) -> Tensor:
    """
    Extract grade-1 components from multivector.

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Multivector with only grade-1 components, shape (..., 32)
    """
    r0 = torch.zeros_like(mv[..., 0])
    r1 = mv[..., 1]
    r2 = mv[..., 2]
    r3 = mv[..., 3]
    r4 = mv[..., 4]
    r5 = mv[..., 5]
    r6 = torch.zeros_like(mv[..., 6])
    r7 = torch.zeros_like(mv[..., 7])
    r8 = torch.zeros_like(mv[..., 8])
    r9 = torch.zeros_like(mv[..., 9])
    r10 = torch.zeros_like(mv[..., 10])
    r11 = torch.zeros_like(mv[..., 11])
    r12 = torch.zeros_like(mv[..., 12])
    r13 = torch.zeros_like(mv[..., 13])
    r14 = torch.zeros_like(mv[..., 14])
    r15 = torch.zeros_like(mv[..., 15])
    r16 = torch.zeros_like(mv[..., 16])
    r17 = torch.zeros_like(mv[..., 17])
    r18 = torch.zeros_like(mv[..., 18])
    r19 = torch.zeros_like(mv[..., 19])
    r20 = torch.zeros_like(mv[..., 20])
    r21 = torch.zeros_like(mv[..., 21])
    r22 = torch.zeros_like(mv[..., 22])
    r23 = torch.zeros_like(mv[..., 23])
    r24 = torch.zeros_like(mv[..., 24])
    r25 = torch.zeros_like(mv[..., 25])
    r26 = torch.zeros_like(mv[..., 26])
    r27 = torch.zeros_like(mv[..., 27])
    r28 = torch.zeros_like(mv[..., 28])
    r29 = torch.zeros_like(mv[..., 29])
    r30 = torch.zeros_like(mv[..., 30])
    r31 = torch.zeros_like(mv[..., 31])

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)


@torch.jit.script
def select_grade_2(mv: Tensor) -> Tensor:
    """
    Extract grade-2 components from multivector.

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Multivector with only grade-2 components, shape (..., 32)
    """
    r0 = torch.zeros_like(mv[..., 0])
    r1 = torch.zeros_like(mv[..., 1])
    r2 = torch.zeros_like(mv[..., 2])
    r3 = torch.zeros_like(mv[..., 3])
    r4 = torch.zeros_like(mv[..., 4])
    r5 = torch.zeros_like(mv[..., 5])
    r6 = mv[..., 6]
    r7 = mv[..., 7]
    r8 = mv[..., 8]
    r9 = mv[..., 9]
    r10 = mv[..., 10]
    r11 = mv[..., 11]
    r12 = mv[..., 12]
    r13 = mv[..., 13]
    r14 = mv[..., 14]
    r15 = mv[..., 15]
    r16 = torch.zeros_like(mv[..., 16])
    r17 = torch.zeros_like(mv[..., 17])
    r18 = torch.zeros_like(mv[..., 18])
    r19 = torch.zeros_like(mv[..., 19])
    r20 = torch.zeros_like(mv[..., 20])
    r21 = torch.zeros_like(mv[..., 21])
    r22 = torch.zeros_like(mv[..., 22])
    r23 = torch.zeros_like(mv[..., 23])
    r24 = torch.zeros_like(mv[..., 24])
    r25 = torch.zeros_like(mv[..., 25])
    r26 = torch.zeros_like(mv[..., 26])
    r27 = torch.zeros_like(mv[..., 27])
    r28 = torch.zeros_like(mv[..., 28])
    r29 = torch.zeros_like(mv[..., 29])
    r30 = torch.zeros_like(mv[..., 30])
    r31 = torch.zeros_like(mv[..., 31])

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)


@torch.jit.script
def select_grade_3(mv: Tensor) -> Tensor:
    """
    Extract grade-3 components from multivector.

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Multivector with only grade-3 components, shape (..., 32)
    """
    r0 = torch.zeros_like(mv[..., 0])
    r1 = torch.zeros_like(mv[..., 1])
    r2 = torch.zeros_like(mv[..., 2])
    r3 = torch.zeros_like(mv[..., 3])
    r4 = torch.zeros_like(mv[..., 4])
    r5 = torch.zeros_like(mv[..., 5])
    r6 = torch.zeros_like(mv[..., 6])
    r7 = torch.zeros_like(mv[..., 7])
    r8 = torch.zeros_like(mv[..., 8])
    r9 = torch.zeros_like(mv[..., 9])
    r10 = torch.zeros_like(mv[..., 10])
    r11 = torch.zeros_like(mv[..., 11])
    r12 = torch.zeros_like(mv[..., 12])
    r13 = torch.zeros_like(mv[..., 13])
    r14 = torch.zeros_like(mv[..., 14])
    r15 = torch.zeros_like(mv[..., 15])
    r16 = mv[..., 16]
    r17 = mv[..., 17]
    r18 = mv[..., 18]
    r19 = mv[..., 19]
    r20 = mv[..., 20]
    r21 = mv[..., 21]
    r22 = mv[..., 22]
    r23 = mv[..., 23]
    r24 = mv[..., 24]
    r25 = mv[..., 25]
    r26 = torch.zeros_like(mv[..., 26])
    r27 = torch.zeros_like(mv[..., 27])
    r28 = torch.zeros_like(mv[..., 28])
    r29 = torch.zeros_like(mv[..., 29])
    r30 = torch.zeros_like(mv[..., 30])
    r31 = torch.zeros_like(mv[..., 31])

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)


@torch.jit.script
def select_grade_4(mv: Tensor) -> Tensor:
    """
    Extract grade-4 components from multivector.

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Multivector with only grade-4 components, shape (..., 32)
    """
    r0 = torch.zeros_like(mv[..., 0])
    r1 = torch.zeros_like(mv[..., 1])
    r2 = torch.zeros_like(mv[..., 2])
    r3 = torch.zeros_like(mv[..., 3])
    r4 = torch.zeros_like(mv[..., 4])
    r5 = torch.zeros_like(mv[..., 5])
    r6 = torch.zeros_like(mv[..., 6])
    r7 = torch.zeros_like(mv[..., 7])
    r8 = torch.zeros_like(mv[..., 8])
    r9 = torch.zeros_like(mv[..., 9])
    r10 = torch.zeros_like(mv[..., 10])
    r11 = torch.zeros_like(mv[..., 11])
    r12 = torch.zeros_like(mv[..., 12])
    r13 = torch.zeros_like(mv[..., 13])
    r14 = torch.zeros_like(mv[..., 14])
    r15 = torch.zeros_like(mv[..., 15])
    r16 = torch.zeros_like(mv[..., 16])
    r17 = torch.zeros_like(mv[..., 17])
    r18 = torch.zeros_like(mv[..., 18])
    r19 = torch.zeros_like(mv[..., 19])
    r20 = torch.zeros_like(mv[..., 20])
    r21 = torch.zeros_like(mv[..., 21])
    r22 = torch.zeros_like(mv[..., 22])
    r23 = torch.zeros_like(mv[..., 23])
    r24 = torch.zeros_like(mv[..., 24])
    r25 = torch.zeros_like(mv[..., 25])
    r26 = mv[..., 26]
    r27 = mv[..., 27]
    r28 = mv[..., 28]
    r29 = mv[..., 29]
    r30 = mv[..., 30]
    r31 = torch.zeros_like(mv[..., 31])

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)


@torch.jit.script
def select_grade_5(mv: Tensor) -> Tensor:
    """
    Extract grade-5 components from multivector.

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Multivector with only grade-5 components, shape (..., 32)
    """
    r0 = torch.zeros_like(mv[..., 0])
    r1 = torch.zeros_like(mv[..., 1])
    r2 = torch.zeros_like(mv[..., 2])
    r3 = torch.zeros_like(mv[..., 3])
    r4 = torch.zeros_like(mv[..., 4])
    r5 = torch.zeros_like(mv[..., 5])
    r6 = torch.zeros_like(mv[..., 6])
    r7 = torch.zeros_like(mv[..., 7])
    r8 = torch.zeros_like(mv[..., 8])
    r9 = torch.zeros_like(mv[..., 9])
    r10 = torch.zeros_like(mv[..., 10])
    r11 = torch.zeros_like(mv[..., 11])
    r12 = torch.zeros_like(mv[..., 12])
    r13 = torch.zeros_like(mv[..., 13])
    r14 = torch.zeros_like(mv[..., 14])
    r15 = torch.zeros_like(mv[..., 15])
    r16 = torch.zeros_like(mv[..., 16])
    r17 = torch.zeros_like(mv[..., 17])
    r18 = torch.zeros_like(mv[..., 18])
    r19 = torch.zeros_like(mv[..., 19])
    r20 = torch.zeros_like(mv[..., 20])
    r21 = torch.zeros_like(mv[..., 21])
    r22 = torch.zeros_like(mv[..., 22])
    r23 = torch.zeros_like(mv[..., 23])
    r24 = torch.zeros_like(mv[..., 24])
    r25 = torch.zeros_like(mv[..., 25])
    r26 = torch.zeros_like(mv[..., 26])
    r27 = torch.zeros_like(mv[..., 27])
    r28 = torch.zeros_like(mv[..., 28])
    r29 = torch.zeros_like(mv[..., 29])
    r30 = torch.zeros_like(mv[..., 30])
    r31 = mv[..., 31]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)


# =============================================================================
# Inner Product
# =============================================================================

@torch.jit.script
def inner(a: Tensor, b: Tensor) -> Tensor:
    """
    Compute inner product <ab>_0 in Cl(2, 3).

    Args:
        a: Left operand, shape (..., 32)
        b: Right operand, shape (..., 32)

    Returns:
        Scalar result, shape (..., 1)
    """
    result = (
        a[..., 0] * b[..., 0] +
        a[..., 1] * b[..., 1] +
        a[..., 2] * b[..., 2] +
        -a[..., 3] * b[..., 3] +
        -a[..., 4] * b[..., 4] +
        -a[..., 5] * b[..., 5] +
        -a[..., 6] * b[..., 6] +
        a[..., 7] * b[..., 7] +
        a[..., 8] * b[..., 8] +
        a[..., 9] * b[..., 9] +
        a[..., 10] * b[..., 10] +
        a[..., 11] * b[..., 11] +
        a[..., 12] * b[..., 12] +
        -a[..., 13] * b[..., 13] +
        -a[..., 14] * b[..., 14] +
        -a[..., 15] * b[..., 15] +
        a[..., 16] * b[..., 16] +
        a[..., 17] * b[..., 17] +
        a[..., 18] * b[..., 18] +
        -a[..., 19] * b[..., 19] +
        -a[..., 20] * b[..., 20] +
        -a[..., 21] * b[..., 21] +
        -a[..., 22] * b[..., 22] +
        -a[..., 23] * b[..., 23] +
        -a[..., 24] * b[..., 24] +
        a[..., 25] * b[..., 25] +
        a[..., 26] * b[..., 26] +
        a[..., 27] * b[..., 27] +
        a[..., 28] * b[..., 28] +
        -a[..., 29] * b[..., 29] +
        -a[..., 30] * b[..., 30] +
        -a[..., 31] * b[..., 31]
    )
    return result.unsqueeze(-1)

# =============================================================================
# Outer Product (Wedge)
# =============================================================================

@torch.jit.script
def outer(a: Tensor, b: Tensor) -> Tensor:
    """
    Compute outer product a ^ b in Cl(2, 3).

    Args:
        a: Left operand, shape (..., 32)
        b: Right operand, shape (..., 32)

    Returns:
        Result multivector, shape (..., 32)
    """
    r0 = a[..., 0] * b[..., 0]
    r1 = a[..., 0] * b[..., 1] + a[..., 1] * b[..., 0]
    r2 = a[..., 0] * b[..., 2] + a[..., 2] * b[..., 0]
    r3 = a[..., 0] * b[..., 3] + a[..., 3] * b[..., 0]
    r4 = a[..., 0] * b[..., 4] + a[..., 4] * b[..., 0]
    r5 = a[..., 0] * b[..., 5] + a[..., 5] * b[..., 0]
    r6 = (
        a[..., 0] * b[..., 6] +
        a[..., 1] * b[..., 2] +
        -a[..., 2] * b[..., 1] +
        a[..., 6] * b[..., 0]
    )
    r7 = (
        a[..., 0] * b[..., 7] +
        a[..., 1] * b[..., 3] +
        -a[..., 3] * b[..., 1] +
        a[..., 7] * b[..., 0]
    )
    r8 = (
        a[..., 0] * b[..., 8] +
        a[..., 1] * b[..., 4] +
        -a[..., 4] * b[..., 1] +
        a[..., 8] * b[..., 0]
    )
    r9 = (
        a[..., 0] * b[..., 9] +
        a[..., 1] * b[..., 5] +
        -a[..., 5] * b[..., 1] +
        a[..., 9] * b[..., 0]
    )
    r10 = (
        a[..., 0] * b[..., 10] +
        a[..., 2] * b[..., 3] +
        -a[..., 3] * b[..., 2] +
        a[..., 10] * b[..., 0]
    )
    r11 = (
        a[..., 0] * b[..., 11] +
        a[..., 2] * b[..., 4] +
        -a[..., 4] * b[..., 2] +
        a[..., 11] * b[..., 0]
    )
    r12 = (
        a[..., 0] * b[..., 12] +
        a[..., 2] * b[..., 5] +
        -a[..., 5] * b[..., 2] +
        a[..., 12] * b[..., 0]
    )
    r13 = (
        a[..., 0] * b[..., 13] +
        a[..., 3] * b[..., 4] +
        -a[..., 4] * b[..., 3] +
        a[..., 13] * b[..., 0]
    )
    r14 = (
        a[..., 0] * b[..., 14] +
        a[..., 3] * b[..., 5] +
        -a[..., 5] * b[..., 3] +
        a[..., 14] * b[..., 0]
    )
    r15 = (
        a[..., 0] * b[..., 15] +
        a[..., 4] * b[..., 5] +
        -a[..., 5] * b[..., 4] +
        a[..., 15] * b[..., 0]
    )
    r16 = (
        a[..., 0] * b[..., 16] +
        a[..., 1] * b[..., 10] +
        -a[..., 2] * b[..., 7] +
        a[..., 3] * b[..., 6] +
        a[..., 6] * b[..., 3] +
        -a[..., 7] * b[..., 2] +
        a[..., 10] * b[..., 1] +
        a[..., 16] * b[..., 0]
    )
    r17 = (
        a[..., 0] * b[..., 17] +
        a[..., 1] * b[..., 11] +
        -a[..., 2] * b[..., 8] +
        a[..., 4] * b[..., 6] +
        a[..., 6] * b[..., 4] +
        -a[..., 8] * b[..., 2] +
        a[..., 11] * b[..., 1] +
        a[..., 17] * b[..., 0]
    )
    r18 = (
        a[..., 0] * b[..., 18] +
        a[..., 1] * b[..., 12] +
        -a[..., 2] * b[..., 9] +
        a[..., 5] * b[..., 6] +
        a[..., 6] * b[..., 5] +
        -a[..., 9] * b[..., 2] +
        a[..., 12] * b[..., 1] +
        a[..., 18] * b[..., 0]
    )
    r19 = (
        a[..., 0] * b[..., 19] +
        a[..., 1] * b[..., 13] +
        -a[..., 3] * b[..., 8] +
        a[..., 4] * b[..., 7] +
        a[..., 7] * b[..., 4] +
        -a[..., 8] * b[..., 3] +
        a[..., 13] * b[..., 1] +
        a[..., 19] * b[..., 0]
    )
    r20 = (
        a[..., 0] * b[..., 20] +
        a[..., 1] * b[..., 14] +
        -a[..., 3] * b[..., 9] +
        a[..., 5] * b[..., 7] +
        a[..., 7] * b[..., 5] +
        -a[..., 9] * b[..., 3] +
        a[..., 14] * b[..., 1] +
        a[..., 20] * b[..., 0]
    )
    r21 = (
        a[..., 0] * b[..., 21] +
        a[..., 1] * b[..., 15] +
        -a[..., 4] * b[..., 9] +
        a[..., 5] * b[..., 8] +
        a[..., 8] * b[..., 5] +
        -a[..., 9] * b[..., 4] +
        a[..., 15] * b[..., 1] +
        a[..., 21] * b[..., 0]
    )
    r22 = (
        a[..., 0] * b[..., 22] +
        a[..., 2] * b[..., 13] +
        -a[..., 3] * b[..., 11] +
        a[..., 4] * b[..., 10] +
        a[..., 10] * b[..., 4] +
        -a[..., 11] * b[..., 3] +
        a[..., 13] * b[..., 2] +
        a[..., 22] * b[..., 0]
    )
    r23 = (
        a[..., 0] * b[..., 23] +
        a[..., 2] * b[..., 14] +
        -a[..., 3] * b[..., 12] +
        a[..., 5] * b[..., 10] +
        a[..., 10] * b[..., 5] +
        -a[..., 12] * b[..., 3] +
        a[..., 14] * b[..., 2] +
        a[..., 23] * b[..., 0]
    )
    r24 = (
        a[..., 0] * b[..., 24] +
        a[..., 2] * b[..., 15] +
        -a[..., 4] * b[..., 12] +
        a[..., 5] * b[..., 11] +
        a[..., 11] * b[..., 5] +
        -a[..., 12] * b[..., 4] +
        a[..., 15] * b[..., 2] +
        a[..., 24] * b[..., 0]
    )
    r25 = (
        a[..., 0] * b[..., 25] +
        a[..., 3] * b[..., 15] +
        -a[..., 4] * b[..., 14] +
        a[..., 5] * b[..., 13] +
        a[..., 13] * b[..., 5] +
        -a[..., 14] * b[..., 4] +
        a[..., 15] * b[..., 3] +
        a[..., 25] * b[..., 0]
    )
    r26 = (
        a[..., 0] * b[..., 26] +
        a[..., 1] * b[..., 22] +
        -a[..., 2] * b[..., 19] +
        a[..., 3] * b[..., 17] +
        -a[..., 4] * b[..., 16] +
        a[..., 6] * b[..., 13] +
        -a[..., 7] * b[..., 11] +
        a[..., 8] * b[..., 10] +
        a[..., 10] * b[..., 8] +
        -a[..., 11] * b[..., 7] +
        a[..., 13] * b[..., 6] +
        a[..., 16] * b[..., 4] +
        -a[..., 17] * b[..., 3] +
        a[..., 19] * b[..., 2] +
        -a[..., 22] * b[..., 1] +
        a[..., 26] * b[..., 0]
    )
    r27 = (
        a[..., 0] * b[..., 27] +
        a[..., 1] * b[..., 23] +
        -a[..., 2] * b[..., 20] +
        a[..., 3] * b[..., 18] +
        -a[..., 5] * b[..., 16] +
        a[..., 6] * b[..., 14] +
        -a[..., 7] * b[..., 12] +
        a[..., 9] * b[..., 10] +
        a[..., 10] * b[..., 9] +
        -a[..., 12] * b[..., 7] +
        a[..., 14] * b[..., 6] +
        a[..., 16] * b[..., 5] +
        -a[..., 18] * b[..., 3] +
        a[..., 20] * b[..., 2] +
        -a[..., 23] * b[..., 1] +
        a[..., 27] * b[..., 0]
    )
    r28 = (
        a[..., 0] * b[..., 28] +
        a[..., 1] * b[..., 24] +
        -a[..., 2] * b[..., 21] +
        a[..., 4] * b[..., 18] +
        -a[..., 5] * b[..., 17] +
        a[..., 6] * b[..., 15] +
        -a[..., 8] * b[..., 12] +
        a[..., 9] * b[..., 11] +
        a[..., 11] * b[..., 9] +
        -a[..., 12] * b[..., 8] +
        a[..., 15] * b[..., 6] +
        a[..., 17] * b[..., 5] +
        -a[..., 18] * b[..., 4] +
        a[..., 21] * b[..., 2] +
        -a[..., 24] * b[..., 1] +
        a[..., 28] * b[..., 0]
    )
    r29 = (
        a[..., 0] * b[..., 29] +
        a[..., 1] * b[..., 25] +
        -a[..., 3] * b[..., 21] +
        a[..., 4] * b[..., 20] +
        -a[..., 5] * b[..., 19] +
        a[..., 7] * b[..., 15] +
        -a[..., 8] * b[..., 14] +
        a[..., 9] * b[..., 13] +
        a[..., 13] * b[..., 9] +
        -a[..., 14] * b[..., 8] +
        a[..., 15] * b[..., 7] +
        a[..., 19] * b[..., 5] +
        -a[..., 20] * b[..., 4] +
        a[..., 21] * b[..., 3] +
        -a[..., 25] * b[..., 1] +
        a[..., 29] * b[..., 0]
    )
    r30 = (
        a[..., 0] * b[..., 30] +
        a[..., 2] * b[..., 25] +
        -a[..., 3] * b[..., 24] +
        a[..., 4] * b[..., 23] +
        -a[..., 5] * b[..., 22] +
        a[..., 10] * b[..., 15] +
        -a[..., 11] * b[..., 14] +
        a[..., 12] * b[..., 13] +
        a[..., 13] * b[..., 12] +
        -a[..., 14] * b[..., 11] +
        a[..., 15] * b[..., 10] +
        a[..., 22] * b[..., 5] +
        -a[..., 23] * b[..., 4] +
        a[..., 24] * b[..., 3] +
        -a[..., 25] * b[..., 2] +
        a[..., 30] * b[..., 0]
    )
    r31 = (
        a[..., 0] * b[..., 31] +
        a[..., 1] * b[..., 30] +
        -a[..., 2] * b[..., 29] +
        a[..., 3] * b[..., 28] +
        -a[..., 4] * b[..., 27] +
        a[..., 5] * b[..., 26] +
        a[..., 6] * b[..., 25] +
        -a[..., 7] * b[..., 24] +
        a[..., 8] * b[..., 23] +
        -a[..., 9] * b[..., 22] +
        a[..., 10] * b[..., 21] +
        -a[..., 11] * b[..., 20] +
        a[..., 12] * b[..., 19] +
        a[..., 13] * b[..., 18] +
        -a[..., 14] * b[..., 17] +
        a[..., 15] * b[..., 16] +
        a[..., 16] * b[..., 15] +
        -a[..., 17] * b[..., 14] +
        a[..., 18] * b[..., 13] +
        a[..., 19] * b[..., 12] +
        -a[..., 20] * b[..., 11] +
        a[..., 21] * b[..., 10] +
        -a[..., 22] * b[..., 9] +
        a[..., 23] * b[..., 8] +
        -a[..., 24] * b[..., 7] +
        a[..., 25] * b[..., 6] +
        a[..., 26] * b[..., 5] +
        -a[..., 27] * b[..., 4] +
        a[..., 28] * b[..., 3] +
        -a[..., 29] * b[..., 2] +
        a[..., 30] * b[..., 1] +
        a[..., 31] * b[..., 0]
    )

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Left Contraction
# =============================================================================

@torch.jit.script
def contract_left(a: Tensor, b: Tensor) -> Tensor:
    """
    Compute left contraction a << b in Cl(2, 3).

    Args:
        a: Left operand, shape (..., 32)
        b: Right operand, shape (..., 32)

    Returns:
        Result multivector, shape (..., 32)
    """
    r0 = (
        a[..., 0] * b[..., 0] +
        a[..., 1] * b[..., 1] +
        a[..., 2] * b[..., 2] +
        -a[..., 3] * b[..., 3] +
        -a[..., 4] * b[..., 4] +
        -a[..., 5] * b[..., 5] +
        -a[..., 6] * b[..., 6] +
        a[..., 7] * b[..., 7] +
        a[..., 8] * b[..., 8] +
        a[..., 9] * b[..., 9] +
        a[..., 10] * b[..., 10] +
        a[..., 11] * b[..., 11] +
        a[..., 12] * b[..., 12] +
        -a[..., 13] * b[..., 13] +
        -a[..., 14] * b[..., 14] +
        -a[..., 15] * b[..., 15] +
        a[..., 16] * b[..., 16] +
        a[..., 17] * b[..., 17] +
        a[..., 18] * b[..., 18] +
        -a[..., 19] * b[..., 19] +
        -a[..., 20] * b[..., 20] +
        -a[..., 21] * b[..., 21] +
        -a[..., 22] * b[..., 22] +
        -a[..., 23] * b[..., 23] +
        -a[..., 24] * b[..., 24] +
        a[..., 25] * b[..., 25] +
        a[..., 26] * b[..., 26] +
        a[..., 27] * b[..., 27] +
        a[..., 28] * b[..., 28] +
        -a[..., 29] * b[..., 29] +
        -a[..., 30] * b[..., 30] +
        -a[..., 31] * b[..., 31]
    )
    r1 = (
        a[..., 0] * b[..., 1] +
        -a[..., 2] * b[..., 6] +
        a[..., 3] * b[..., 7] +
        a[..., 4] * b[..., 8] +
        a[..., 5] * b[..., 9] +
        a[..., 10] * b[..., 16] +
        a[..., 11] * b[..., 17] +
        a[..., 12] * b[..., 18] +
        -a[..., 13] * b[..., 19] +
        -a[..., 14] * b[..., 20] +
        -a[..., 15] * b[..., 21] +
        a[..., 22] * b[..., 26] +
        a[..., 23] * b[..., 27] +
        a[..., 24] * b[..., 28] +
        -a[..., 25] * b[..., 29] +
        -a[..., 30] * b[..., 31]
    )
    r2 = (
        a[..., 0] * b[..., 2] +
        a[..., 1] * b[..., 6] +
        a[..., 3] * b[..., 10] +
        a[..., 4] * b[..., 11] +
        a[..., 5] * b[..., 12] +
        -a[..., 7] * b[..., 16] +
        -a[..., 8] * b[..., 17] +
        -a[..., 9] * b[..., 18] +
        -a[..., 13] * b[..., 22] +
        -a[..., 14] * b[..., 23] +
        -a[..., 15] * b[..., 24] +
        -a[..., 19] * b[..., 26] +
        -a[..., 20] * b[..., 27] +
        -a[..., 21] * b[..., 28] +
        -a[..., 25] * b[..., 30] +
        a[..., 29] * b[..., 31]
    )
    r3 = (
        a[..., 0] * b[..., 3] +
        a[..., 1] * b[..., 7] +
        a[..., 2] * b[..., 10] +
        a[..., 4] * b[..., 13] +
        a[..., 5] * b[..., 14] +
        -a[..., 6] * b[..., 16] +
        -a[..., 8] * b[..., 19] +
        -a[..., 9] * b[..., 20] +
        -a[..., 11] * b[..., 22] +
        -a[..., 12] * b[..., 23] +
        -a[..., 15] * b[..., 25] +
        -a[..., 17] * b[..., 26] +
        -a[..., 18] * b[..., 27] +
        -a[..., 21] * b[..., 29] +
        -a[..., 24] * b[..., 30] +
        a[..., 28] * b[..., 31]
    )
    r4 = (
        a[..., 0] * b[..., 4] +
        a[..., 1] * b[..., 8] +
        a[..., 2] * b[..., 11] +
        -a[..., 3] * b[..., 13] +
        a[..., 5] * b[..., 15] +
        -a[..., 6] * b[..., 17] +
        a[..., 7] * b[..., 19] +
        -a[..., 9] * b[..., 21] +
        a[..., 10] * b[..., 22] +
        -a[..., 12] * b[..., 24] +
        a[..., 14] * b[..., 25] +
        a[..., 16] * b[..., 26] +
        -a[..., 18] * b[..., 28] +
        a[..., 20] * b[..., 29] +
        a[..., 23] * b[..., 30] +
        -a[..., 27] * b[..., 31]
    )
    r5 = (
        a[..., 0] * b[..., 5] +
        a[..., 1] * b[..., 9] +
        a[..., 2] * b[..., 12] +
        -a[..., 3] * b[..., 14] +
        -a[..., 4] * b[..., 15] +
        -a[..., 6] * b[..., 18] +
        a[..., 7] * b[..., 20] +
        a[..., 8] * b[..., 21] +
        a[..., 10] * b[..., 23] +
        a[..., 11] * b[..., 24] +
        -a[..., 13] * b[..., 25] +
        a[..., 16] * b[..., 27] +
        a[..., 17] * b[..., 28] +
        -a[..., 19] * b[..., 29] +
        -a[..., 22] * b[..., 30] +
        a[..., 26] * b[..., 31]
    )
    r6 = (
        a[..., 0] * b[..., 6] +
        -a[..., 3] * b[..., 16] +
        -a[..., 4] * b[..., 17] +
        -a[..., 5] * b[..., 18] +
        -a[..., 13] * b[..., 26] +
        -a[..., 14] * b[..., 27] +
        -a[..., 15] * b[..., 28] +
        a[..., 25] * b[..., 31]
    )
    r7 = (
        a[..., 0] * b[..., 7] +
        -a[..., 2] * b[..., 16] +
        -a[..., 4] * b[..., 19] +
        -a[..., 5] * b[..., 20] +
        -a[..., 11] * b[..., 26] +
        -a[..., 12] * b[..., 27] +
        -a[..., 15] * b[..., 29] +
        a[..., 24] * b[..., 31]
    )
    r8 = (
        a[..., 0] * b[..., 8] +
        -a[..., 2] * b[..., 17] +
        a[..., 3] * b[..., 19] +
        -a[..., 5] * b[..., 21] +
        a[..., 10] * b[..., 26] +
        -a[..., 12] * b[..., 28] +
        a[..., 14] * b[..., 29] +
        -a[..., 23] * b[..., 31]
    )
    r9 = (
        a[..., 0] * b[..., 9] +
        -a[..., 2] * b[..., 18] +
        a[..., 3] * b[..., 20] +
        a[..., 4] * b[..., 21] +
        a[..., 10] * b[..., 27] +
        a[..., 11] * b[..., 28] +
        -a[..., 13] * b[..., 29] +
        a[..., 22] * b[..., 31]
    )
    r10 = (
        a[..., 0] * b[..., 10] +
        a[..., 1] * b[..., 16] +
        -a[..., 4] * b[..., 22] +
        -a[..., 5] * b[..., 23] +
        a[..., 8] * b[..., 26] +
        a[..., 9] * b[..., 27] +
        -a[..., 15] * b[..., 30] +
        -a[..., 21] * b[..., 31]
    )
    r11 = (
        a[..., 0] * b[..., 11] +
        a[..., 1] * b[..., 17] +
        a[..., 3] * b[..., 22] +
        -a[..., 5] * b[..., 24] +
        -a[..., 7] * b[..., 26] +
        a[..., 9] * b[..., 28] +
        a[..., 14] * b[..., 30] +
        a[..., 20] * b[..., 31]
    )
    r12 = (
        a[..., 0] * b[..., 12] +
        a[..., 1] * b[..., 18] +
        a[..., 3] * b[..., 23] +
        a[..., 4] * b[..., 24] +
        -a[..., 7] * b[..., 27] +
        -a[..., 8] * b[..., 28] +
        -a[..., 13] * b[..., 30] +
        -a[..., 19] * b[..., 31]
    )
    r13 = (
        a[..., 0] * b[..., 13] +
        a[..., 1] * b[..., 19] +
        a[..., 2] * b[..., 22] +
        -a[..., 5] * b[..., 25] +
        -a[..., 6] * b[..., 26] +
        a[..., 9] * b[..., 29] +
        a[..., 12] * b[..., 30] +
        a[..., 18] * b[..., 31]
    )
    r14 = (
        a[..., 0] * b[..., 14] +
        a[..., 1] * b[..., 20] +
        a[..., 2] * b[..., 23] +
        a[..., 4] * b[..., 25] +
        -a[..., 6] * b[..., 27] +
        -a[..., 8] * b[..., 29] +
        -a[..., 11] * b[..., 30] +
        -a[..., 17] * b[..., 31]
    )
    r15 = (
        a[..., 0] * b[..., 15] +
        a[..., 1] * b[..., 21] +
        a[..., 2] * b[..., 24] +
        -a[..., 3] * b[..., 25] +
        -a[..., 6] * b[..., 28] +
        a[..., 7] * b[..., 29] +
        a[..., 10] * b[..., 30] +
        a[..., 16] * b[..., 31]
    )
    r16 = (
        a[..., 0] * b[..., 16] +
        a[..., 4] * b[..., 26] +
        a[..., 5] * b[..., 27] +
        -a[..., 15] * b[..., 31]
    )
    r17 = (
        a[..., 0] * b[..., 17] +
        -a[..., 3] * b[..., 26] +
        a[..., 5] * b[..., 28] +
        a[..., 14] * b[..., 31]
    )
    r18 = (
        a[..., 0] * b[..., 18] +
        -a[..., 3] * b[..., 27] +
        -a[..., 4] * b[..., 28] +
        -a[..., 13] * b[..., 31]
    )
    r19 = (
        a[..., 0] * b[..., 19] +
        -a[..., 2] * b[..., 26] +
        a[..., 5] * b[..., 29] +
        a[..., 12] * b[..., 31]
    )
    r20 = (
        a[..., 0] * b[..., 20] +
        -a[..., 2] * b[..., 27] +
        -a[..., 4] * b[..., 29] +
        -a[..., 11] * b[..., 31]
    )
    r21 = (
        a[..., 0] * b[..., 21] +
        -a[..., 2] * b[..., 28] +
        a[..., 3] * b[..., 29] +
        a[..., 10] * b[..., 31]
    )
    r22 = (
        a[..., 0] * b[..., 22] +
        a[..., 1] * b[..., 26] +
        a[..., 5] * b[..., 30] +
        -a[..., 9] * b[..., 31]
    )
    r23 = (
        a[..., 0] * b[..., 23] +
        a[..., 1] * b[..., 27] +
        -a[..., 4] * b[..., 30] +
        a[..., 8] * b[..., 31]
    )
    r24 = (
        a[..., 0] * b[..., 24] +
        a[..., 1] * b[..., 28] +
        a[..., 3] * b[..., 30] +
        -a[..., 7] * b[..., 31]
    )
    r25 = (
        a[..., 0] * b[..., 25] +
        a[..., 1] * b[..., 29] +
        a[..., 2] * b[..., 30] +
        -a[..., 6] * b[..., 31]
    )
    r26 = a[..., 0] * b[..., 26] + -a[..., 5] * b[..., 31]
    r27 = a[..., 0] * b[..., 27] + a[..., 4] * b[..., 31]
    r28 = a[..., 0] * b[..., 28] + -a[..., 3] * b[..., 31]
    r29 = a[..., 0] * b[..., 29] + -a[..., 2] * b[..., 31]
    r30 = a[..., 0] * b[..., 30] + a[..., 1] * b[..., 31]
    r31 = a[..., 0] * b[..., 31]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Right Contraction
# =============================================================================

@torch.jit.script
def contract_right(a: Tensor, b: Tensor) -> Tensor:
    """
    Compute right contraction a >> b in Cl(2, 3).

    Args:
        a: Left operand, shape (..., 32)
        b: Right operand, shape (..., 32)

    Returns:
        Result multivector, shape (..., 32)
    """
    r0 = (
        a[..., 0] * b[..., 0] +
        a[..., 1] * b[..., 1] +
        a[..., 2] * b[..., 2] +
        -a[..., 3] * b[..., 3] +
        -a[..., 4] * b[..., 4] +
        -a[..., 5] * b[..., 5] +
        -a[..., 6] * b[..., 6] +
        a[..., 7] * b[..., 7] +
        a[..., 8] * b[..., 8] +
        a[..., 9] * b[..., 9] +
        a[..., 10] * b[..., 10] +
        a[..., 11] * b[..., 11] +
        a[..., 12] * b[..., 12] +
        -a[..., 13] * b[..., 13] +
        -a[..., 14] * b[..., 14] +
        -a[..., 15] * b[..., 15] +
        a[..., 16] * b[..., 16] +
        a[..., 17] * b[..., 17] +
        a[..., 18] * b[..., 18] +
        -a[..., 19] * b[..., 19] +
        -a[..., 20] * b[..., 20] +
        -a[..., 21] * b[..., 21] +
        -a[..., 22] * b[..., 22] +
        -a[..., 23] * b[..., 23] +
        -a[..., 24] * b[..., 24] +
        a[..., 25] * b[..., 25] +
        a[..., 26] * b[..., 26] +
        a[..., 27] * b[..., 27] +
        a[..., 28] * b[..., 28] +
        -a[..., 29] * b[..., 29] +
        -a[..., 30] * b[..., 30] +
        -a[..., 31] * b[..., 31]
    )
    r1 = (
        a[..., 1] * b[..., 0] +
        a[..., 6] * b[..., 2] +
        -a[..., 7] * b[..., 3] +
        -a[..., 8] * b[..., 4] +
        -a[..., 9] * b[..., 5] +
        a[..., 16] * b[..., 10] +
        a[..., 17] * b[..., 11] +
        a[..., 18] * b[..., 12] +
        -a[..., 19] * b[..., 13] +
        -a[..., 20] * b[..., 14] +
        -a[..., 21] * b[..., 15] +
        -a[..., 26] * b[..., 22] +
        -a[..., 27] * b[..., 23] +
        -a[..., 28] * b[..., 24] +
        a[..., 29] * b[..., 25] +
        -a[..., 31] * b[..., 30]
    )
    r2 = (
        a[..., 2] * b[..., 0] +
        -a[..., 6] * b[..., 1] +
        -a[..., 10] * b[..., 3] +
        -a[..., 11] * b[..., 4] +
        -a[..., 12] * b[..., 5] +
        -a[..., 16] * b[..., 7] +
        -a[..., 17] * b[..., 8] +
        -a[..., 18] * b[..., 9] +
        -a[..., 22] * b[..., 13] +
        -a[..., 23] * b[..., 14] +
        -a[..., 24] * b[..., 15] +
        a[..., 26] * b[..., 19] +
        a[..., 27] * b[..., 20] +
        a[..., 28] * b[..., 21] +
        a[..., 30] * b[..., 25] +
        a[..., 31] * b[..., 29]
    )
    r3 = (
        a[..., 3] * b[..., 0] +
        -a[..., 7] * b[..., 1] +
        -a[..., 10] * b[..., 2] +
        -a[..., 13] * b[..., 4] +
        -a[..., 14] * b[..., 5] +
        -a[..., 16] * b[..., 6] +
        -a[..., 19] * b[..., 8] +
        -a[..., 20] * b[..., 9] +
        -a[..., 22] * b[..., 11] +
        -a[..., 23] * b[..., 12] +
        -a[..., 25] * b[..., 15] +
        a[..., 26] * b[..., 17] +
        a[..., 27] * b[..., 18] +
        a[..., 29] * b[..., 21] +
        a[..., 30] * b[..., 24] +
        a[..., 31] * b[..., 28]
    )
    r4 = (
        a[..., 4] * b[..., 0] +
        -a[..., 8] * b[..., 1] +
        -a[..., 11] * b[..., 2] +
        a[..., 13] * b[..., 3] +
        -a[..., 15] * b[..., 5] +
        -a[..., 17] * b[..., 6] +
        a[..., 19] * b[..., 7] +
        -a[..., 21] * b[..., 9] +
        a[..., 22] * b[..., 10] +
        -a[..., 24] * b[..., 12] +
        a[..., 25] * b[..., 14] +
        -a[..., 26] * b[..., 16] +
        a[..., 28] * b[..., 18] +
        -a[..., 29] * b[..., 20] +
        -a[..., 30] * b[..., 23] +
        -a[..., 31] * b[..., 27]
    )
    r5 = (
        a[..., 5] * b[..., 0] +
        -a[..., 9] * b[..., 1] +
        -a[..., 12] * b[..., 2] +
        a[..., 14] * b[..., 3] +
        a[..., 15] * b[..., 4] +
        -a[..., 18] * b[..., 6] +
        a[..., 20] * b[..., 7] +
        a[..., 21] * b[..., 8] +
        a[..., 23] * b[..., 10] +
        a[..., 24] * b[..., 11] +
        -a[..., 25] * b[..., 13] +
        -a[..., 27] * b[..., 16] +
        -a[..., 28] * b[..., 17] +
        a[..., 29] * b[..., 19] +
        a[..., 30] * b[..., 22] +
        a[..., 31] * b[..., 26]
    )
    r6 = (
        a[..., 6] * b[..., 0] +
        -a[..., 16] * b[..., 3] +
        -a[..., 17] * b[..., 4] +
        -a[..., 18] * b[..., 5] +
        -a[..., 26] * b[..., 13] +
        -a[..., 27] * b[..., 14] +
        -a[..., 28] * b[..., 15] +
        a[..., 31] * b[..., 25]
    )
    r7 = (
        a[..., 7] * b[..., 0] +
        -a[..., 16] * b[..., 2] +
        -a[..., 19] * b[..., 4] +
        -a[..., 20] * b[..., 5] +
        -a[..., 26] * b[..., 11] +
        -a[..., 27] * b[..., 12] +
        -a[..., 29] * b[..., 15] +
        a[..., 31] * b[..., 24]
    )
    r8 = (
        a[..., 8] * b[..., 0] +
        -a[..., 17] * b[..., 2] +
        a[..., 19] * b[..., 3] +
        -a[..., 21] * b[..., 5] +
        a[..., 26] * b[..., 10] +
        -a[..., 28] * b[..., 12] +
        a[..., 29] * b[..., 14] +
        -a[..., 31] * b[..., 23]
    )
    r9 = (
        a[..., 9] * b[..., 0] +
        -a[..., 18] * b[..., 2] +
        a[..., 20] * b[..., 3] +
        a[..., 21] * b[..., 4] +
        a[..., 27] * b[..., 10] +
        a[..., 28] * b[..., 11] +
        -a[..., 29] * b[..., 13] +
        a[..., 31] * b[..., 22]
    )
    r10 = (
        a[..., 10] * b[..., 0] +
        a[..., 16] * b[..., 1] +
        -a[..., 22] * b[..., 4] +
        -a[..., 23] * b[..., 5] +
        a[..., 26] * b[..., 8] +
        a[..., 27] * b[..., 9] +
        -a[..., 30] * b[..., 15] +
        -a[..., 31] * b[..., 21]
    )
    r11 = (
        a[..., 11] * b[..., 0] +
        a[..., 17] * b[..., 1] +
        a[..., 22] * b[..., 3] +
        -a[..., 24] * b[..., 5] +
        -a[..., 26] * b[..., 7] +
        a[..., 28] * b[..., 9] +
        a[..., 30] * b[..., 14] +
        a[..., 31] * b[..., 20]
    )
    r12 = (
        a[..., 12] * b[..., 0] +
        a[..., 18] * b[..., 1] +
        a[..., 23] * b[..., 3] +
        a[..., 24] * b[..., 4] +
        -a[..., 27] * b[..., 7] +
        -a[..., 28] * b[..., 8] +
        -a[..., 30] * b[..., 13] +
        -a[..., 31] * b[..., 19]
    )
    r13 = (
        a[..., 13] * b[..., 0] +
        a[..., 19] * b[..., 1] +
        a[..., 22] * b[..., 2] +
        -a[..., 25] * b[..., 5] +
        -a[..., 26] * b[..., 6] +
        a[..., 29] * b[..., 9] +
        a[..., 30] * b[..., 12] +
        a[..., 31] * b[..., 18]
    )
    r14 = (
        a[..., 14] * b[..., 0] +
        a[..., 20] * b[..., 1] +
        a[..., 23] * b[..., 2] +
        a[..., 25] * b[..., 4] +
        -a[..., 27] * b[..., 6] +
        -a[..., 29] * b[..., 8] +
        -a[..., 30] * b[..., 11] +
        -a[..., 31] * b[..., 17]
    )
    r15 = (
        a[..., 15] * b[..., 0] +
        a[..., 21] * b[..., 1] +
        a[..., 24] * b[..., 2] +
        -a[..., 25] * b[..., 3] +
        -a[..., 28] * b[..., 6] +
        a[..., 29] * b[..., 7] +
        a[..., 30] * b[..., 10] +
        a[..., 31] * b[..., 16]
    )
    r16 = (
        a[..., 16] * b[..., 0] +
        -a[..., 26] * b[..., 4] +
        -a[..., 27] * b[..., 5] +
        -a[..., 31] * b[..., 15]
    )
    r17 = (
        a[..., 17] * b[..., 0] +
        a[..., 26] * b[..., 3] +
        -a[..., 28] * b[..., 5] +
        a[..., 31] * b[..., 14]
    )
    r18 = (
        a[..., 18] * b[..., 0] +
        a[..., 27] * b[..., 3] +
        a[..., 28] * b[..., 4] +
        -a[..., 31] * b[..., 13]
    )
    r19 = (
        a[..., 19] * b[..., 0] +
        a[..., 26] * b[..., 2] +
        -a[..., 29] * b[..., 5] +
        a[..., 31] * b[..., 12]
    )
    r20 = (
        a[..., 20] * b[..., 0] +
        a[..., 27] * b[..., 2] +
        a[..., 29] * b[..., 4] +
        -a[..., 31] * b[..., 11]
    )
    r21 = (
        a[..., 21] * b[..., 0] +
        a[..., 28] * b[..., 2] +
        -a[..., 29] * b[..., 3] +
        a[..., 31] * b[..., 10]
    )
    r22 = (
        a[..., 22] * b[..., 0] +
        -a[..., 26] * b[..., 1] +
        -a[..., 30] * b[..., 5] +
        -a[..., 31] * b[..., 9]
    )
    r23 = (
        a[..., 23] * b[..., 0] +
        -a[..., 27] * b[..., 1] +
        a[..., 30] * b[..., 4] +
        a[..., 31] * b[..., 8]
    )
    r24 = (
        a[..., 24] * b[..., 0] +
        -a[..., 28] * b[..., 1] +
        -a[..., 30] * b[..., 3] +
        -a[..., 31] * b[..., 7]
    )
    r25 = (
        a[..., 25] * b[..., 0] +
        -a[..., 29] * b[..., 1] +
        -a[..., 30] * b[..., 2] +
        -a[..., 31] * b[..., 6]
    )
    r26 = a[..., 26] * b[..., 0] + -a[..., 31] * b[..., 5]
    r27 = a[..., 27] * b[..., 0] + a[..., 31] * b[..., 4]
    r28 = a[..., 28] * b[..., 0] + -a[..., 31] * b[..., 3]
    r29 = a[..., 29] * b[..., 0] + -a[..., 31] * b[..., 2]
    r30 = a[..., 30] * b[..., 0] + a[..., 31] * b[..., 1]
    r31 = a[..., 31] * b[..., 0]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Dual (Left Contraction with Pseudoscalar)
# =============================================================================

@torch.jit.script
def dual(mv: Tensor) -> Tensor:
    """
    Compute dual mv* = mv << I in Cl(2, 3).

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Dual multivector, shape (..., 32)
    """
    r0 = -mv[..., 31]
    r1 = -mv[..., 30]
    r2 = mv[..., 29]
    r3 = mv[..., 28]
    r4 = -mv[..., 27]
    r5 = mv[..., 26]
    r6 = mv[..., 25]
    r7 = mv[..., 24]
    r8 = -mv[..., 23]
    r9 = mv[..., 22]
    r10 = -mv[..., 21]
    r11 = mv[..., 20]
    r12 = -mv[..., 19]
    r13 = mv[..., 18]
    r14 = -mv[..., 17]
    r15 = mv[..., 16]
    r16 = -mv[..., 15]
    r17 = mv[..., 14]
    r18 = -mv[..., 13]
    r19 = mv[..., 12]
    r20 = -mv[..., 11]
    r21 = mv[..., 10]
    r22 = -mv[..., 9]
    r23 = mv[..., 8]
    r24 = -mv[..., 7]
    r25 = -mv[..., 6]
    r26 = -mv[..., 5]
    r27 = mv[..., 4]
    r28 = -mv[..., 3]
    r29 = -mv[..., 2]
    r30 = mv[..., 1]
    r31 = mv[..., 0]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
        r16, r17, r18, r19, r20, r21, r22, r23,
        r24, r25, r26, r27, r28, r29, r30, r31,
    ], dim=-1)

# =============================================================================
# Norm Squared
# =============================================================================

@torch.jit.script
def norm_squared(mv: Tensor) -> Tensor:
    """
    Compute norm squared |mv|^2 = <mv * ~mv>_0 in Cl(2, 3).

    Args:
        mv: Input multivector, shape (..., 32)

    Returns:
        Norm squared, shape (..., 1)
    """
    result = (
        mv[..., 0] * mv[..., 0] +
        mv[..., 1] * mv[..., 1] +
        mv[..., 2] * mv[..., 2] +
        -mv[..., 3] * mv[..., 3] +
        -mv[..., 4] * mv[..., 4] +
        -mv[..., 5] * mv[..., 5] +
        mv[..., 6] * mv[..., 6] +
        -mv[..., 7] * mv[..., 7] +
        -mv[..., 8] * mv[..., 8] +
        -mv[..., 9] * mv[..., 9] +
        -mv[..., 10] * mv[..., 10] +
        -mv[..., 11] * mv[..., 11] +
        -mv[..., 12] * mv[..., 12] +
        mv[..., 13] * mv[..., 13] +
        mv[..., 14] * mv[..., 14] +
        mv[..., 15] * mv[..., 15] +
        -mv[..., 16] * mv[..., 16] +
        -mv[..., 17] * mv[..., 17] +
        -mv[..., 18] * mv[..., 18] +
        mv[..., 19] * mv[..., 19] +
        mv[..., 20] * mv[..., 20] +
        mv[..., 21] * mv[..., 21] +
        mv[..., 22] * mv[..., 22] +
        mv[..., 23] * mv[..., 23] +
        mv[..., 24] * mv[..., 24] +
        -mv[..., 25] * mv[..., 25] +
        mv[..., 26] * mv[..., 26] +
        mv[..., 27] * mv[..., 27] +
        mv[..., 28] * mv[..., 28] +
        -mv[..., 29] * mv[..., 29] +
        -mv[..., 30] * mv[..., 30] +
        -mv[..., 31] * mv[..., 31]
    )
    return result.unsqueeze(-1)

# =============================================================================
# Rotor Composition
# =============================================================================

@torch.jit.script
def compose_rotor(r1: Tensor, r2: Tensor) -> Tensor:
    """
    Compose two rotors r1 * r2 in Cl(2, 3).

    Args:
        r1: Left rotor, shape (..., 16)
        r2: Right rotor, shape (..., 16)

    Returns:
        Composed rotor, shape (..., 16)
    """
    out0 = (
        r1[..., 0] * r2[..., 0] +
        -r1[..., 1] * r2[..., 1] +
        r1[..., 2] * r2[..., 2] +
        r1[..., 3] * r2[..., 3] +
        r1[..., 4] * r2[..., 4] +
        r1[..., 5] * r2[..., 5] +
        r1[..., 6] * r2[..., 6] +
        r1[..., 7] * r2[..., 7] +
        -r1[..., 8] * r2[..., 8] +
        -r1[..., 9] * r2[..., 9] +
        -r1[..., 10] * r2[..., 10] +
        r1[..., 11] * r2[..., 11] +
        r1[..., 12] * r2[..., 12] +
        r1[..., 13] * r2[..., 13] +
        -r1[..., 14] * r2[..., 14] +
        -r1[..., 15] * r2[..., 15]
    )
    out1 = (
        r1[..., 0] * r2[..., 1] +
        r1[..., 1] * r2[..., 0] +
        r1[..., 2] * r2[..., 5] +
        r1[..., 3] * r2[..., 6] +
        r1[..., 4] * r2[..., 7] +
        -r1[..., 5] * r2[..., 2] +
        -r1[..., 6] * r2[..., 3] +
        -r1[..., 7] * r2[..., 4] +
        -r1[..., 8] * r2[..., 11] +
        -r1[..., 9] * r2[..., 12] +
        -r1[..., 10] * r2[..., 13] +
        -r1[..., 11] * r2[..., 8] +
        -r1[..., 12] * r2[..., 9] +
        -r1[..., 13] * r2[..., 10] +
        -r1[..., 14] * r2[..., 15] +
        r1[..., 15] * r2[..., 14]
    )
    out2 = (
        r1[..., 0] * r2[..., 2] +
        r1[..., 1] * r2[..., 5] +
        r1[..., 2] * r2[..., 0] +
        r1[..., 3] * r2[..., 8] +
        r1[..., 4] * r2[..., 9] +
        -r1[..., 5] * r2[..., 1] +
        -r1[..., 6] * r2[..., 11] +
        -r1[..., 7] * r2[..., 12] +
        -r1[..., 8] * r2[..., 3] +
        -r1[..., 9] * r2[..., 4] +
        -r1[..., 10] * r2[..., 14] +
        -r1[..., 11] * r2[..., 6] +
        -r1[..., 12] * r2[..., 7] +
        -r1[..., 13] * r2[..., 15] +
        -r1[..., 14] * r2[..., 10] +
        r1[..., 15] * r2[..., 13]
    )
    out3 = (
        r1[..., 0] * r2[..., 3] +
        r1[..., 1] * r2[..., 6] +
        -r1[..., 2] * r2[..., 8] +
        r1[..., 3] * r2[..., 0] +
        r1[..., 4] * r2[..., 10] +
        r1[..., 5] * r2[..., 11] +
        -r1[..., 6] * r2[..., 1] +
        -r1[..., 7] * r2[..., 13] +
        r1[..., 8] * r2[..., 2] +
        r1[..., 9] * r2[..., 14] +
        -r1[..., 10] * r2[..., 4] +
        r1[..., 11] * r2[..., 5] +
        r1[..., 12] * r2[..., 15] +
        -r1[..., 13] * r2[..., 7] +
        r1[..., 14] * r2[..., 9] +
        -r1[..., 15] * r2[..., 12]
    )
    out4 = (
        r1[..., 0] * r2[..., 4] +
        r1[..., 1] * r2[..., 7] +
        -r1[..., 2] * r2[..., 9] +
        -r1[..., 3] * r2[..., 10] +
        r1[..., 4] * r2[..., 0] +
        r1[..., 5] * r2[..., 12] +
        r1[..., 6] * r2[..., 13] +
        -r1[..., 7] * r2[..., 1] +
        -r1[..., 8] * r2[..., 14] +
        r1[..., 9] * r2[..., 2] +
        r1[..., 10] * r2[..., 3] +
        -r1[..., 11] * r2[..., 15] +
        r1[..., 12] * r2[..., 5] +
        r1[..., 13] * r2[..., 6] +
        -r1[..., 14] * r2[..., 8] +
        r1[..., 15] * r2[..., 11]
    )
    out5 = (
        r1[..., 0] * r2[..., 5] +
        -r1[..., 1] * r2[..., 2] +
        r1[..., 2] * r2[..., 1] +
        r1[..., 3] * r2[..., 11] +
        r1[..., 4] * r2[..., 12] +
        r1[..., 5] * r2[..., 0] +
        r1[..., 6] * r2[..., 8] +
        r1[..., 7] * r2[..., 9] +
        -r1[..., 8] * r2[..., 6] +
        -r1[..., 9] * r2[..., 7] +
        -r1[..., 10] * r2[..., 15] +
        r1[..., 11] * r2[..., 3] +
        r1[..., 12] * r2[..., 4] +
        r1[..., 13] * r2[..., 14] +
        -r1[..., 14] * r2[..., 13] +
        -r1[..., 15] * r2[..., 10]
    )
    out6 = (
        r1[..., 0] * r2[..., 6] +
        -r1[..., 1] * r2[..., 3] +
        -r1[..., 2] * r2[..., 11] +
        r1[..., 3] * r2[..., 1] +
        r1[..., 4] * r2[..., 13] +
        -r1[..., 5] * r2[..., 8] +
        r1[..., 6] * r2[..., 0] +
        r1[..., 7] * r2[..., 10] +
        r1[..., 8] * r2[..., 5] +
        r1[..., 9] * r2[..., 15] +
        -r1[..., 10] * r2[..., 7] +
        -r1[..., 11] * r2[..., 2] +
        -r1[..., 12] * r2[..., 14] +
        r1[..., 13] * r2[..., 4] +
        r1[..., 14] * r2[..., 12] +
        r1[..., 15] * r2[..., 9]
    )
    out7 = (
        r1[..., 0] * r2[..., 7] +
        -r1[..., 1] * r2[..., 4] +
        -r1[..., 2] * r2[..., 12] +
        -r1[..., 3] * r2[..., 13] +
        r1[..., 4] * r2[..., 1] +
        -r1[..., 5] * r2[..., 9] +
        -r1[..., 6] * r2[..., 10] +
        r1[..., 7] * r2[..., 0] +
        -r1[..., 8] * r2[..., 15] +
        r1[..., 9] * r2[..., 5] +
        r1[..., 10] * r2[..., 6] +
        r1[..., 11] * r2[..., 14] +
        -r1[..., 12] * r2[..., 2] +
        -r1[..., 13] * r2[..., 3] +
        -r1[..., 14] * r2[..., 11] +
        -r1[..., 15] * r2[..., 8]
    )
    out8 = (
        r1[..., 0] * r2[..., 8] +
        -r1[..., 1] * r2[..., 11] +
        -r1[..., 2] * r2[..., 3] +
        r1[..., 3] * r2[..., 2] +
        r1[..., 4] * r2[..., 14] +
        -r1[..., 5] * r2[..., 6] +
        r1[..., 6] * r2[..., 5] +
        r1[..., 7] * r2[..., 15] +
        r1[..., 8] * r2[..., 0] +
        r1[..., 9] * r2[..., 10] +
        -r1[..., 10] * r2[..., 9] +
        -r1[..., 11] * r2[..., 1] +
        -r1[..., 12] * r2[..., 13] +
        r1[..., 13] * r2[..., 12] +
        r1[..., 14] * r2[..., 4] +
        r1[..., 15] * r2[..., 7]
    )
    out9 = (
        r1[..., 0] * r2[..., 9] +
        -r1[..., 1] * r2[..., 12] +
        -r1[..., 2] * r2[..., 4] +
        -r1[..., 3] * r2[..., 14] +
        r1[..., 4] * r2[..., 2] +
        -r1[..., 5] * r2[..., 7] +
        -r1[..., 6] * r2[..., 15] +
        r1[..., 7] * r2[..., 5] +
        -r1[..., 8] * r2[..., 10] +
        r1[..., 9] * r2[..., 0] +
        r1[..., 10] * r2[..., 8] +
        r1[..., 11] * r2[..., 13] +
        -r1[..., 12] * r2[..., 1] +
        -r1[..., 13] * r2[..., 11] +
        -r1[..., 14] * r2[..., 3] +
        -r1[..., 15] * r2[..., 6]
    )
    out10 = (
        r1[..., 0] * r2[..., 10] +
        -r1[..., 1] * r2[..., 13] +
        r1[..., 2] * r2[..., 14] +
        -r1[..., 3] * r2[..., 4] +
        r1[..., 4] * r2[..., 3] +
        r1[..., 5] * r2[..., 15] +
        -r1[..., 6] * r2[..., 7] +
        r1[..., 7] * r2[..., 6] +
        r1[..., 8] * r2[..., 9] +
        -r1[..., 9] * r2[..., 8] +
        r1[..., 10] * r2[..., 0] +
        -r1[..., 11] * r2[..., 12] +
        r1[..., 12] * r2[..., 11] +
        -r1[..., 13] * r2[..., 1] +
        r1[..., 14] * r2[..., 2] +
        r1[..., 15] * r2[..., 5]
    )
    out11 = (
        r1[..., 0] * r2[..., 11] +
        r1[..., 1] * r2[..., 8] +
        -r1[..., 2] * r2[..., 6] +
        r1[..., 3] * r2[..., 5] +
        r1[..., 4] * r2[..., 15] +
        r1[..., 5] * r2[..., 3] +
        -r1[..., 6] * r2[..., 2] +
        -r1[..., 7] * r2[..., 14] +
        r1[..., 8] * r2[..., 1] +
        r1[..., 9] * r2[..., 13] +
        -r1[..., 10] * r2[..., 12] +
        r1[..., 11] * r2[..., 0] +
        r1[..., 12] * r2[..., 10] +
        -r1[..., 13] * r2[..., 9] +
        r1[..., 14] * r2[..., 7] +
        -r1[..., 15] * r2[..., 4]
    )
    out12 = (
        r1[..., 0] * r2[..., 12] +
        r1[..., 1] * r2[..., 9] +
        -r1[..., 2] * r2[..., 7] +
        -r1[..., 3] * r2[..., 15] +
        r1[..., 4] * r2[..., 5] +
        r1[..., 5] * r2[..., 4] +
        r1[..., 6] * r2[..., 14] +
        -r1[..., 7] * r2[..., 2] +
        -r1[..., 8] * r2[..., 13] +
        r1[..., 9] * r2[..., 1] +
        r1[..., 10] * r2[..., 11] +
        -r1[..., 11] * r2[..., 10] +
        r1[..., 12] * r2[..., 0] +
        r1[..., 13] * r2[..., 8] +
        -r1[..., 14] * r2[..., 6] +
        r1[..., 15] * r2[..., 3]
    )
    out13 = (
        r1[..., 0] * r2[..., 13] +
        r1[..., 1] * r2[..., 10] +
        r1[..., 2] * r2[..., 15] +
        -r1[..., 3] * r2[..., 7] +
        r1[..., 4] * r2[..., 6] +
        -r1[..., 5] * r2[..., 14] +
        r1[..., 6] * r2[..., 4] +
        -r1[..., 7] * r2[..., 3] +
        r1[..., 8] * r2[..., 12] +
        -r1[..., 9] * r2[..., 11] +
        r1[..., 10] * r2[..., 1] +
        r1[..., 11] * r2[..., 9] +
        -r1[..., 12] * r2[..., 8] +
        r1[..., 13] * r2[..., 0] +
        r1[..., 14] * r2[..., 5] +
        -r1[..., 15] * r2[..., 2]
    )
    out14 = (
        r1[..., 0] * r2[..., 14] +
        r1[..., 1] * r2[..., 15] +
        r1[..., 2] * r2[..., 10] +
        -r1[..., 3] * r2[..., 9] +
        r1[..., 4] * r2[..., 8] +
        -r1[..., 5] * r2[..., 13] +
        r1[..., 6] * r2[..., 12] +
        -r1[..., 7] * r2[..., 11] +
        r1[..., 8] * r2[..., 4] +
        -r1[..., 9] * r2[..., 3] +
        r1[..., 10] * r2[..., 2] +
        r1[..., 11] * r2[..., 7] +
        -r1[..., 12] * r2[..., 6] +
        r1[..., 13] * r2[..., 5] +
        r1[..., 14] * r2[..., 0] +
        -r1[..., 15] * r2[..., 1]
    )
    out15 = (
        r1[..., 0] * r2[..., 15] +
        -r1[..., 1] * r2[..., 14] +
        r1[..., 2] * r2[..., 13] +
        -r1[..., 3] * r2[..., 12] +
        r1[..., 4] * r2[..., 11] +
        r1[..., 5] * r2[..., 10] +
        -r1[..., 6] * r2[..., 9] +
        r1[..., 7] * r2[..., 8] +
        r1[..., 8] * r2[..., 7] +
        -r1[..., 9] * r2[..., 6] +
        r1[..., 10] * r2[..., 5] +
        -r1[..., 11] * r2[..., 4] +
        r1[..., 12] * r2[..., 3] +
        -r1[..., 13] * r2[..., 2] +
        r1[..., 14] * r2[..., 1] +
        r1[..., 15] * r2[..., 0]
    )

    return torch.stack([
        out0, out1, out2, out3, out4, out5, out6, out7,
        out8, out9, out10, out11, out12, out13, out14, out15,
    ], dim=-1)

# =============================================================================
# Rotor Reverse
# =============================================================================

@torch.jit.script
def reverse_rotor(r: Tensor) -> Tensor:
    """
    Compute reverse of a rotor in Cl(2, 3).

    Args:
        r: Input rotor, shape (..., 16)

    Returns:
        Reversed rotor, shape (..., 16)
    """
    r0 = r[..., 0]
    r1 = -r[..., 1]
    r2 = -r[..., 2]
    r3 = -r[..., 3]
    r4 = -r[..., 4]
    r5 = -r[..., 5]
    r6 = -r[..., 6]
    r7 = -r[..., 7]
    r8 = -r[..., 8]
    r9 = -r[..., 9]
    r10 = -r[..., 10]
    r11 = r[..., 11]
    r12 = r[..., 12]
    r13 = r[..., 13]
    r14 = r[..., 14]
    r15 = r[..., 15]

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
    ], dim=-1)

# =============================================================================
# Rotor Sandwich Product
# =============================================================================

@torch.jit.script
def sandwich_rotor(r: Tensor, x: Tensor) -> Tensor:
    """
    Compute sandwich product r * x * ~r in Cl(2, 3).

    Args:
        r: Rotor, shape (..., 16)
        x: Operand multivector, shape (..., 32)

    Returns:
        Transformed multivector, shape (..., 32)

    Note:
        This is a simplified implementation. Optimized sparse versions
        can be generated for specific input types (e.g., vectors).
    """
    # Expand rotor to full multivector
    rf0 = r[..., 0]
    rf1 = torch.zeros_like(r[..., 0])
    rf2 = torch.zeros_like(r[..., 0])
    rf3 = torch.zeros_like(r[..., 0])
    rf4 = torch.zeros_like(r[..., 0])
    rf5 = torch.zeros_like(r[..., 0])
    rf6 = r[..., 1]
    rf7 = r[..., 2]
    rf8 = r[..., 3]
    rf9 = r[..., 4]
    rf10 = r[..., 5]
    rf11 = r[..., 6]
    rf12 = r[..., 7]
    rf13 = r[..., 8]
    rf14 = r[..., 9]
    rf15 = r[..., 10]
    rf16 = torch.zeros_like(r[..., 0])
    rf17 = torch.zeros_like(r[..., 0])
    rf18 = torch.zeros_like(r[..., 0])
    rf19 = torch.zeros_like(r[..., 0])
    rf20 = torch.zeros_like(r[..., 0])
    rf21 = torch.zeros_like(r[..., 0])
    rf22 = torch.zeros_like(r[..., 0])
    rf23 = torch.zeros_like(r[..., 0])
    rf24 = torch.zeros_like(r[..., 0])
    rf25 = torch.zeros_like(r[..., 0])
    rf26 = r[..., 11]
    rf27 = r[..., 12]
    rf28 = r[..., 13]
    rf29 = r[..., 14]
    rf30 = r[..., 15]
    rf31 = torch.zeros_like(r[..., 0])

    # Compute r * x
    t0 = (
        rf0 * x[..., 0] +
        rf1 * x[..., 1] +
        rf2 * x[..., 2] +
        -rf3 * x[..., 3] +
        -rf4 * x[..., 4] +
        -rf5 * x[..., 5] +
        -rf6 * x[..., 6] +
        rf7 * x[..., 7] +
        rf8 * x[..., 8] +
        rf9 * x[..., 9] +
        rf10 * x[..., 10] +
        rf11 * x[..., 11] +
        rf12 * x[..., 12] +
        -rf13 * x[..., 13] +
        -rf14 * x[..., 14] +
        -rf15 * x[..., 15] +
        rf16 * x[..., 16] +
        rf17 * x[..., 17] +
        rf18 * x[..., 18] +
        -rf19 * x[..., 19] +
        -rf20 * x[..., 20] +
        -rf21 * x[..., 21] +
        -rf22 * x[..., 22] +
        -rf23 * x[..., 23] +
        -rf24 * x[..., 24] +
        rf25 * x[..., 25] +
        rf26 * x[..., 26] +
        rf27 * x[..., 27] +
        rf28 * x[..., 28] +
        -rf29 * x[..., 29] +
        -rf30 * x[..., 30] +
        -rf31 * x[..., 31]
    )
    t1 = (
        rf0 * x[..., 1] +
        rf1 * x[..., 0] +
        -rf2 * x[..., 6] +
        rf3 * x[..., 7] +
        rf4 * x[..., 8] +
        rf5 * x[..., 9] +
        rf6 * x[..., 2] +
        -rf7 * x[..., 3] +
        -rf8 * x[..., 4] +
        -rf9 * x[..., 5] +
        rf10 * x[..., 16] +
        rf11 * x[..., 17] +
        rf12 * x[..., 18] +
        -rf13 * x[..., 19] +
        -rf14 * x[..., 20] +
        -rf15 * x[..., 21] +
        rf16 * x[..., 10] +
        rf17 * x[..., 11] +
        rf18 * x[..., 12] +
        -rf19 * x[..., 13] +
        -rf20 * x[..., 14] +
        -rf21 * x[..., 15] +
        rf22 * x[..., 26] +
        rf23 * x[..., 27] +
        rf24 * x[..., 28] +
        -rf25 * x[..., 29] +
        -rf26 * x[..., 22] +
        -rf27 * x[..., 23] +
        -rf28 * x[..., 24] +
        rf29 * x[..., 25] +
        -rf30 * x[..., 31] +
        -rf31 * x[..., 30]
    )
    t2 = (
        rf0 * x[..., 2] +
        rf1 * x[..., 6] +
        rf2 * x[..., 0] +
        rf3 * x[..., 10] +
        rf4 * x[..., 11] +
        rf5 * x[..., 12] +
        -rf6 * x[..., 1] +
        -rf7 * x[..., 16] +
        -rf8 * x[..., 17] +
        -rf9 * x[..., 18] +
        -rf10 * x[..., 3] +
        -rf11 * x[..., 4] +
        -rf12 * x[..., 5] +
        -rf13 * x[..., 22] +
        -rf14 * x[..., 23] +
        -rf15 * x[..., 24] +
        -rf16 * x[..., 7] +
        -rf17 * x[..., 8] +
        -rf18 * x[..., 9] +
        -rf19 * x[..., 26] +
        -rf20 * x[..., 27] +
        -rf21 * x[..., 28] +
        -rf22 * x[..., 13] +
        -rf23 * x[..., 14] +
        -rf24 * x[..., 15] +
        -rf25 * x[..., 30] +
        rf26 * x[..., 19] +
        rf27 * x[..., 20] +
        rf28 * x[..., 21] +
        rf29 * x[..., 31] +
        rf30 * x[..., 25] +
        rf31 * x[..., 29]
    )
    t3 = (
        rf0 * x[..., 3] +
        rf1 * x[..., 7] +
        rf2 * x[..., 10] +
        rf3 * x[..., 0] +
        rf4 * x[..., 13] +
        rf5 * x[..., 14] +
        -rf6 * x[..., 16] +
        -rf7 * x[..., 1] +
        -rf8 * x[..., 19] +
        -rf9 * x[..., 20] +
        -rf10 * x[..., 2] +
        -rf11 * x[..., 22] +
        -rf12 * x[..., 23] +
        -rf13 * x[..., 4] +
        -rf14 * x[..., 5] +
        -rf15 * x[..., 25] +
        -rf16 * x[..., 6] +
        -rf17 * x[..., 26] +
        -rf18 * x[..., 27] +
        -rf19 * x[..., 8] +
        -rf20 * x[..., 9] +
        -rf21 * x[..., 29] +
        -rf22 * x[..., 11] +
        -rf23 * x[..., 12] +
        -rf24 * x[..., 30] +
        -rf25 * x[..., 15] +
        rf26 * x[..., 17] +
        rf27 * x[..., 18] +
        rf28 * x[..., 31] +
        rf29 * x[..., 21] +
        rf30 * x[..., 24] +
        rf31 * x[..., 28]
    )
    t4 = (
        rf0 * x[..., 4] +
        rf1 * x[..., 8] +
        rf2 * x[..., 11] +
        -rf3 * x[..., 13] +
        rf4 * x[..., 0] +
        rf5 * x[..., 15] +
        -rf6 * x[..., 17] +
        rf7 * x[..., 19] +
        -rf8 * x[..., 1] +
        -rf9 * x[..., 21] +
        rf10 * x[..., 22] +
        -rf11 * x[..., 2] +
        -rf12 * x[..., 24] +
        rf13 * x[..., 3] +
        rf14 * x[..., 25] +
        -rf15 * x[..., 5] +
        rf16 * x[..., 26] +
        -rf17 * x[..., 6] +
        -rf18 * x[..., 28] +
        rf19 * x[..., 7] +
        rf20 * x[..., 29] +
        -rf21 * x[..., 9] +
        rf22 * x[..., 10] +
        rf23 * x[..., 30] +
        -rf24 * x[..., 12] +
        rf25 * x[..., 14] +
        -rf26 * x[..., 16] +
        -rf27 * x[..., 31] +
        rf28 * x[..., 18] +
        -rf29 * x[..., 20] +
        -rf30 * x[..., 23] +
        -rf31 * x[..., 27]
    )
    t5 = (
        rf0 * x[..., 5] +
        rf1 * x[..., 9] +
        rf2 * x[..., 12] +
        -rf3 * x[..., 14] +
        -rf4 * x[..., 15] +
        rf5 * x[..., 0] +
        -rf6 * x[..., 18] +
        rf7 * x[..., 20] +
        rf8 * x[..., 21] +
        -rf9 * x[..., 1] +
        rf10 * x[..., 23] +
        rf11 * x[..., 24] +
        -rf12 * x[..., 2] +
        -rf13 * x[..., 25] +
        rf14 * x[..., 3] +
        rf15 * x[..., 4] +
        rf16 * x[..., 27] +
        rf17 * x[..., 28] +
        -rf18 * x[..., 6] +
        -rf19 * x[..., 29] +
        rf20 * x[..., 7] +
        rf21 * x[..., 8] +
        -rf22 * x[..., 30] +
        rf23 * x[..., 10] +
        rf24 * x[..., 11] +
        -rf25 * x[..., 13] +
        rf26 * x[..., 31] +
        -rf27 * x[..., 16] +
        -rf28 * x[..., 17] +
        rf29 * x[..., 19] +
        rf30 * x[..., 22] +
        rf31 * x[..., 26]
    )
    t6 = (
        rf0 * x[..., 6] +
        rf1 * x[..., 2] +
        -rf2 * x[..., 1] +
        -rf3 * x[..., 16] +
        -rf4 * x[..., 17] +
        -rf5 * x[..., 18] +
        rf6 * x[..., 0] +
        rf7 * x[..., 10] +
        rf8 * x[..., 11] +
        rf9 * x[..., 12] +
        -rf10 * x[..., 7] +
        -rf11 * x[..., 8] +
        -rf12 * x[..., 9] +
        -rf13 * x[..., 26] +
        -rf14 * x[..., 27] +
        -rf15 * x[..., 28] +
        -rf16 * x[..., 3] +
        -rf17 * x[..., 4] +
        -rf18 * x[..., 5] +
        -rf19 * x[..., 22] +
        -rf20 * x[..., 23] +
        -rf21 * x[..., 24] +
        rf22 * x[..., 19] +
        rf23 * x[..., 20] +
        rf24 * x[..., 21] +
        rf25 * x[..., 31] +
        -rf26 * x[..., 13] +
        -rf27 * x[..., 14] +
        -rf28 * x[..., 15] +
        -rf29 * x[..., 30] +
        rf30 * x[..., 29] +
        rf31 * x[..., 25]
    )
    t7 = (
        rf0 * x[..., 7] +
        rf1 * x[..., 3] +
        -rf2 * x[..., 16] +
        -rf3 * x[..., 1] +
        -rf4 * x[..., 19] +
        -rf5 * x[..., 20] +
        rf6 * x[..., 10] +
        rf7 * x[..., 0] +
        rf8 * x[..., 13] +
        rf9 * x[..., 14] +
        -rf10 * x[..., 6] +
        -rf11 * x[..., 26] +
        -rf12 * x[..., 27] +
        -rf13 * x[..., 8] +
        -rf14 * x[..., 9] +
        -rf15 * x[..., 29] +
        -rf16 * x[..., 2] +
        -rf17 * x[..., 22] +
        -rf18 * x[..., 23] +
        -rf19 * x[..., 4] +
        -rf20 * x[..., 5] +
        -rf21 * x[..., 25] +
        rf22 * x[..., 17] +
        rf23 * x[..., 18] +
        rf24 * x[..., 31] +
        rf25 * x[..., 21] +
        -rf26 * x[..., 11] +
        -rf27 * x[..., 12] +
        -rf28 * x[..., 30] +
        -rf29 * x[..., 15] +
        rf30 * x[..., 28] +
        rf31 * x[..., 24]
    )
    t8 = (
        rf0 * x[..., 8] +
        rf1 * x[..., 4] +
        -rf2 * x[..., 17] +
        rf3 * x[..., 19] +
        -rf4 * x[..., 1] +
        -rf5 * x[..., 21] +
        rf6 * x[..., 11] +
        -rf7 * x[..., 13] +
        rf8 * x[..., 0] +
        rf9 * x[..., 15] +
        rf10 * x[..., 26] +
        -rf11 * x[..., 6] +
        -rf12 * x[..., 28] +
        rf13 * x[..., 7] +
        rf14 * x[..., 29] +
        -rf15 * x[..., 9] +
        rf16 * x[..., 22] +
        -rf17 * x[..., 2] +
        -rf18 * x[..., 24] +
        rf19 * x[..., 3] +
        rf20 * x[..., 25] +
        -rf21 * x[..., 5] +
        -rf22 * x[..., 16] +
        -rf23 * x[..., 31] +
        rf24 * x[..., 18] +
        -rf25 * x[..., 20] +
        rf26 * x[..., 10] +
        rf27 * x[..., 30] +
        -rf28 * x[..., 12] +
        rf29 * x[..., 14] +
        -rf30 * x[..., 27] +
        -rf31 * x[..., 23]
    )
    t9 = (
        rf0 * x[..., 9] +
        rf1 * x[..., 5] +
        -rf2 * x[..., 18] +
        rf3 * x[..., 20] +
        rf4 * x[..., 21] +
        -rf5 * x[..., 1] +
        rf6 * x[..., 12] +
        -rf7 * x[..., 14] +
        -rf8 * x[..., 15] +
        rf9 * x[..., 0] +
        rf10 * x[..., 27] +
        rf11 * x[..., 28] +
        -rf12 * x[..., 6] +
        -rf13 * x[..., 29] +
        rf14 * x[..., 7] +
        rf15 * x[..., 8] +
        rf16 * x[..., 23] +
        rf17 * x[..., 24] +
        -rf18 * x[..., 2] +
        -rf19 * x[..., 25] +
        rf20 * x[..., 3] +
        rf21 * x[..., 4] +
        rf22 * x[..., 31] +
        -rf23 * x[..., 16] +
        -rf24 * x[..., 17] +
        rf25 * x[..., 19] +
        -rf26 * x[..., 30] +
        rf27 * x[..., 10] +
        rf28 * x[..., 11] +
        -rf29 * x[..., 13] +
        rf30 * x[..., 26] +
        rf31 * x[..., 22]
    )
    t10 = (
        rf0 * x[..., 10] +
        rf1 * x[..., 16] +
        rf2 * x[..., 3] +
        -rf3 * x[..., 2] +
        -rf4 * x[..., 22] +
        -rf5 * x[..., 23] +
        -rf6 * x[..., 7] +
        rf7 * x[..., 6] +
        rf8 * x[..., 26] +
        rf9 * x[..., 27] +
        rf10 * x[..., 0] +
        rf11 * x[..., 13] +
        rf12 * x[..., 14] +
        -rf13 * x[..., 11] +
        -rf14 * x[..., 12] +
        -rf15 * x[..., 30] +
        rf16 * x[..., 1] +
        rf17 * x[..., 19] +
        rf18 * x[..., 20] +
        -rf19 * x[..., 17] +
        -rf20 * x[..., 18] +
        -rf21 * x[..., 31] +
        -rf22 * x[..., 4] +
        -rf23 * x[..., 5] +
        -rf24 * x[..., 25] +
        rf25 * x[..., 24] +
        rf26 * x[..., 8] +
        rf27 * x[..., 9] +
        rf28 * x[..., 29] +
        -rf29 * x[..., 28] +
        -rf30 * x[..., 15] +
        -rf31 * x[..., 21]
    )
    t11 = (
        rf0 * x[..., 11] +
        rf1 * x[..., 17] +
        rf2 * x[..., 4] +
        rf3 * x[..., 22] +
        -rf4 * x[..., 2] +
        -rf5 * x[..., 24] +
        -rf6 * x[..., 8] +
        -rf7 * x[..., 26] +
        rf8 * x[..., 6] +
        rf9 * x[..., 28] +
        -rf10 * x[..., 13] +
        rf11 * x[..., 0] +
        rf12 * x[..., 15] +
        rf13 * x[..., 10] +
        rf14 * x[..., 30] +
        -rf15 * x[..., 12] +
        -rf16 * x[..., 19] +
        rf17 * x[..., 1] +
        rf18 * x[..., 21] +
        rf19 * x[..., 16] +
        rf20 * x[..., 31] +
        -rf21 * x[..., 18] +
        rf22 * x[..., 3] +
        rf23 * x[..., 25] +
        -rf24 * x[..., 5] +
        -rf25 * x[..., 23] +
        -rf26 * x[..., 7] +
        -rf27 * x[..., 29] +
        rf28 * x[..., 9] +
        rf29 * x[..., 27] +
        rf30 * x[..., 14] +
        rf31 * x[..., 20]
    )
    t12 = (
        rf0 * x[..., 12] +
        rf1 * x[..., 18] +
        rf2 * x[..., 5] +
        rf3 * x[..., 23] +
        rf4 * x[..., 24] +
        -rf5 * x[..., 2] +
        -rf6 * x[..., 9] +
        -rf7 * x[..., 27] +
        -rf8 * x[..., 28] +
        rf9 * x[..., 6] +
        -rf10 * x[..., 14] +
        -rf11 * x[..., 15] +
        rf12 * x[..., 0] +
        -rf13 * x[..., 30] +
        rf14 * x[..., 10] +
        rf15 * x[..., 11] +
        -rf16 * x[..., 20] +
        -rf17 * x[..., 21] +
        rf18 * x[..., 1] +
        -rf19 * x[..., 31] +
        rf20 * x[..., 16] +
        rf21 * x[..., 17] +
        -rf22 * x[..., 25] +
        rf23 * x[..., 3] +
        rf24 * x[..., 4] +
        rf25 * x[..., 22] +
        rf26 * x[..., 29] +
        -rf27 * x[..., 7] +
        -rf28 * x[..., 8] +
        -rf29 * x[..., 26] +
        -rf30 * x[..., 13] +
        -rf31 * x[..., 19]
    )
    t13 = (
        rf0 * x[..., 13] +
        rf1 * x[..., 19] +
        rf2 * x[..., 22] +
        rf3 * x[..., 4] +
        -rf4 * x[..., 3] +
        -rf5 * x[..., 25] +
        -rf6 * x[..., 26] +
        -rf7 * x[..., 8] +
        rf8 * x[..., 7] +
        rf9 * x[..., 29] +
        -rf10 * x[..., 11] +
        rf11 * x[..., 10] +
        rf12 * x[..., 30] +
        rf13 * x[..., 0] +
        rf14 * x[..., 15] +
        -rf15 * x[..., 14] +
        -rf16 * x[..., 17] +
        rf17 * x[..., 16] +
        rf18 * x[..., 31] +
        rf19 * x[..., 1] +
        rf20 * x[..., 21] +
        -rf21 * x[..., 20] +
        rf22 * x[..., 2] +
        rf23 * x[..., 24] +
        -rf24 * x[..., 23] +
        -rf25 * x[..., 5] +
        -rf26 * x[..., 6] +
        -rf27 * x[..., 28] +
        rf28 * x[..., 27] +
        rf29 * x[..., 9] +
        rf30 * x[..., 12] +
        rf31 * x[..., 18]
    )
    t14 = (
        rf0 * x[..., 14] +
        rf1 * x[..., 20] +
        rf2 * x[..., 23] +
        rf3 * x[..., 5] +
        rf4 * x[..., 25] +
        -rf5 * x[..., 3] +
        -rf6 * x[..., 27] +
        -rf7 * x[..., 9] +
        -rf8 * x[..., 29] +
        rf9 * x[..., 7] +
        -rf10 * x[..., 12] +
        -rf11 * x[..., 30] +
        rf12 * x[..., 10] +
        -rf13 * x[..., 15] +
        rf14 * x[..., 0] +
        rf15 * x[..., 13] +
        -rf16 * x[..., 18] +
        -rf17 * x[..., 31] +
        rf18 * x[..., 16] +
        -rf19 * x[..., 21] +
        rf20 * x[..., 1] +
        rf21 * x[..., 19] +
        -rf22 * x[..., 24] +
        rf23 * x[..., 2] +
        rf24 * x[..., 22] +
        rf25 * x[..., 4] +
        rf26 * x[..., 28] +
        -rf27 * x[..., 6] +
        -rf28 * x[..., 26] +
        -rf29 * x[..., 8] +
        -rf30 * x[..., 11] +
        -rf31 * x[..., 17]
    )
    t15 = (
        rf0 * x[..., 15] +
        rf1 * x[..., 21] +
        rf2 * x[..., 24] +
        -rf3 * x[..., 25] +
        rf4 * x[..., 5] +
        -rf5 * x[..., 4] +
        -rf6 * x[..., 28] +
        rf7 * x[..., 29] +
        -rf8 * x[..., 9] +
        rf9 * x[..., 8] +
        rf10 * x[..., 30] +
        -rf11 * x[..., 12] +
        rf12 * x[..., 11] +
        rf13 * x[..., 14] +
        -rf14 * x[..., 13] +
        rf15 * x[..., 0] +
        rf16 * x[..., 31] +
        -rf17 * x[..., 18] +
        rf18 * x[..., 17] +
        rf19 * x[..., 20] +
        -rf20 * x[..., 19] +
        rf21 * x[..., 1] +
        rf22 * x[..., 23] +
        -rf23 * x[..., 22] +
        rf24 * x[..., 2] +
        -rf25 * x[..., 3] +
        -rf26 * x[..., 27] +
        rf27 * x[..., 26] +
        -rf28 * x[..., 6] +
        rf29 * x[..., 7] +
        rf30 * x[..., 10] +
        rf31 * x[..., 16]
    )
    t16 = (
        rf0 * x[..., 16] +
        rf1 * x[..., 10] +
        -rf2 * x[..., 7] +
        rf3 * x[..., 6] +
        rf4 * x[..., 26] +
        rf5 * x[..., 27] +
        rf6 * x[..., 3] +
        -rf7 * x[..., 2] +
        -rf8 * x[..., 22] +
        -rf9 * x[..., 23] +
        rf10 * x[..., 1] +
        rf11 * x[..., 19] +
        rf12 * x[..., 20] +
        -rf13 * x[..., 17] +
        -rf14 * x[..., 18] +
        -rf15 * x[..., 31] +
        rf16 * x[..., 0] +
        rf17 * x[..., 13] +
        rf18 * x[..., 14] +
        -rf19 * x[..., 11] +
        -rf20 * x[..., 12] +
        -rf21 * x[..., 30] +
        rf22 * x[..., 8] +
        rf23 * x[..., 9] +
        rf24 * x[..., 29] +
        -rf25 * x[..., 28] +
        -rf26 * x[..., 4] +
        -rf27 * x[..., 5] +
        -rf28 * x[..., 25] +
        rf29 * x[..., 24] +
        -rf30 * x[..., 21] +
        -rf31 * x[..., 15]
    )
    t17 = (
        rf0 * x[..., 17] +
        rf1 * x[..., 11] +
        -rf2 * x[..., 8] +
        -rf3 * x[..., 26] +
        rf4 * x[..., 6] +
        rf5 * x[..., 28] +
        rf6 * x[..., 4] +
        rf7 * x[..., 22] +
        -rf8 * x[..., 2] +
        -rf9 * x[..., 24] +
        -rf10 * x[..., 19] +
        rf11 * x[..., 1] +
        rf12 * x[..., 21] +
        rf13 * x[..., 16] +
        rf14 * x[..., 31] +
        -rf15 * x[..., 18] +
        -rf16 * x[..., 13] +
        rf17 * x[..., 0] +
        rf18 * x[..., 15] +
        rf19 * x[..., 10] +
        rf20 * x[..., 30] +
        -rf21 * x[..., 12] +
        -rf22 * x[..., 7] +
        -rf23 * x[..., 29] +
        rf24 * x[..., 9] +
        rf25 * x[..., 27] +
        rf26 * x[..., 3] +
        rf27 * x[..., 25] +
        -rf28 * x[..., 5] +
        -rf29 * x[..., 23] +
        rf30 * x[..., 20] +
        rf31 * x[..., 14]
    )
    t18 = (
        rf0 * x[..., 18] +
        rf1 * x[..., 12] +
        -rf2 * x[..., 9] +
        -rf3 * x[..., 27] +
        -rf4 * x[..., 28] +
        rf5 * x[..., 6] +
        rf6 * x[..., 5] +
        rf7 * x[..., 23] +
        rf8 * x[..., 24] +
        -rf9 * x[..., 2] +
        -rf10 * x[..., 20] +
        -rf11 * x[..., 21] +
        rf12 * x[..., 1] +
        -rf13 * x[..., 31] +
        rf14 * x[..., 16] +
        rf15 * x[..., 17] +
        -rf16 * x[..., 14] +
        -rf17 * x[..., 15] +
        rf18 * x[..., 0] +
        -rf19 * x[..., 30] +
        rf20 * x[..., 10] +
        rf21 * x[..., 11] +
        rf22 * x[..., 29] +
        -rf23 * x[..., 7] +
        -rf24 * x[..., 8] +
        -rf25 * x[..., 26] +
        -rf26 * x[..., 25] +
        rf27 * x[..., 3] +
        rf28 * x[..., 4] +
        rf29 * x[..., 22] +
        -rf30 * x[..., 19] +
        -rf31 * x[..., 13]
    )
    t19 = (
        rf0 * x[..., 19] +
        rf1 * x[..., 13] +
        -rf2 * x[..., 26] +
        -rf3 * x[..., 8] +
        rf4 * x[..., 7] +
        rf5 * x[..., 29] +
        rf6 * x[..., 22] +
        rf7 * x[..., 4] +
        -rf8 * x[..., 3] +
        -rf9 * x[..., 25] +
        -rf10 * x[..., 17] +
        rf11 * x[..., 16] +
        rf12 * x[..., 31] +
        rf13 * x[..., 1] +
        rf14 * x[..., 21] +
        -rf15 * x[..., 20] +
        -rf16 * x[..., 11] +
        rf17 * x[..., 10] +
        rf18 * x[..., 30] +
        rf19 * x[..., 0] +
        rf20 * x[..., 15] +
        -rf21 * x[..., 14] +
        -rf22 * x[..., 6] +
        -rf23 * x[..., 28] +
        rf24 * x[..., 27] +
        rf25 * x[..., 9] +
        rf26 * x[..., 2] +
        rf27 * x[..., 24] +
        -rf28 * x[..., 23] +
        -rf29 * x[..., 5] +
        rf30 * x[..., 18] +
        rf31 * x[..., 12]
    )
    t20 = (
        rf0 * x[..., 20] +
        rf1 * x[..., 14] +
        -rf2 * x[..., 27] +
        -rf3 * x[..., 9] +
        -rf4 * x[..., 29] +
        rf5 * x[..., 7] +
        rf6 * x[..., 23] +
        rf7 * x[..., 5] +
        rf8 * x[..., 25] +
        -rf9 * x[..., 3] +
        -rf10 * x[..., 18] +
        -rf11 * x[..., 31] +
        rf12 * x[..., 16] +
        -rf13 * x[..., 21] +
        rf14 * x[..., 1] +
        rf15 * x[..., 19] +
        -rf16 * x[..., 12] +
        -rf17 * x[..., 30] +
        rf18 * x[..., 10] +
        -rf19 * x[..., 15] +
        rf20 * x[..., 0] +
        rf21 * x[..., 13] +
        rf22 * x[..., 28] +
        -rf23 * x[..., 6] +
        -rf24 * x[..., 26] +
        -rf25 * x[..., 8] +
        -rf26 * x[..., 24] +
        rf27 * x[..., 2] +
        rf28 * x[..., 22] +
        rf29 * x[..., 4] +
        -rf30 * x[..., 17] +
        -rf31 * x[..., 11]
    )
    t21 = (
        rf0 * x[..., 21] +
        rf1 * x[..., 15] +
        -rf2 * x[..., 28] +
        rf3 * x[..., 29] +
        -rf4 * x[..., 9] +
        rf5 * x[..., 8] +
        rf6 * x[..., 24] +
        -rf7 * x[..., 25] +
        rf8 * x[..., 5] +
        -rf9 * x[..., 4] +
        rf10 * x[..., 31] +
        -rf11 * x[..., 18] +
        rf12 * x[..., 17] +
        rf13 * x[..., 20] +
        -rf14 * x[..., 19] +
        rf15 * x[..., 1] +
        rf16 * x[..., 30] +
        -rf17 * x[..., 12] +
        rf18 * x[..., 11] +
        rf19 * x[..., 14] +
        -rf20 * x[..., 13] +
        rf21 * x[..., 0] +
        -rf22 * x[..., 27] +
        rf23 * x[..., 26] +
        -rf24 * x[..., 6] +
        rf25 * x[..., 7] +
        rf26 * x[..., 23] +
        -rf27 * x[..., 22] +
        rf28 * x[..., 2] +
        -rf29 * x[..., 3] +
        rf30 * x[..., 16] +
        rf31 * x[..., 10]
    )
    t22 = (
        rf0 * x[..., 22] +
        rf1 * x[..., 26] +
        rf2 * x[..., 13] +
        -rf3 * x[..., 11] +
        rf4 * x[..., 10] +
        rf5 * x[..., 30] +
        -rf6 * x[..., 19] +
        rf7 * x[..., 17] +
        -rf8 * x[..., 16] +
        -rf9 * x[..., 31] +
        rf10 * x[..., 4] +
        -rf11 * x[..., 3] +
        -rf12 * x[..., 25] +
        rf13 * x[..., 2] +
        rf14 * x[..., 24] +
        -rf15 * x[..., 23] +
        rf16 * x[..., 8] +
        -rf17 * x[..., 7] +
        -rf18 * x[..., 29] +
        rf19 * x[..., 6] +
        rf20 * x[..., 28] +
        -rf21 * x[..., 27] +
        rf22 * x[..., 0] +
        rf23 * x[..., 15] +
        -rf24 * x[..., 14] +
        rf25 * x[..., 12] +
        -rf26 * x[..., 1] +
        -rf27 * x[..., 21] +
        rf28 * x[..., 20] +
        -rf29 * x[..., 18] +
        -rf30 * x[..., 5] +
        -rf31 * x[..., 9]
    )
    t23 = (
        rf0 * x[..., 23] +
        rf1 * x[..., 27] +
        rf2 * x[..., 14] +
        -rf3 * x[..., 12] +
        -rf4 * x[..., 30] +
        rf5 * x[..., 10] +
        -rf6 * x[..., 20] +
        rf7 * x[..., 18] +
        rf8 * x[..., 31] +
        -rf9 * x[..., 16] +
        rf10 * x[..., 5] +
        rf11 * x[..., 25] +
        -rf12 * x[..., 3] +
        -rf13 * x[..., 24] +
        rf14 * x[..., 2] +
        rf15 * x[..., 22] +
        rf16 * x[..., 9] +
        rf17 * x[..., 29] +
        -rf18 * x[..., 7] +
        -rf19 * x[..., 28] +
        rf20 * x[..., 6] +
        rf21 * x[..., 26] +
        -rf22 * x[..., 15] +
        rf23 * x[..., 0] +
        rf24 * x[..., 13] +
        -rf25 * x[..., 11] +
        rf26 * x[..., 21] +
        -rf27 * x[..., 1] +
        -rf28 * x[..., 19] +
        rf29 * x[..., 17] +
        rf30 * x[..., 4] +
        rf31 * x[..., 8]
    )
    t24 = (
        rf0 * x[..., 24] +
        rf1 * x[..., 28] +
        rf2 * x[..., 15] +
        rf3 * x[..., 30] +
        -rf4 * x[..., 12] +
        rf5 * x[..., 11] +
        -rf6 * x[..., 21] +
        -rf7 * x[..., 31] +
        rf8 * x[..., 18] +
        -rf9 * x[..., 17] +
        -rf10 * x[..., 25] +
        rf11 * x[..., 5] +
        -rf12 * x[..., 4] +
        rf13 * x[..., 23] +
        -rf14 * x[..., 22] +
        rf15 * x[..., 2] +
        -rf16 * x[..., 29] +
        rf17 * x[..., 9] +
        -rf18 * x[..., 8] +
        rf19 * x[..., 27] +
        -rf20 * x[..., 26] +
        rf21 * x[..., 6] +
        rf22 * x[..., 14] +
        -rf23 * x[..., 13] +
        rf24 * x[..., 0] +
        rf25 * x[..., 10] +
        -rf26 * x[..., 20] +
        rf27 * x[..., 19] +
        -rf28 * x[..., 1] +
        -rf29 * x[..., 16] +
        -rf30 * x[..., 3] +
        -rf31 * x[..., 7]
    )
    t25 = (
        rf0 * x[..., 25] +
        rf1 * x[..., 29] +
        rf2 * x[..., 30] +
        rf3 * x[..., 15] +
        -rf4 * x[..., 14] +
        rf5 * x[..., 13] +
        -rf6 * x[..., 31] +
        -rf7 * x[..., 21] +
        rf8 * x[..., 20] +
        -rf9 * x[..., 19] +
        -rf10 * x[..., 24] +
        rf11 * x[..., 23] +
        -rf12 * x[..., 22] +
        rf13 * x[..., 5] +
        -rf14 * x[..., 4] +
        rf15 * x[..., 3] +
        -rf16 * x[..., 28] +
        rf17 * x[..., 27] +
        -rf18 * x[..., 26] +
        rf19 * x[..., 9] +
        -rf20 * x[..., 8] +
        rf21 * x[..., 7] +
        rf22 * x[..., 12] +
        -rf23 * x[..., 11] +
        rf24 * x[..., 10] +
        rf25 * x[..., 0] +
        -rf26 * x[..., 18] +
        rf27 * x[..., 17] +
        -rf28 * x[..., 16] +
        -rf29 * x[..., 1] +
        -rf30 * x[..., 2] +
        -rf31 * x[..., 6]
    )
    t26 = (
        rf0 * x[..., 26] +
        rf1 * x[..., 22] +
        -rf2 * x[..., 19] +
        rf3 * x[..., 17] +
        -rf4 * x[..., 16] +
        -rf5 * x[..., 31] +
        rf6 * x[..., 13] +
        -rf7 * x[..., 11] +
        rf8 * x[..., 10] +
        rf9 * x[..., 30] +
        rf10 * x[..., 8] +
        -rf11 * x[..., 7] +
        -rf12 * x[..., 29] +
        rf13 * x[..., 6] +
        rf14 * x[..., 28] +
        -rf15 * x[..., 27] +
        rf16 * x[..., 4] +
        -rf17 * x[..., 3] +
        -rf18 * x[..., 25] +
        rf19 * x[..., 2] +
        rf20 * x[..., 24] +
        -rf21 * x[..., 23] +
        -rf22 * x[..., 1] +
        -rf23 * x[..., 21] +
        rf24 * x[..., 20] +
        -rf25 * x[..., 18] +
        rf26 * x[..., 0] +
        rf27 * x[..., 15] +
        -rf28 * x[..., 14] +
        rf29 * x[..., 12] +
        -rf30 * x[..., 9] +
        -rf31 * x[..., 5]
    )
    t27 = (
        rf0 * x[..., 27] +
        rf1 * x[..., 23] +
        -rf2 * x[..., 20] +
        rf3 * x[..., 18] +
        rf4 * x[..., 31] +
        -rf5 * x[..., 16] +
        rf6 * x[..., 14] +
        -rf7 * x[..., 12] +
        -rf8 * x[..., 30] +
        rf9 * x[..., 10] +
        rf10 * x[..., 9] +
        rf11 * x[..., 29] +
        -rf12 * x[..., 7] +
        -rf13 * x[..., 28] +
        rf14 * x[..., 6] +
        rf15 * x[..., 26] +
        rf16 * x[..., 5] +
        rf17 * x[..., 25] +
        -rf18 * x[..., 3] +
        -rf19 * x[..., 24] +
        rf20 * x[..., 2] +
        rf21 * x[..., 22] +
        rf22 * x[..., 21] +
        -rf23 * x[..., 1] +
        -rf24 * x[..., 19] +
        rf25 * x[..., 17] +
        -rf26 * x[..., 15] +
        rf27 * x[..., 0] +
        rf28 * x[..., 13] +
        -rf29 * x[..., 11] +
        rf30 * x[..., 8] +
        rf31 * x[..., 4]
    )
    t28 = (
        rf0 * x[..., 28] +
        rf1 * x[..., 24] +
        -rf2 * x[..., 21] +
        -rf3 * x[..., 31] +
        rf4 * x[..., 18] +
        -rf5 * x[..., 17] +
        rf6 * x[..., 15] +
        rf7 * x[..., 30] +
        -rf8 * x[..., 12] +
        rf9 * x[..., 11] +
        -rf10 * x[..., 29] +
        rf11 * x[..., 9] +
        -rf12 * x[..., 8] +
        rf13 * x[..., 27] +
        -rf14 * x[..., 26] +
        rf15 * x[..., 6] +
        -rf16 * x[..., 25] +
        rf17 * x[..., 5] +
        -rf18 * x[..., 4] +
        rf19 * x[..., 23] +
        -rf20 * x[..., 22] +
        rf21 * x[..., 2] +
        -rf22 * x[..., 20] +
        rf23 * x[..., 19] +
        -rf24 * x[..., 1] +
        -rf25 * x[..., 16] +
        rf26 * x[..., 14] +
        -rf27 * x[..., 13] +
        rf28 * x[..., 0] +
        rf29 * x[..., 10] +
        -rf30 * x[..., 7] +
        -rf31 * x[..., 3]
    )
    t29 = (
        rf0 * x[..., 29] +
        rf1 * x[..., 25] +
        -rf2 * x[..., 31] +
        -rf3 * x[..., 21] +
        rf4 * x[..., 20] +
        -rf5 * x[..., 19] +
        rf6 * x[..., 30] +
        rf7 * x[..., 15] +
        -rf8 * x[..., 14] +
        rf9 * x[..., 13] +
        -rf10 * x[..., 28] +
        rf11 * x[..., 27] +
        -rf12 * x[..., 26] +
        rf13 * x[..., 9] +
        -rf14 * x[..., 8] +
        rf15 * x[..., 7] +
        -rf16 * x[..., 24] +
        rf17 * x[..., 23] +
        -rf18 * x[..., 22] +
        rf19 * x[..., 5] +
        -rf20 * x[..., 4] +
        rf21 * x[..., 3] +
        -rf22 * x[..., 18] +
        rf23 * x[..., 17] +
        -rf24 * x[..., 16] +
        -rf25 * x[..., 1] +
        rf26 * x[..., 12] +
        -rf27 * x[..., 11] +
        rf28 * x[..., 10] +
        rf29 * x[..., 0] +
        -rf30 * x[..., 6] +
        -rf31 * x[..., 2]
    )
    t30 = (
        rf0 * x[..., 30] +
        rf1 * x[..., 31] +
        rf2 * x[..., 25] +
        -rf3 * x[..., 24] +
        rf4 * x[..., 23] +
        -rf5 * x[..., 22] +
        -rf6 * x[..., 29] +
        rf7 * x[..., 28] +
        -rf8 * x[..., 27] +
        rf9 * x[..., 26] +
        rf10 * x[..., 15] +
        -rf11 * x[..., 14] +
        rf12 * x[..., 13] +
        rf13 * x[..., 12] +
        -rf14 * x[..., 11] +
        rf15 * x[..., 10] +
        rf16 * x[..., 21] +
        -rf17 * x[..., 20] +
        rf18 * x[..., 19] +
        rf19 * x[..., 18] +
        -rf20 * x[..., 17] +
        rf21 * x[..., 16] +
        rf22 * x[..., 5] +
        -rf23 * x[..., 4] +
        rf24 * x[..., 3] +
        -rf25 * x[..., 2] +
        -rf26 * x[..., 9] +
        rf27 * x[..., 8] +
        -rf28 * x[..., 7] +
        rf29 * x[..., 6] +
        rf30 * x[..., 0] +
        rf31 * x[..., 1]
    )
    t31 = (
        rf0 * x[..., 31] +
        rf1 * x[..., 30] +
        -rf2 * x[..., 29] +
        rf3 * x[..., 28] +
        -rf4 * x[..., 27] +
        rf5 * x[..., 26] +
        rf6 * x[..., 25] +
        -rf7 * x[..., 24] +
        rf8 * x[..., 23] +
        -rf9 * x[..., 22] +
        rf10 * x[..., 21] +
        -rf11 * x[..., 20] +
        rf12 * x[..., 19] +
        rf13 * x[..., 18] +
        -rf14 * x[..., 17] +
        rf15 * x[..., 16] +
        rf16 * x[..., 15] +
        -rf17 * x[..., 14] +
        rf18 * x[..., 13] +
        rf19 * x[..., 12] +
        -rf20 * x[..., 11] +
        rf21 * x[..., 10] +
        -rf22 * x[..., 9] +
        rf23 * x[..., 8] +
        -rf24 * x[..., 7] +
        rf25 * x[..., 6] +
        rf26 * x[..., 5] +
        -rf27 * x[..., 4] +
        rf28 * x[..., 3] +
        -rf29 * x[..., 2] +
        rf30 * x[..., 1] +
        rf31 * x[..., 0]
    )

    # Compute ~r
    rr0 = rf0
    rr1 = torch.zeros_like(r[..., 0])
    rr2 = torch.zeros_like(r[..., 0])
    rr3 = torch.zeros_like(r[..., 0])
    rr4 = torch.zeros_like(r[..., 0])
    rr5 = torch.zeros_like(r[..., 0])
    rr6 = -rf6
    rr7 = -rf7
    rr8 = -rf8
    rr9 = -rf9
    rr10 = -rf10
    rr11 = -rf11
    rr12 = -rf12
    rr13 = -rf13
    rr14 = -rf14
    rr15 = -rf15
    rr16 = torch.zeros_like(r[..., 0])
    rr17 = torch.zeros_like(r[..., 0])
    rr18 = torch.zeros_like(r[..., 0])
    rr19 = torch.zeros_like(r[..., 0])
    rr20 = torch.zeros_like(r[..., 0])
    rr21 = torch.zeros_like(r[..., 0])
    rr22 = torch.zeros_like(r[..., 0])
    rr23 = torch.zeros_like(r[..., 0])
    rr24 = torch.zeros_like(r[..., 0])
    rr25 = torch.zeros_like(r[..., 0])
    rr26 = rf26
    rr27 = rf27
    rr28 = rf28
    rr29 = rf29
    rr30 = rf30
    rr31 = torch.zeros_like(r[..., 0])

    # Compute (r * x) * ~r
    s0 = (
        t0 * rr0 +
        t1 * rr1 +
        t2 * rr2 +
        -t3 * rr3 +
        -t4 * rr4 +
        -t5 * rr5 +
        -t6 * rr6 +
        t7 * rr7 +
        t8 * rr8 +
        t9 * rr9 +
        t10 * rr10 +
        t11 * rr11 +
        t12 * rr12 +
        -t13 * rr13 +
        -t14 * rr14 +
        -t15 * rr15 +
        t16 * rr16 +
        t17 * rr17 +
        t18 * rr18 +
        -t19 * rr19 +
        -t20 * rr20 +
        -t21 * rr21 +
        -t22 * rr22 +
        -t23 * rr23 +
        -t24 * rr24 +
        t25 * rr25 +
        t26 * rr26 +
        t27 * rr27 +
        t28 * rr28 +
        -t29 * rr29 +
        -t30 * rr30 +
        -t31 * rr31
    )
    s1 = (
        t0 * rr1 +
        t1 * rr0 +
        -t2 * rr6 +
        t3 * rr7 +
        t4 * rr8 +
        t5 * rr9 +
        t6 * rr2 +
        -t7 * rr3 +
        -t8 * rr4 +
        -t9 * rr5 +
        t10 * rr16 +
        t11 * rr17 +
        t12 * rr18 +
        -t13 * rr19 +
        -t14 * rr20 +
        -t15 * rr21 +
        t16 * rr10 +
        t17 * rr11 +
        t18 * rr12 +
        -t19 * rr13 +
        -t20 * rr14 +
        -t21 * rr15 +
        t22 * rr26 +
        t23 * rr27 +
        t24 * rr28 +
        -t25 * rr29 +
        -t26 * rr22 +
        -t27 * rr23 +
        -t28 * rr24 +
        t29 * rr25 +
        -t30 * rr31 +
        -t31 * rr30
    )
    s2 = (
        t0 * rr2 +
        t1 * rr6 +
        t2 * rr0 +
        t3 * rr10 +
        t4 * rr11 +
        t5 * rr12 +
        -t6 * rr1 +
        -t7 * rr16 +
        -t8 * rr17 +
        -t9 * rr18 +
        -t10 * rr3 +
        -t11 * rr4 +
        -t12 * rr5 +
        -t13 * rr22 +
        -t14 * rr23 +
        -t15 * rr24 +
        -t16 * rr7 +
        -t17 * rr8 +
        -t18 * rr9 +
        -t19 * rr26 +
        -t20 * rr27 +
        -t21 * rr28 +
        -t22 * rr13 +
        -t23 * rr14 +
        -t24 * rr15 +
        -t25 * rr30 +
        t26 * rr19 +
        t27 * rr20 +
        t28 * rr21 +
        t29 * rr31 +
        t30 * rr25 +
        t31 * rr29
    )
    s3 = (
        t0 * rr3 +
        t1 * rr7 +
        t2 * rr10 +
        t3 * rr0 +
        t4 * rr13 +
        t5 * rr14 +
        -t6 * rr16 +
        -t7 * rr1 +
        -t8 * rr19 +
        -t9 * rr20 +
        -t10 * rr2 +
        -t11 * rr22 +
        -t12 * rr23 +
        -t13 * rr4 +
        -t14 * rr5 +
        -t15 * rr25 +
        -t16 * rr6 +
        -t17 * rr26 +
        -t18 * rr27 +
        -t19 * rr8 +
        -t20 * rr9 +
        -t21 * rr29 +
        -t22 * rr11 +
        -t23 * rr12 +
        -t24 * rr30 +
        -t25 * rr15 +
        t26 * rr17 +
        t27 * rr18 +
        t28 * rr31 +
        t29 * rr21 +
        t30 * rr24 +
        t31 * rr28
    )
    s4 = (
        t0 * rr4 +
        t1 * rr8 +
        t2 * rr11 +
        -t3 * rr13 +
        t4 * rr0 +
        t5 * rr15 +
        -t6 * rr17 +
        t7 * rr19 +
        -t8 * rr1 +
        -t9 * rr21 +
        t10 * rr22 +
        -t11 * rr2 +
        -t12 * rr24 +
        t13 * rr3 +
        t14 * rr25 +
        -t15 * rr5 +
        t16 * rr26 +
        -t17 * rr6 +
        -t18 * rr28 +
        t19 * rr7 +
        t20 * rr29 +
        -t21 * rr9 +
        t22 * rr10 +
        t23 * rr30 +
        -t24 * rr12 +
        t25 * rr14 +
        -t26 * rr16 +
        -t27 * rr31 +
        t28 * rr18 +
        -t29 * rr20 +
        -t30 * rr23 +
        -t31 * rr27
    )
    s5 = (
        t0 * rr5 +
        t1 * rr9 +
        t2 * rr12 +
        -t3 * rr14 +
        -t4 * rr15 +
        t5 * rr0 +
        -t6 * rr18 +
        t7 * rr20 +
        t8 * rr21 +
        -t9 * rr1 +
        t10 * rr23 +
        t11 * rr24 +
        -t12 * rr2 +
        -t13 * rr25 +
        t14 * rr3 +
        t15 * rr4 +
        t16 * rr27 +
        t17 * rr28 +
        -t18 * rr6 +
        -t19 * rr29 +
        t20 * rr7 +
        t21 * rr8 +
        -t22 * rr30 +
        t23 * rr10 +
        t24 * rr11 +
        -t25 * rr13 +
        t26 * rr31 +
        -t27 * rr16 +
        -t28 * rr17 +
        t29 * rr19 +
        t30 * rr22 +
        t31 * rr26
    )
    s6 = (
        t0 * rr6 +
        t1 * rr2 +
        -t2 * rr1 +
        -t3 * rr16 +
        -t4 * rr17 +
        -t5 * rr18 +
        t6 * rr0 +
        t7 * rr10 +
        t8 * rr11 +
        t9 * rr12 +
        -t10 * rr7 +
        -t11 * rr8 +
        -t12 * rr9 +
        -t13 * rr26 +
        -t14 * rr27 +
        -t15 * rr28 +
        -t16 * rr3 +
        -t17 * rr4 +
        -t18 * rr5 +
        -t19 * rr22 +
        -t20 * rr23 +
        -t21 * rr24 +
        t22 * rr19 +
        t23 * rr20 +
        t24 * rr21 +
        t25 * rr31 +
        -t26 * rr13 +
        -t27 * rr14 +
        -t28 * rr15 +
        -t29 * rr30 +
        t30 * rr29 +
        t31 * rr25
    )
    s7 = (
        t0 * rr7 +
        t1 * rr3 +
        -t2 * rr16 +
        -t3 * rr1 +
        -t4 * rr19 +
        -t5 * rr20 +
        t6 * rr10 +
        t7 * rr0 +
        t8 * rr13 +
        t9 * rr14 +
        -t10 * rr6 +
        -t11 * rr26 +
        -t12 * rr27 +
        -t13 * rr8 +
        -t14 * rr9 +
        -t15 * rr29 +
        -t16 * rr2 +
        -t17 * rr22 +
        -t18 * rr23 +
        -t19 * rr4 +
        -t20 * rr5 +
        -t21 * rr25 +
        t22 * rr17 +
        t23 * rr18 +
        t24 * rr31 +
        t25 * rr21 +
        -t26 * rr11 +
        -t27 * rr12 +
        -t28 * rr30 +
        -t29 * rr15 +
        t30 * rr28 +
        t31 * rr24
    )
    s8 = (
        t0 * rr8 +
        t1 * rr4 +
        -t2 * rr17 +
        t3 * rr19 +
        -t4 * rr1 +
        -t5 * rr21 +
        t6 * rr11 +
        -t7 * rr13 +
        t8 * rr0 +
        t9 * rr15 +
        t10 * rr26 +
        -t11 * rr6 +
        -t12 * rr28 +
        t13 * rr7 +
        t14 * rr29 +
        -t15 * rr9 +
        t16 * rr22 +
        -t17 * rr2 +
        -t18 * rr24 +
        t19 * rr3 +
        t20 * rr25 +
        -t21 * rr5 +
        -t22 * rr16 +
        -t23 * rr31 +
        t24 * rr18 +
        -t25 * rr20 +
        t26 * rr10 +
        t27 * rr30 +
        -t28 * rr12 +
        t29 * rr14 +
        -t30 * rr27 +
        -t31 * rr23
    )
    s9 = (
        t0 * rr9 +
        t1 * rr5 +
        -t2 * rr18 +
        t3 * rr20 +
        t4 * rr21 +
        -t5 * rr1 +
        t6 * rr12 +
        -t7 * rr14 +
        -t8 * rr15 +
        t9 * rr0 +
        t10 * rr27 +
        t11 * rr28 +
        -t12 * rr6 +
        -t13 * rr29 +
        t14 * rr7 +
        t15 * rr8 +
        t16 * rr23 +
        t17 * rr24 +
        -t18 * rr2 +
        -t19 * rr25 +
        t20 * rr3 +
        t21 * rr4 +
        t22 * rr31 +
        -t23 * rr16 +
        -t24 * rr17 +
        t25 * rr19 +
        -t26 * rr30 +
        t27 * rr10 +
        t28 * rr11 +
        -t29 * rr13 +
        t30 * rr26 +
        t31 * rr22
    )
    s10 = (
        t0 * rr10 +
        t1 * rr16 +
        t2 * rr3 +
        -t3 * rr2 +
        -t4 * rr22 +
        -t5 * rr23 +
        -t6 * rr7 +
        t7 * rr6 +
        t8 * rr26 +
        t9 * rr27 +
        t10 * rr0 +
        t11 * rr13 +
        t12 * rr14 +
        -t13 * rr11 +
        -t14 * rr12 +
        -t15 * rr30 +
        t16 * rr1 +
        t17 * rr19 +
        t18 * rr20 +
        -t19 * rr17 +
        -t20 * rr18 +
        -t21 * rr31 +
        -t22 * rr4 +
        -t23 * rr5 +
        -t24 * rr25 +
        t25 * rr24 +
        t26 * rr8 +
        t27 * rr9 +
        t28 * rr29 +
        -t29 * rr28 +
        -t30 * rr15 +
        -t31 * rr21
    )
    s11 = (
        t0 * rr11 +
        t1 * rr17 +
        t2 * rr4 +
        t3 * rr22 +
        -t4 * rr2 +
        -t5 * rr24 +
        -t6 * rr8 +
        -t7 * rr26 +
        t8 * rr6 +
        t9 * rr28 +
        -t10 * rr13 +
        t11 * rr0 +
        t12 * rr15 +
        t13 * rr10 +
        t14 * rr30 +
        -t15 * rr12 +
        -t16 * rr19 +
        t17 * rr1 +
        t18 * rr21 +
        t19 * rr16 +
        t20 * rr31 +
        -t21 * rr18 +
        t22 * rr3 +
        t23 * rr25 +
        -t24 * rr5 +
        -t25 * rr23 +
        -t26 * rr7 +
        -t27 * rr29 +
        t28 * rr9 +
        t29 * rr27 +
        t30 * rr14 +
        t31 * rr20
    )
    s12 = (
        t0 * rr12 +
        t1 * rr18 +
        t2 * rr5 +
        t3 * rr23 +
        t4 * rr24 +
        -t5 * rr2 +
        -t6 * rr9 +
        -t7 * rr27 +
        -t8 * rr28 +
        t9 * rr6 +
        -t10 * rr14 +
        -t11 * rr15 +
        t12 * rr0 +
        -t13 * rr30 +
        t14 * rr10 +
        t15 * rr11 +
        -t16 * rr20 +
        -t17 * rr21 +
        t18 * rr1 +
        -t19 * rr31 +
        t20 * rr16 +
        t21 * rr17 +
        -t22 * rr25 +
        t23 * rr3 +
        t24 * rr4 +
        t25 * rr22 +
        t26 * rr29 +
        -t27 * rr7 +
        -t28 * rr8 +
        -t29 * rr26 +
        -t30 * rr13 +
        -t31 * rr19
    )
    s13 = (
        t0 * rr13 +
        t1 * rr19 +
        t2 * rr22 +
        t3 * rr4 +
        -t4 * rr3 +
        -t5 * rr25 +
        -t6 * rr26 +
        -t7 * rr8 +
        t8 * rr7 +
        t9 * rr29 +
        -t10 * rr11 +
        t11 * rr10 +
        t12 * rr30 +
        t13 * rr0 +
        t14 * rr15 +
        -t15 * rr14 +
        -t16 * rr17 +
        t17 * rr16 +
        t18 * rr31 +
        t19 * rr1 +
        t20 * rr21 +
        -t21 * rr20 +
        t22 * rr2 +
        t23 * rr24 +
        -t24 * rr23 +
        -t25 * rr5 +
        -t26 * rr6 +
        -t27 * rr28 +
        t28 * rr27 +
        t29 * rr9 +
        t30 * rr12 +
        t31 * rr18
    )
    s14 = (
        t0 * rr14 +
        t1 * rr20 +
        t2 * rr23 +
        t3 * rr5 +
        t4 * rr25 +
        -t5 * rr3 +
        -t6 * rr27 +
        -t7 * rr9 +
        -t8 * rr29 +
        t9 * rr7 +
        -t10 * rr12 +
        -t11 * rr30 +
        t12 * rr10 +
        -t13 * rr15 +
        t14 * rr0 +
        t15 * rr13 +
        -t16 * rr18 +
        -t17 * rr31 +
        t18 * rr16 +
        -t19 * rr21 +
        t20 * rr1 +
        t21 * rr19 +
        -t22 * rr24 +
        t23 * rr2 +
        t24 * rr22 +
        t25 * rr4 +
        t26 * rr28 +
        -t27 * rr6 +
        -t28 * rr26 +
        -t29 * rr8 +
        -t30 * rr11 +
        -t31 * rr17
    )
    s15 = (
        t0 * rr15 +
        t1 * rr21 +
        t2 * rr24 +
        -t3 * rr25 +
        t4 * rr5 +
        -t5 * rr4 +
        -t6 * rr28 +
        t7 * rr29 +
        -t8 * rr9 +
        t9 * rr8 +
        t10 * rr30 +
        -t11 * rr12 +
        t12 * rr11 +
        t13 * rr14 +
        -t14 * rr13 +
        t15 * rr0 +
        t16 * rr31 +
        -t17 * rr18 +
        t18 * rr17 +
        t19 * rr20 +
        -t20 * rr19 +
        t21 * rr1 +
        t22 * rr23 +
        -t23 * rr22 +
        t24 * rr2 +
        -t25 * rr3 +
        -t26 * rr27 +
        t27 * rr26 +
        -t28 * rr6 +
        t29 * rr7 +
        t30 * rr10 +
        t31 * rr16
    )
    s16 = (
        t0 * rr16 +
        t1 * rr10 +
        -t2 * rr7 +
        t3 * rr6 +
        t4 * rr26 +
        t5 * rr27 +
        t6 * rr3 +
        -t7 * rr2 +
        -t8 * rr22 +
        -t9 * rr23 +
        t10 * rr1 +
        t11 * rr19 +
        t12 * rr20 +
        -t13 * rr17 +
        -t14 * rr18 +
        -t15 * rr31 +
        t16 * rr0 +
        t17 * rr13 +
        t18 * rr14 +
        -t19 * rr11 +
        -t20 * rr12 +
        -t21 * rr30 +
        t22 * rr8 +
        t23 * rr9 +
        t24 * rr29 +
        -t25 * rr28 +
        -t26 * rr4 +
        -t27 * rr5 +
        -t28 * rr25 +
        t29 * rr24 +
        -t30 * rr21 +
        -t31 * rr15
    )
    s17 = (
        t0 * rr17 +
        t1 * rr11 +
        -t2 * rr8 +
        -t3 * rr26 +
        t4 * rr6 +
        t5 * rr28 +
        t6 * rr4 +
        t7 * rr22 +
        -t8 * rr2 +
        -t9 * rr24 +
        -t10 * rr19 +
        t11 * rr1 +
        t12 * rr21 +
        t13 * rr16 +
        t14 * rr31 +
        -t15 * rr18 +
        -t16 * rr13 +
        t17 * rr0 +
        t18 * rr15 +
        t19 * rr10 +
        t20 * rr30 +
        -t21 * rr12 +
        -t22 * rr7 +
        -t23 * rr29 +
        t24 * rr9 +
        t25 * rr27 +
        t26 * rr3 +
        t27 * rr25 +
        -t28 * rr5 +
        -t29 * rr23 +
        t30 * rr20 +
        t31 * rr14
    )
    s18 = (
        t0 * rr18 +
        t1 * rr12 +
        -t2 * rr9 +
        -t3 * rr27 +
        -t4 * rr28 +
        t5 * rr6 +
        t6 * rr5 +
        t7 * rr23 +
        t8 * rr24 +
        -t9 * rr2 +
        -t10 * rr20 +
        -t11 * rr21 +
        t12 * rr1 +
        -t13 * rr31 +
        t14 * rr16 +
        t15 * rr17 +
        -t16 * rr14 +
        -t17 * rr15 +
        t18 * rr0 +
        -t19 * rr30 +
        t20 * rr10 +
        t21 * rr11 +
        t22 * rr29 +
        -t23 * rr7 +
        -t24 * rr8 +
        -t25 * rr26 +
        -t26 * rr25 +
        t27 * rr3 +
        t28 * rr4 +
        t29 * rr22 +
        -t30 * rr19 +
        -t31 * rr13
    )
    s19 = (
        t0 * rr19 +
        t1 * rr13 +
        -t2 * rr26 +
        -t3 * rr8 +
        t4 * rr7 +
        t5 * rr29 +
        t6 * rr22 +
        t7 * rr4 +
        -t8 * rr3 +
        -t9 * rr25 +
        -t10 * rr17 +
        t11 * rr16 +
        t12 * rr31 +
        t13 * rr1 +
        t14 * rr21 +
        -t15 * rr20 +
        -t16 * rr11 +
        t17 * rr10 +
        t18 * rr30 +
        t19 * rr0 +
        t20 * rr15 +
        -t21 * rr14 +
        -t22 * rr6 +
        -t23 * rr28 +
        t24 * rr27 +
        t25 * rr9 +
        t26 * rr2 +
        t27 * rr24 +
        -t28 * rr23 +
        -t29 * rr5 +
        t30 * rr18 +
        t31 * rr12
    )
    s20 = (
        t0 * rr20 +
        t1 * rr14 +
        -t2 * rr27 +
        -t3 * rr9 +
        -t4 * rr29 +
        t5 * rr7 +
        t6 * rr23 +
        t7 * rr5 +
        t8 * rr25 +
        -t9 * rr3 +
        -t10 * rr18 +
        -t11 * rr31 +
        t12 * rr16 +
        -t13 * rr21 +
        t14 * rr1 +
        t15 * rr19 +
        -t16 * rr12 +
        -t17 * rr30 +
        t18 * rr10 +
        -t19 * rr15 +
        t20 * rr0 +
        t21 * rr13 +
        t22 * rr28 +
        -t23 * rr6 +
        -t24 * rr26 +
        -t25 * rr8 +
        -t26 * rr24 +
        t27 * rr2 +
        t28 * rr22 +
        t29 * rr4 +
        -t30 * rr17 +
        -t31 * rr11
    )
    s21 = (
        t0 * rr21 +
        t1 * rr15 +
        -t2 * rr28 +
        t3 * rr29 +
        -t4 * rr9 +
        t5 * rr8 +
        t6 * rr24 +
        -t7 * rr25 +
        t8 * rr5 +
        -t9 * rr4 +
        t10 * rr31 +
        -t11 * rr18 +
        t12 * rr17 +
        t13 * rr20 +
        -t14 * rr19 +
        t15 * rr1 +
        t16 * rr30 +
        -t17 * rr12 +
        t18 * rr11 +
        t19 * rr14 +
        -t20 * rr13 +
        t21 * rr0 +
        -t22 * rr27 +
        t23 * rr26 +
        -t24 * rr6 +
        t25 * rr7 +
        t26 * rr23 +
        -t27 * rr22 +
        t28 * rr2 +
        -t29 * rr3 +
        t30 * rr16 +
        t31 * rr10
    )
    s22 = (
        t0 * rr22 +
        t1 * rr26 +
        t2 * rr13 +
        -t3 * rr11 +
        t4 * rr10 +
        t5 * rr30 +
        -t6 * rr19 +
        t7 * rr17 +
        -t8 * rr16 +
        -t9 * rr31 +
        t10 * rr4 +
        -t11 * rr3 +
        -t12 * rr25 +
        t13 * rr2 +
        t14 * rr24 +
        -t15 * rr23 +
        t16 * rr8 +
        -t17 * rr7 +
        -t18 * rr29 +
        t19 * rr6 +
        t20 * rr28 +
        -t21 * rr27 +
        t22 * rr0 +
        t23 * rr15 +
        -t24 * rr14 +
        t25 * rr12 +
        -t26 * rr1 +
        -t27 * rr21 +
        t28 * rr20 +
        -t29 * rr18 +
        -t30 * rr5 +
        -t31 * rr9
    )
    s23 = (
        t0 * rr23 +
        t1 * rr27 +
        t2 * rr14 +
        -t3 * rr12 +
        -t4 * rr30 +
        t5 * rr10 +
        -t6 * rr20 +
        t7 * rr18 +
        t8 * rr31 +
        -t9 * rr16 +
        t10 * rr5 +
        t11 * rr25 +
        -t12 * rr3 +
        -t13 * rr24 +
        t14 * rr2 +
        t15 * rr22 +
        t16 * rr9 +
        t17 * rr29 +
        -t18 * rr7 +
        -t19 * rr28 +
        t20 * rr6 +
        t21 * rr26 +
        -t22 * rr15 +
        t23 * rr0 +
        t24 * rr13 +
        -t25 * rr11 +
        t26 * rr21 +
        -t27 * rr1 +
        -t28 * rr19 +
        t29 * rr17 +
        t30 * rr4 +
        t31 * rr8
    )
    s24 = (
        t0 * rr24 +
        t1 * rr28 +
        t2 * rr15 +
        t3 * rr30 +
        -t4 * rr12 +
        t5 * rr11 +
        -t6 * rr21 +
        -t7 * rr31 +
        t8 * rr18 +
        -t9 * rr17 +
        -t10 * rr25 +
        t11 * rr5 +
        -t12 * rr4 +
        t13 * rr23 +
        -t14 * rr22 +
        t15 * rr2 +
        -t16 * rr29 +
        t17 * rr9 +
        -t18 * rr8 +
        t19 * rr27 +
        -t20 * rr26 +
        t21 * rr6 +
        t22 * rr14 +
        -t23 * rr13 +
        t24 * rr0 +
        t25 * rr10 +
        -t26 * rr20 +
        t27 * rr19 +
        -t28 * rr1 +
        -t29 * rr16 +
        -t30 * rr3 +
        -t31 * rr7
    )
    s25 = (
        t0 * rr25 +
        t1 * rr29 +
        t2 * rr30 +
        t3 * rr15 +
        -t4 * rr14 +
        t5 * rr13 +
        -t6 * rr31 +
        -t7 * rr21 +
        t8 * rr20 +
        -t9 * rr19 +
        -t10 * rr24 +
        t11 * rr23 +
        -t12 * rr22 +
        t13 * rr5 +
        -t14 * rr4 +
        t15 * rr3 +
        -t16 * rr28 +
        t17 * rr27 +
        -t18 * rr26 +
        t19 * rr9 +
        -t20 * rr8 +
        t21 * rr7 +
        t22 * rr12 +
        -t23 * rr11 +
        t24 * rr10 +
        t25 * rr0 +
        -t26 * rr18 +
        t27 * rr17 +
        -t28 * rr16 +
        -t29 * rr1 +
        -t30 * rr2 +
        -t31 * rr6
    )
    s26 = (
        t0 * rr26 +
        t1 * rr22 +
        -t2 * rr19 +
        t3 * rr17 +
        -t4 * rr16 +
        -t5 * rr31 +
        t6 * rr13 +
        -t7 * rr11 +
        t8 * rr10 +
        t9 * rr30 +
        t10 * rr8 +
        -t11 * rr7 +
        -t12 * rr29 +
        t13 * rr6 +
        t14 * rr28 +
        -t15 * rr27 +
        t16 * rr4 +
        -t17 * rr3 +
        -t18 * rr25 +
        t19 * rr2 +
        t20 * rr24 +
        -t21 * rr23 +
        -t22 * rr1 +
        -t23 * rr21 +
        t24 * rr20 +
        -t25 * rr18 +
        t26 * rr0 +
        t27 * rr15 +
        -t28 * rr14 +
        t29 * rr12 +
        -t30 * rr9 +
        -t31 * rr5
    )
    s27 = (
        t0 * rr27 +
        t1 * rr23 +
        -t2 * rr20 +
        t3 * rr18 +
        t4 * rr31 +
        -t5 * rr16 +
        t6 * rr14 +
        -t7 * rr12 +
        -t8 * rr30 +
        t9 * rr10 +
        t10 * rr9 +
        t11 * rr29 +
        -t12 * rr7 +
        -t13 * rr28 +
        t14 * rr6 +
        t15 * rr26 +
        t16 * rr5 +
        t17 * rr25 +
        -t18 * rr3 +
        -t19 * rr24 +
        t20 * rr2 +
        t21 * rr22 +
        t22 * rr21 +
        -t23 * rr1 +
        -t24 * rr19 +
        t25 * rr17 +
        -t26 * rr15 +
        t27 * rr0 +
        t28 * rr13 +
        -t29 * rr11 +
        t30 * rr8 +
        t31 * rr4
    )
    s28 = (
        t0 * rr28 +
        t1 * rr24 +
        -t2 * rr21 +
        -t3 * rr31 +
        t4 * rr18 +
        -t5 * rr17 +
        t6 * rr15 +
        t7 * rr30 +
        -t8 * rr12 +
        t9 * rr11 +
        -t10 * rr29 +
        t11 * rr9 +
        -t12 * rr8 +
        t13 * rr27 +
        -t14 * rr26 +
        t15 * rr6 +
        -t16 * rr25 +
        t17 * rr5 +
        -t18 * rr4 +
        t19 * rr23 +
        -t20 * rr22 +
        t21 * rr2 +
        -t22 * rr20 +
        t23 * rr19 +
        -t24 * rr1 +
        -t25 * rr16 +
        t26 * rr14 +
        -t27 * rr13 +
        t28 * rr0 +
        t29 * rr10 +
        -t30 * rr7 +
        -t31 * rr3
    )
    s29 = (
        t0 * rr29 +
        t1 * rr25 +
        -t2 * rr31 +
        -t3 * rr21 +
        t4 * rr20 +
        -t5 * rr19 +
        t6 * rr30 +
        t7 * rr15 +
        -t8 * rr14 +
        t9 * rr13 +
        -t10 * rr28 +
        t11 * rr27 +
        -t12 * rr26 +
        t13 * rr9 +
        -t14 * rr8 +
        t15 * rr7 +
        -t16 * rr24 +
        t17 * rr23 +
        -t18 * rr22 +
        t19 * rr5 +
        -t20 * rr4 +
        t21 * rr3 +
        -t22 * rr18 +
        t23 * rr17 +
        -t24 * rr16 +
        -t25 * rr1 +
        t26 * rr12 +
        -t27 * rr11 +
        t28 * rr10 +
        t29 * rr0 +
        -t30 * rr6 +
        -t31 * rr2
    )
    s30 = (
        t0 * rr30 +
        t1 * rr31 +
        t2 * rr25 +
        -t3 * rr24 +
        t4 * rr23 +
        -t5 * rr22 +
        -t6 * rr29 +
        t7 * rr28 +
        -t8 * rr27 +
        t9 * rr26 +
        t10 * rr15 +
        -t11 * rr14 +
        t12 * rr13 +
        t13 * rr12 +
        -t14 * rr11 +
        t15 * rr10 +
        t16 * rr21 +
        -t17 * rr20 +
        t18 * rr19 +
        t19 * rr18 +
        -t20 * rr17 +
        t21 * rr16 +
        t22 * rr5 +
        -t23 * rr4 +
        t24 * rr3 +
        -t25 * rr2 +
        -t26 * rr9 +
        t27 * rr8 +
        -t28 * rr7 +
        t29 * rr6 +
        t30 * rr0 +
        t31 * rr1
    )
    s31 = (
        t0 * rr31 +
        t1 * rr30 +
        -t2 * rr29 +
        t3 * rr28 +
        -t4 * rr27 +
        t5 * rr26 +
        t6 * rr25 +
        -t7 * rr24 +
        t8 * rr23 +
        -t9 * rr22 +
        t10 * rr21 +
        -t11 * rr20 +
        t12 * rr19 +
        t13 * rr18 +
        -t14 * rr17 +
        t15 * rr16 +
        t16 * rr15 +
        -t17 * rr14 +
        t18 * rr13 +
        t19 * rr12 +
        -t20 * rr11 +
        t21 * rr10 +
        -t22 * rr9 +
        t23 * rr8 +
        -t24 * rr7 +
        t25 * rr6 +
        t26 * rr5 +
        -t27 * rr4 +
        t28 * rr3 +
        -t29 * rr2 +
        t30 * rr1 +
        t31 * rr0
    )

    return torch.stack([
        s0, s1, s2, s3, s4, s5, s6, s7,
        s8, s9, s10, s11, s12, s13, s14, s15,
        s16, s17, s18, s19, s20, s21, s22, s23,
        s24, s25, s26, s27, s28, s29, s30, s31,
    ], dim=-1)

# =============================================================================
# Rotor Norm Squared
# =============================================================================

@torch.jit.script
def norm_squared_rotor(r: Tensor) -> Tensor:
    """
    Compute norm squared of a rotor in Cl(2, 3).

    Args:
        r: Input rotor, shape (..., 16)

    Returns:
        Norm squared, shape (..., 1)
    """
    result = (
        r[..., 0] * r[..., 0] +
        r[..., 1] * r[..., 1] +
        -r[..., 2] * r[..., 2] +
        -r[..., 3] * r[..., 3] +
        -r[..., 4] * r[..., 4] +
        -r[..., 5] * r[..., 5] +
        -r[..., 6] * r[..., 6] +
        -r[..., 7] * r[..., 7] +
        r[..., 8] * r[..., 8] +
        r[..., 9] * r[..., 9] +
        r[..., 10] * r[..., 10] +
        r[..., 11] * r[..., 11] +
        r[..., 12] * r[..., 12] +
        r[..., 13] * r[..., 13] +
        -r[..., 14] * r[..., 14] +
        -r[..., 15] * r[..., 15]
    )
    return result.unsqueeze(-1)

# =============================================================================
# Bivector Exponential (exp_bivector)
# =============================================================================

@torch.jit.script
def exp_bivector(B: Tensor) -> Tensor:
    """
    Compute exponential of a bivector in Cl(2, 3).

    Converts a bivector (generator) to a rotor (rotation).
    Formula: exp(B) = cos(Î¸) + sin(Î¸)/Î¸ * B where Î¸ = sqrt(-BÂ²)

    Args:
        B: Input bivector, shape (..., 10)

    Returns:
        Rotor, shape (..., 16)
    """
    B_sq = (
        -B[..., 0] * B[..., 0] +
        B[..., 1] * B[..., 1] +
        B[..., 2] * B[..., 2] +
        B[..., 3] * B[..., 3] +
        B[..., 4] * B[..., 4] +
        B[..., 5] * B[..., 5] +
        B[..., 6] * B[..., 6] +
        -B[..., 7] * B[..., 7] +
        -B[..., 8] * B[..., 8] +
        -B[..., 9] * B[..., 9]
    )

    # Î¸Â² = -BÂ² (bivectors square to negative in Euclidean)
    theta_sq = -B_sq

    # Handle both positive (elliptic) and negative (hyperbolic) cases
    # For numerical stability, use small angle approximation when Î¸ â 0
    eps = 1e-8

    # Elliptic case: Î¸Â² > 0 => exp(B) = cos(Î¸) + sin(Î¸)/Î¸ * B
    # Hyperbolic case: Î¸Â² < 0 => exp(B) = cosh(Î¸) + sinh(Î¸)/Î¸ * B
    theta = torch.sqrt(torch.abs(theta_sq) + eps)

    # Compute cos/cosh and sinc (sin(Î¸)/Î¸ or sinh(Î¸)/Î¸)
    is_elliptic = theta_sq > 0
    cos_term = torch.where(is_elliptic, torch.cos(theta), torch.cosh(theta))
    sinc_term = torch.where(
        is_elliptic,
        torch.sin(theta) / theta,
        torch.sinh(theta) / theta
    )

    # Build rotor: scalar part + bivector parts
    r0 = cos_term
    r1 = sinc_term * B[..., 0]
    r2 = sinc_term * B[..., 1]
    r3 = sinc_term * B[..., 2]
    r4 = sinc_term * B[..., 3]
    r5 = sinc_term * B[..., 4]
    r6 = sinc_term * B[..., 5]
    r7 = sinc_term * B[..., 6]
    r8 = sinc_term * B[..., 7]
    r9 = sinc_term * B[..., 8]
    r10 = sinc_term * B[..., 9]
    r11 = torch.zeros_like(B[..., 0])
    r12 = torch.zeros_like(B[..., 0])
    r13 = torch.zeros_like(B[..., 0])
    r14 = torch.zeros_like(B[..., 0])
    r15 = torch.zeros_like(B[..., 0])

    return torch.stack([
        r0, r1, r2, r3, r4, r5, r6, r7,
        r8, r9, r10, r11, r12, r13, r14, r15,
    ], dim=-1)

# =============================================================================
# Rotor Logarithm (log_rotor)
# =============================================================================

@torch.jit.script
def log_rotor(r: Tensor) -> Tensor:
    """
    Compute logarithm of a rotor in Cl(2, 3).

    Converts a rotor (rotation) to a bivector (generator).
    Formula: log(R) = atan2(|B|, s) / |B| * B where R = s + B

    Args:
        r: Input rotor, shape (..., 16)

    Returns:
        Bivector, shape (..., 10)
    """
    s = r[..., 0]  # Scalar part

    # Compute |B|Â² from bivector parts of rotor
    B_norm_sq = (
        r[..., 1] * r[..., 1] +
        r[..., 2] * r[..., 2] +
        r[..., 3] * r[..., 3] +
        r[..., 4] * r[..., 4] +
        r[..., 5] * r[..., 5] +
        r[..., 6] * r[..., 6] +
        r[..., 7] * r[..., 7] +
        r[..., 8] * r[..., 8] +
        r[..., 9] * r[..., 9] +
        r[..., 10] * r[..., 10]
    )

    # Compute angle Î¸ = atan2(|B|, s)
    eps = 1e-8
    B_norm = torch.sqrt(B_norm_sq + eps)
    theta = torch.atan2(B_norm, s)

    # Scale factor: Î¸ / |B|
    scale = theta / (B_norm + eps)

    # Extract bivector components from rotor
    b0 = scale * r[..., 1]
    b1 = scale * r[..., 2]
    b2 = scale * r[..., 3]
    b3 = scale * r[..., 4]
    b4 = scale * r[..., 5]
    b5 = scale * r[..., 6]
    b6 = scale * r[..., 7]
    b7 = scale * r[..., 8]
    b8 = scale * r[..., 9]
    b9 = scale * r[..., 10]

    return torch.stack([
        b0, b1, b2, b3, b4, b5, b6, b7,
        b8, b9,
    ], dim=-1)

# =============================================================================
# Rotor SLERP (Spherical Linear Interpolation)
# =============================================================================

@torch.jit.script
def slerp_rotor(r1: Tensor, r2: Tensor, t: Tensor) -> Tensor:
    """
    Spherical linear interpolation between rotors in Cl(2, 3).

    Formula: slerp(r1, r2, t) = r1 * exp(t * log(r1~ * r2))

    Args:
        r1: Start rotor, shape (..., 16)
        r2: End rotor, shape (..., 16)
        t: Interpolation parameter [0, 1], shape (...) or scalar

    Returns:
        Interpolated rotor, shape (..., 16)
    """
    # Compute r1~ (reverse of r1)
    r1_rev = reverse_rotor(r1)

    # Compute delta = r1~ * r2
    delta = compose_rotor(r1_rev, r2)

    # Compute log of delta to get bivector
    log_delta = log_rotor(delta)

    # Scale by t
    if t.dim() == 0:
        scaled_log = t * log_delta
    else:
        scaled_log = t.unsqueeze(-1) * log_delta

    # Exponentiate back to rotor
    delta_t = exp_bivector(scaled_log)

    # Compose with r1
    return compose_rotor(r1, delta_t)
