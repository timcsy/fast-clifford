# 資料模型：CGA 幾何代數規則定義

**日期**: 2025-12-05
**功能**: 001-cga-algebra-rules

## 實體定義

### 1. Blade（基底刃）

**描述**: Clifford 代數中的基底多重向量元素

| 欄位 | 型別 | 說明 | 範例 |
|------|------|------|------|
| index | int | 在 32 維空間中的索引 (0-31) | `0`, `5`, `31` |
| grade | int | 階數 (0-5) | `0`=scalar, `1`=vector |
| basis_vectors | tuple[int] | 組成的基底向量索引 | `()`, `(0,)`, `(0,1,2,3,4)` |
| name | str | 人類可讀名稱 | `"1"`, `"e1"`, `"e12345"` |

**Grade 分佈**:
```
Grade 0: 1 個 (scalar)     → index 0
Grade 1: 5 個 (vector)     → index 1-5
Grade 2: 10 個 (bivector)  → index 6-15
Grade 3: 10 個 (trivector) → index 16-25
Grade 4: 5 個 (quadvector) → index 26-30
Grade 5: 1 個 (pseudoscalar) → index 31
```

**完整 Blade 索引表**（按 clifford 庫標準順序）:

| Index | Grade | Name | Basis Vectors |
|-------|-------|------|---------------|
| 0 | 0 | 1 | () |
| 1 | 1 | e1 | (0,) |
| 2 | 1 | e2 | (1,) |
| 3 | 1 | e3 | (2,) |
| 4 | 1 | e+ | (3,) |
| 5 | 1 | e- | (4,) |
| 6 | 2 | e12 | (0,1) |
| 7 | 2 | e13 | (0,2) |
| 8 | 2 | e1+ | (0,3) |
| 9 | 2 | e1- | (0,4) |
| 10 | 2 | e23 | (1,2) |
| 11 | 2 | e2+ | (1,3) |
| 12 | 2 | e2- | (1,4) |
| 13 | 2 | e3+ | (2,3) |
| 14 | 2 | e3- | (2,4) |
| 15 | 2 | e+- | (3,4) |
| 16 | 3 | e123 | (0,1,2) |
| 17 | 3 | e12+ | (0,1,3) |
| 18 | 3 | e12- | (0,1,4) |
| 19 | 3 | e13+ | (0,2,3) |
| 20 | 3 | e13- | (0,2,4) |
| 21 | 3 | e1+- | (0,3,4) |
| 22 | 3 | e23+ | (1,2,3) |
| 23 | 3 | e23- | (1,2,4) |
| 24 | 3 | e2+- | (1,3,4) |
| 25 | 3 | e3+- | (2,3,4) |
| 26 | 4 | e123+ | (0,1,2,3) |
| 27 | 4 | e123- | (0,1,2,4) |
| 28 | 4 | e12+- | (0,1,3,4) |
| 29 | 4 | e13+- | (0,2,3,4) |
| 30 | 4 | e23+- | (1,2,3,4) |
| 31 | 5 | e12345 | (0,1,2,3,4) |

### 2. BasisVector（基底向量）

**描述**: CGA 的 5 個基底向量

| 索引 | 名稱 | 度規 | 說明 |
|------|------|------|------|
| 0 | e1 | +1 | 歐幾里得 x 軸 |
| 1 | e2 | +1 | 歐幾里得 y 軸 |
| 2 | e3 | +1 | 歐幾里得 z 軸 |
| 3 | e+ | +1 | 正簽名額外維度 |
| 4 | e- | -1 | 負簽名額外維度 |

### 3. NullBasis（Null 基底）

**描述**: CGA 特有的 null 向量定義

| 名稱 | 定義 | 性質 | 用途 |
|------|------|------|------|
| $n_o$ | $\frac{1}{2}(e_- - e_+)$ | $n_o^2 = 0$ | 原點表示 |
| $n_\infty$ | $e_- + e_+$ | $n_\infty^2 = 0$ | 無窮遠點表示 |

**約定**: $n_o \cdot n_\infty = -1$

### 4. GeometricProductRule（幾何積規則）

**描述**: 兩個 blade 相乘的結果

| 欄位 | 型別 | 說明 |
|------|------|------|
| left_index | int | 左運算元 blade 索引 |
| right_index | int | 右運算元 blade 索引 |
| result_index | int | 結果 blade 索引 |
| sign | int | 符號 (+1 或 -1) |

**總數**: 32 × 32 = 1024 條規則（大部分結果為零）

### 5. SparsityMask（稀疏性遮罩）

**描述**: 特定類型 multivector 的非零 blade 索引

| 類型 | 非零索引 | 數量 | 說明 |
|------|----------|------|------|
| UPGC_POINT | [1, 2, 3, 4, 5] | 5 | Grade 1 only |
| MOTOR | [0, 6-15, 26-30] | 16 | Grade 0, 2, 4 |
| RESULT | [1, 2, 3, 4, 5] | 5 | Grade 1 only |

### 6. ReverseSign（Reverse 符號）

**描述**: Reverse 操作對每個 blade 的符號影響

| Grade | 符號公式 | 結果 |
|-------|---------|------|
| 0 | $(-1)^{0 \times -1 / 2} = 1$ | +1 |
| 1 | $(-1)^{1 \times 0 / 2} = 1$ | +1 |
| 2 | $(-1)^{2 \times 1 / 2} = -1$ | -1 |
| 3 | $(-1)^{3 \times 2 / 2} = -1$ | -1 |
| 4 | $(-1)^{4 \times 3 / 2} = 1$ | +1 |
| 5 | $(-1)^{5 \times 4 / 2} = 1$ | +1 |

---

## 張量表示

### Multivector 張量

```
形狀: (..., 32)
dtype: float32 (強制)
最後一維對應 32 個 blade 係數
```

### UPGC Point 稀疏張量

```
形狀: (..., 5)
dtype: float32
對應: [e1_coeff, e2_coeff, e3_coeff, e+_coeff, e-_coeff]
```

### Motor 稀疏張量

```
形狀: (..., 16)
dtype: float32
對應: [scalar, e12, e13, e1+, e1-, e23, e2+, e2-, e3+, e3-, e+-, e123+, e123-, e12+-, e13+-, e23+-]
```

---

## 關係圖

```
BasisVector (5)
    │
    ├──組成──▶ Blade (32)
    │              │
    │              ├──左運算元──┐
    │              │            ▼
    │              └──右運算元──▶ GeometricProductRule (1024)
    │
    └──定義──▶ NullBasis (2)
                   │
                   └──用於──▶ UPGC Point 編碼

SparsityMask
    │
    ├── UPGC_POINT: 輸入稀疏性
    ├── MOTOR: 變換算子稀疏性
    └── RESULT: 輸出稀疏性
```

---

## 狀態轉換

本功能不涉及狀態轉換（純計算規則定義）。

---

## 驗證規則

### Blade 驗證
- index 必須在 [0, 31] 範圍內
- grade 必須在 [0, 5] 範圍內
- basis_vectors 元素必須在 [0, 4] 範圍內且無重複

### GeometricProductRule 驗證
- left_index, right_index, result_index 必須在 [0, 31] 範圍內
- sign 必須為 +1 或 -1
- 必須滿足結合律：$(a \cdot b) \cdot c = a \cdot (b \cdot c)$

### SparsityMask 驗證
- 所有索引必須在 [0, 31] 範圍內
- UPGC_POINT 必須只包含 Grade 1 索引
- MOTOR 必須只包含 Grade 0, 2, 4 索引
